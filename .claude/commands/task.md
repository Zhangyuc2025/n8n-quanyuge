---
name: task
description: 执行任务工作流 - 综合分析制定方案并执行
model: inherit
tools: [Read, Grep, Glob, WebFetch, WebSearch, Bash, Write, Edit]
mcp-servers: ["context7","smithery-ai-server-sequential-thinking"]
priority: HIGH
---

# 🚀 /task - 任务执行工作流

## 通知用户: "你已经进入执行任务流程"

**交流方式**: 使用中文语言和用户交流,内容以卡片形式呈现.  [不遵守视为违规]

**执行规则**: 🔴 禁止跳过任何一个步骤,禁止以任何形式偷懒. [不遵守视为违规]

**实时反馈**: 每执行完一个步骤就立即将结果反馈给用户,以及可视化卡片形式展示.  [不遵守视为违规]

**任何不确定的问题必须向用户发出调查问卷,提高描述准确度,禁止猜测.** [不遵守视为违规]

**分析问题必须全面,要分期整个相关逻辑链以及相关全部代码** [不遵守视为违规]

**重要提示**: 严格遵守规则,禁止任何形式懒惰行为。如有违规,任务将被标记为失败,必须重新执行

**使用顺序思维执行任务**

---

**知识库文件**
```yaml
索引文档: (./.claude/guide/index.md)  # 项目全部文件索引  -- 任何文件改动需要同步更新
项目架构: (./.claude/guide/项目架构.md)  # 技术栈和系统架构 -- 系统架构改动需要同步更新
用户规则: (./.claude/guide/用户规则.md)  # 用户自定义规则 -- 默认空文档用户自己设置规则
自定义库: (./.claude/guide/自定义库.md)  # 项目自定义封装库 -- 检测到自定义库需要同步更新
API文档: (./.claude/guide/API.md)  # 全部API+复用函数(不区分前后端) -- API和复用函数改动需要同步更新
网络文档: (./.claude/guide/网络文档.md)  # 参考文档记录  --  弃用功能删除对应文档参考
核心流程: (./.claude/guide/核心流程/[功能名称].md)  # 功能详细运行流程  --  流程改动同步更新
错误修复记录: (./.claude/guide/知识沉淀/错误修复/[错误描述].md)  # 错误修复历史
踩坑记录: (./.claude/guide/知识沉淀/踩坑记录/[问题描述].md)  # 避坑指南

```



**禁止任何形式违规**:
```yaml
1: 不确定的地方擅自猜测或随机生成数据
2: 偷懒没有全方位分析就声称完成
3: 遗漏任何验证步骤
4: 使用占位符或示例数据代替真实数据
5: 跳过文档更新直接声称完成
6: 网络搜索结果有帮助但未记录到网络参考.md
7: 🔴使用原生库而非自定义库(严重违规) - 项目存在自定义库但使用原生库替代

如有违规,任务将被标记为失败,必须重新执行!
```


## 编码规范:

```md
**1. 自定义库能实现的功能必须使用自定义库** : 一行代码能解决的问题禁止使用第二行代码,这时就使用自定义库的意义

**2. 相同功能多次使用封装为函数** : 重复的代码封装为复用函数,提高可靠性,减少代码行数

**3. 编码风格简约高效,优先修改优化已存在文件** : 不乱建文件,不导致项目臃肿混乱

**4. 测试代码全部存放到./tests/内** : 测试完即删除,不遗留垃圾,保持项目干净

**5. 更新代码必须清理干净旧的代码** : 新旧代码禁止同时存在,只保留最新代码,出现兼容性问题就同步更新其他代码兼容最新的代码

```

**必须用户授权的操作**
```yaml
1: 核心流程需要改动必须发送新流程给用户确认,用户明确[确认]后才能进行改动并且执行后续操作.   # 避免把运行完好的流程图损坏

```

## 步骤1: 多源分析  (综合收集分析信息)

```md

**1.1: 充分理解用户描述** : 任何不确定必须向用户发送调查文件以及选项,让用户选择从而保证100%理解用户需求

**1.2: 根据用户需求进行多源分析** : 查阅相关知识库可以快速理解项目以及定位文件逻辑,context7和网络文档查询可以解除编码疑惑和参考相关开源作品需求解决方案,文件查询可以获取项目真实状态

**1.3: 本次任务涉及到了什么?** : 根据用户描述以及多源分析,你需要知道本次任务涉及到了什么文件,什么流程,是否关联其他地方? 

**1.4: 全面关联性分析,避免产生更多错误** : 例如:函数A操控数据库,函数B调用函数A操控数据库,函数C调用函数B获取内容, 那么 A,B,C任何一处需要修改都必须检查确定其他两处是否也需要修改

**1.5: 以可视化表单形式展示出:问题描述,参考知识库列表,直接相关文件列表,有关联性文件列表** : 简单易懂展示分析结果,只需要展示描述文件名,不需要展示代码详情

## 以上5项任何一项没有完成就必须重新完成该项,如果全部完成则开始制定任务方案,复杂任务拆分为多个子任务依次执行,制定编码任务严格遵守[编码规范]

```




## 步骤2: 任务制定  (综合收集分析信息)


```md

**2.1: 任务拆解** : 将复杂的任务拆解为具体子任务,识别任务依赖关系,确定执行顺序

**2.2: 任务制定** : 根据[多源分析]进行任务制定,禁止偷懒遗漏任何问题,不要遗漏任何细微问题

**2.3: 任务展示** : 使用卡片方便阅读形式向用户展示任务执行方案,包含(涉及文件,核心流程,复用函数,API)方便用户确定补充需求.

**2.4: 方案确定** : 明确询问用户:"是否开始执行任务? ( 是 / 其他 )" [是:开始执行步骤3执行任务 / 否:根据用户补充信息重新深入分析相关文档和代码生成解决方案.(回退到[步骤1])]


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 自检清单:

✅ 是否已完成任务拆解?

✅ 是否已设计技术方案?

✅ 是否已生成执行计划?

✅ 是否已获得用户确认?

➡️ 是否完成方案制定? 以上结果全部为"是"则进入步骤3,任何一步为"否"则必须完成此步骤.
==============================================================

```




## 步骤3: 任务执行  (按计划执行并实时反馈)

```md

**3.1: 按照任务列表依次执行** : 严格遵守[编码规范],勤思考,不偷懒,不猜测,遇到不确定因素网络查阅文档,无法解决必须立即报告给用户,等待用户反馈再继续执行

**3.2: 执行一步验证一步** : 每执行一项任务必须验证是否符合预期,是否产生新问题,是否遵守[编码规范]. 任何一项不符合必须修正,直至全部符合才能进入下一项任务

**进度反馈格式:**
==============================================================
📊 执行进度
==============================================================

✅ 已完成: [X]/[N]

🔄 进行中: [任务名]

⏳ 待执行: [Y]个

==============================================================

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 自检清单:

✅ 是否按计划完成全部执行步骤?

✅ 是否每步都进行了验证?

✅ 是否记录了遇到的问题?

✅ 是否实时反馈了进度?

➡️ 是否完成任务执行? 以上结果全部为"是"则进入步骤4,任何一步为"否"则必须完成此步骤.
==============================================================

```




## 步骤4: 任务验证  (用户确认完成质量)

```md

**4.1: 生成完成报告** : 卡片展示[任务目标+已完成列表+文件改动+技术方案+遇到问题+解决方案+测试结果+参考文档]

**4.2: 质量自检** : ✓编码规范 ✓清理旧代码 ✓使用自定义库 ✓测试验证 ✓关联文件同步 ✓网络文档记录

**4.3: 询问用户** : "✅ 任务是否完美完成? ( 完美 / 有问题 )"

**4.4: 处理反馈** :
    - [完美] → 运行[/sync-kb]工作流对知识库进行更新
    - [有问题] → 记录问题详情 → 判断回退位置(需求理解错→步骤1 / 方案设计错→步骤2 / 实现细节错→步骤3) → 重新执行直至完美

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 自检: ✓生成报告 ✓质量检查 ✓等待反馈 ✓正确处理 → 用户确认"完美"进入步骤5
==============================================================

```



