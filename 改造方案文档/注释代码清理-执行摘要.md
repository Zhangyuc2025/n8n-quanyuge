# æ³¨é‡Šä»£ç æ¸…ç† - æ‰§è¡Œæ‘˜è¦

## ğŸ“‹ å¿«é€Ÿå‚è€ƒ

### å½“å‰çŠ¶æ€
- **æ€»æ”¹åŠ¨**: æ–°å¢ 864 è¡Œï¼Œåˆ é™¤ 5,459 è¡Œï¼ˆå‡€åˆ é™¤ 4,595 è¡Œï¼‰
- **æ–°å¢æ³¨é‡Š**: 440 è¡Œï¼ˆå…¶ä¸­ 71 è¡Œæ˜¯è¯´æ˜æ€§æ³¨é‡Šï¼Œåº”ä¿ç•™ï¼‰
- **å¯æ¸…ç†æ³¨é‡Š**: çº¦ 250-300 è¡Œ
- **é¢„è®¡æ¸…ç†æ—¶é—´**: 6-9 å°æ—¶ï¼ˆåˆ† 3 å¤©å®Œæˆï¼‰

### æ–‡æ¡£ç´¢å¼•
1. **è¯¦ç»†ç­–ç•¥**: `æ³¨é‡Šä»£ç æ¸…ç†ç­–ç•¥.md` - å®Œæ•´çš„æ¸…ç†ç­–ç•¥å’Œé£é™©åˆ†æ
2. **è¾…åŠ©è„šæœ¬**: `æ³¨é‡Šä»£ç æ¸…ç†è„šæœ¬.sh` - è‡ªåŠ¨åŒ–åˆ†æå·¥å…·
3. **æœ¬æ–‡æ¡£**: `æ³¨é‡Šä»£ç æ¸…ç†-æ‰§è¡Œæ‘˜è¦.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—

---

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

### âœ… åº”è¯¥åˆ é™¤çš„æ³¨é‡Š
1. **æ³¨é‡Šæ‰çš„ import è¯­å¥** (~23 å¤„)
   ```typescript
   // import { CredentialsService } from '@/credentials/credentials.service';
   ```

2. **æ³¨é‡Šæ‰çš„å˜é‡å£°æ˜** (~27 å¤„)
   ```typescript
   // const credentialsStore = useCredentialsStore();
   // const usedCredentials = ref<IUsedCredential[]>([]);
   ```

3. **å¤§å—æ³¨é‡Šçš„ä»£ç ** (~150+ å¤„)
   ```typescript
   // const userCredentials = await this.credentialsService.getCredentials(...);
   // if (!credentials) return;
   // ...20+ lines of commented code...
   ```

4. **Vue HTML æ³¨é‡Š** (~10 å¤„)
   ```vue
   <!-- <ModalRoot :name="CREDENTIAL_EDIT_MODAL_KEY">
       <CredentialEdit />
   </ModalRoot> -->
   ```

### âŒ ä¸åº”åˆ é™¤çš„æ³¨é‡Š
1. **è¯´æ˜æ€§æ³¨é‡Š** (71 å¤„)
   ```typescript
   // Credential system has been removed
   // Credential system has been removed - keeping this for backward compatibility
   ```

2. **@deprecated æ ‡è®°** (5 å¤„)
   ```typescript
   /**
    * @deprecated OAuth2 authentication removed - credentials system has been removed
    */
   ```

3. **å‘åå…¼å®¹è¯´æ˜**
   ```typescript
   // Credential system has been removed - local type for compatibility
   type ICredentialDataDecryptedObject = Record<string, any>;
   ```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ3 æ­¥ï¼‰

### æ­¥éª¤ 1: è¿è¡Œåˆ†æå·¥å…·
```bash
cd /home/zhang/n8n-quanyuge

# è¿è¡Œå®Œæ•´åˆ†æ
bash æ”¹é€ æ–¹æ¡ˆæ–‡æ¡£/æ³¨é‡Šä»£ç æ¸…ç†è„šæœ¬.sh

# æˆ–è€…åªè¿è¡Œç‰¹å®šåˆ†æ
bash æ”¹é€ æ–¹æ¡ˆæ–‡æ¡£/æ³¨é‡Šä»£ç æ¸…ç†è„šæœ¬.sh -i -b  # åªæŸ¥æ‰¾ import å’Œä»£ç å—
```

**è¾“å‡º**:
- `commented-imports-YYYYMMDD.txt` - æ³¨é‡Šçš„ import åˆ—è¡¨
- `commented-blocks-YYYYMMDD.txt` - å¤§å—æ³¨é‡Šä»£ç åˆ—è¡¨
- `html-comments-YYYYMMDD.txt` - HTML æ³¨é‡Šåˆ—è¡¨
- `æ¸…ç†å»ºè®®-YYYYMMDD.md` - è‡ªåŠ¨ç”Ÿæˆçš„æ¸…ç†å»ºè®®

### æ­¥éª¤ 2: åˆ›å»ºæ¸…ç†åˆ†æ”¯
```bash
# åˆ›å»ºå¸¦æ—¥æœŸçš„æ¸…ç†åˆ†æ”¯
git checkout -b cleanup-commented-code-$(date +%Y%m%d)

# æˆ–è€…æ‰‹åŠ¨æŒ‡å®šåç§°
git checkout -b cleanup-commented-code-phase1
```

### æ­¥éª¤ 3: é€‰æ‹©æ¸…ç†ç­–ç•¥

#### ç­–ç•¥ A: æ¸è¿›å¼æ¸…ç†ï¼ˆæ¨èï¼Œä½é£é™©ï¼‰
```bash
# é˜¶æ®µ 1: æ¸…ç† importï¼ˆç¬¬1å¤©ï¼Œ0.5å°æ—¶ï¼‰
# æ‰‹åŠ¨ç¼–è¾‘æ–‡ä»¶ï¼Œåˆ é™¤æ³¨é‡Šçš„ import
pnpm typecheck  # éªŒè¯

# é˜¶æ®µ 2: æ¸…ç† HTML æ³¨é‡Šï¼ˆç¬¬2å¤©ï¼Œ1å°æ—¶ï¼‰
# æ‰‹åŠ¨ç¼–è¾‘ Vue æ–‡ä»¶ï¼Œåˆ é™¤ HTML æ³¨é‡Š
pnpm lint && pnpm build  # éªŒè¯

# é˜¶æ®µ 3: æ¸…ç†å¤§å—ä»£ç ï¼ˆç¬¬3å¤©ï¼Œ3-4å°æ—¶ï¼‰
# é€ä¸ªæ£€æŸ¥å’Œåˆ é™¤å¤§å—æ³¨é‡Šä»£ç 
pnpm build && pnpm test:affected  # éªŒè¯
```

#### ç­–ç•¥ B: é›†ä¸­æ¸…ç†ï¼ˆæ¿€è¿›ï¼Œé«˜é£é™©ï¼Œä¸æ¨èç”Ÿäº§ç¯å¢ƒï¼‰
```bash
# ä¸€æ¬¡æ€§æ¸…ç†æ‰€æœ‰
# éœ€è¦å®Œæ•´æµ‹è¯•è¦†ç›–å’Œå¿«é€Ÿå›æ»šèƒ½åŠ›
```

---

## ğŸ“Š æ¸…ç†ä¼˜å…ˆçº§çŸ©é˜µ

| æ³¨é‡Šç±»å‹ | æ•°é‡ | é£é™© | æ—¶é—´ | å»ºè®® |
|---------|------|------|------|------|
| æ³¨é‡Šçš„ import | ~23 | ğŸŸ¢ ä½ | 0.5h | ç«‹å³æ¸…ç† |
| å˜é‡å£°æ˜ | ~27 | ğŸŸ¢ ä½ | 0.5h | ç«‹å³æ¸…ç† |
| HTML æ³¨é‡Š | ~10 | ğŸŸ¢ ä½ | 1h | ç«‹å³æ¸…ç† |
| ç±»å‹å®šä¹‰ | ~30 | ğŸŸ¡ ä¸­ | 2h | éªŒè¯åæ¸…ç† |
| å‡½æ•°å®ç° | ~20 | ğŸŸ¡ ä¸­ | 3h | éªŒè¯åæ¸…ç† |
| å¤§æ®µé€»è¾‘ | ~50+ | ğŸŸ¡ ä¸­ | 2h | éªŒè¯åæ¸…ç† |
| è¯´æ˜æ³¨é‡Š | 71 | ğŸ”´ é«˜ | - | **ä¿ç•™** |
| @deprecated | 5 | ğŸ”´ é«˜ | - | **ä¿ç•™** |

---

## âœ… éªŒè¯æ£€æŸ¥æ¸…å•

### åˆ é™¤å‰æ£€æŸ¥
```bash
# 1. ç±»å‹æ£€æŸ¥
pnpm typecheck

# 2. Lint æ£€æŸ¥
pnpm lint

# 3. æœç´¢å¼•ç”¨ï¼ˆå¯¹æ¯ä¸ªè¦åˆ é™¤çš„å‡½æ•°/ç±»å‹ï¼‰
grep -r "functionName" packages/ --include="*.ts" --include="*.vue"
```

### åˆ é™¤åéªŒè¯
```bash
# 1. å®Œæ•´æ„å»º
pnpm build > build.log 2>&1
tail -n 50 build.log  # æ£€æŸ¥é”™è¯¯

# 2. ä»£ç è´¨é‡
pnpm typecheck && pnpm lint

# 3. è¿è¡Œæµ‹è¯•
pnpm test:affected

# 4. æ‰‹åŠ¨æµ‹è¯•å…³é”®åŠŸèƒ½
# - å·¥ä½œæµåˆ›å»ºå’Œç¼–è¾‘
# - èŠ‚ç‚¹æ·»åŠ å’Œé…ç½®
# - å·¥ä½œæµæ‰§è¡Œ
# - é¡¹ç›®å’Œæ–‡ä»¶å¤¹æ“ä½œ
```

---

## ğŸ“ é‡ç‚¹æ¸…ç†æ–‡ä»¶

### é«˜ä¼˜å…ˆçº§ï¼ˆé£é™©ä½ï¼Œå½±å“å¤§ï¼‰
1. **å‰ç«¯ç»„ä»¶**
   - `packages/frontend/editor-ui/src/features/core/folders/components/MoveToFolderModal.vue`
   - `packages/frontend/editor-ui/src/app/components/Modals.vue`
   - é¢„è®¡æ¸…ç†: 50+ è¡Œ

2. **ç±»å‹å®šä¹‰**
   - `packages/@n8n/db/src/entities/types-db.ts`
   - `packages/workflow/src/interfaces.ts`
   - é¢„è®¡æ¸…ç†: 40+ è¡Œ

### ä¸­ä¼˜å…ˆçº§ï¼ˆéœ€è¦ä»”ç»†æ£€æŸ¥ï¼‰
3. **æœåŠ¡ç±»**
   - `packages/cli/src/workflows/workflow.service.ee.ts`
   - `packages/cli/src/services/frontend.service.ts`
   - é¢„è®¡æ¸…ç†: 60+ è¡Œ

4. **æ‰§è¡Œå¼•æ“**
   - `packages/core/src/execution-engine/node-execution-context/utils/request-helper-functions.ts`
   - é¢„è®¡æ¸…ç†: 80+ è¡Œ

---

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

### åˆ†æå‘½ä»¤
```bash
# ç»Ÿè®¡æ³¨é‡Šæ•°é‡
git diff HEAD | grep -E '^[+].*//.*Credential system' | wc -l

# æŸ¥æ‰¾æ‰€æœ‰æ³¨é‡Šçš„ import
git diff HEAD | grep -E '^[+].*// import' packages/

# æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶çš„æ”¹åŠ¨
git diff HEAD packages/workflow/src/interfaces.ts
```

### Git æ“ä½œ
```bash
# æš‚å­˜éƒ¨åˆ†ä¿®æ”¹
git add -p

# æŸ¥çœ‹æ”¹åŠ¨ç»Ÿè®¡
git diff --stat

# æŸ¥çœ‹ç‰¹å®šç±»å‹æ–‡ä»¶
git diff HEAD -- "*.ts"
git diff HEAD -- "*.vue"
```

### éªŒè¯å‘½ä»¤
```bash
# å¿«é€ŸéªŒè¯ï¼ˆä¸å«æµ‹è¯•ï¼‰
pnpm typecheck && pnpm lint

# å®Œæ•´éªŒè¯
pnpm typecheck && pnpm lint && pnpm build && pnpm test:affected

# åˆ†åŒ…éªŒè¯
cd packages/cli && pnpm typecheck && pnpm lint
cd packages/core && pnpm typecheck && pnpm lint
cd packages/frontend/editor-ui && pnpm typecheck && pnpm lint
```

---

## âš ï¸ å¸¸è§é—®é¢˜å’Œæ³¨æ„äº‹é¡¹

### Q1: æ˜¯å¦å¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ‰¹é‡åˆ é™¤ï¼Ÿ
**A**: ä¸æ¨èã€‚è™½ç„¶å¯ä»¥ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œä½†éœ€è¦äººå·¥å®¡æŸ¥æ¯ä¸€å¤„ï¼Œç¡®ä¿ä¸ä¼šè¯¯åˆ é‡è¦æ³¨é‡Šã€‚

### Q2: åˆ é™¤åå¦‚ä½•ç¡®ä¿æ²¡æœ‰ç ´ååŠŸèƒ½ï¼Ÿ
**A**:
1. æ¯æ¬¡åˆ é™¤åè¿è¡Œ `pnpm typecheck && pnpm lint`
2. åˆ é™¤å¤§å—ä»£ç åè¿è¡Œ `pnpm build && pnpm test`
3. æ‰‹åŠ¨æµ‹è¯•å…³é”®åŠŸèƒ½
4. åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯

### Q3: å¦‚æœåˆ é™¤åå‡ºç°é—®é¢˜æ€ä¹ˆåŠï¼Ÿ
**A**:
1. æ‰€æœ‰æ”¹åŠ¨éƒ½åœ¨ git åˆ†æ”¯ä¸Šï¼Œå¯ä»¥éšæ—¶å›æ»š
2. ä½¿ç”¨ `git checkout -- <file>` æ¢å¤å•ä¸ªæ–‡ä»¶
3. ä½¿ç”¨ `git reset --hard` æ¢å¤æ‰€æœ‰æ”¹åŠ¨ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

### Q4: å“ªäº›æ³¨é‡Šç»å¯¹ä¸èƒ½åˆ é™¤ï¼Ÿ
**A**:
1. åŒ…å«"Credential system has been removed"çš„è¯´æ˜æ³¨é‡Š
2. æ‰€æœ‰ @deprecated æ ‡è®°
3. "backward compatibility"ç›¸å…³çš„æ³¨é‡Š
4. "local type for compatibility"ç›¸å…³çš„æ³¨é‡Š

### Q5: æ¸…ç†å®Œæˆåçš„é¢„æœŸæ•ˆæœï¼Ÿ
**A**:
- åˆ é™¤çº¦ 200-250 è¡Œæ— ç”¨æ³¨é‡Š
- ä¿ç•™çº¦ 70-80 è¡Œæœ‰ä»·å€¼çš„è¯´æ˜æ³¨é‡Š
- ä»£ç å¯è¯»æ€§æå‡
- ç»´æŠ¤æˆæœ¬é™ä½
- æ‰€æœ‰æµ‹è¯•é€šè¿‡
- åŠŸèƒ½å®Œå…¨æ­£å¸¸

---

## ğŸ“ˆ æ¸…ç†è¿›åº¦è¿½è¸ª

### ä½¿ç”¨æ¸…ç†æ—¥å¿—
```bash
# è®°å½•æ¸…ç†è¿›åº¦
echo "$(date): å®Œæˆé˜¶æ®µ1 - æ¸…ç† import è¯­å¥" >> æ”¹é€ æ–¹æ¡ˆæ–‡æ¡£/æ¸…ç†è¿›åº¦.log
```

### æ¨èçš„è¿›åº¦æ¨¡æ¿
```
æ¸…ç†è¿›åº¦æ—¥å¿—
===============

[2025-11-10 09:00] å¼€å§‹æ¸…ç† - åˆ›å»ºåˆ†æ”¯ cleanup-commented-code-20251110
[2025-11-10 10:00] é˜¶æ®µ1å®Œæˆ - æ¸…ç† import è¯­å¥ (23 å¤„)
  - typecheck: âœ“ é€šè¿‡
  - lint: âœ“ é€šè¿‡

[2025-11-10 14:00] é˜¶æ®µ2å®Œæˆ - æ¸…ç† HTML æ³¨é‡Š (10 å¤„)
  - build: âœ“ æˆåŠŸ
  - UI æµ‹è¯•: âœ“ æ­£å¸¸

[2025-11-11 09:00] é˜¶æ®µ3å¼€å§‹ - æ¸…ç†å¤§å—ä»£ç 
[2025-11-11 15:00] é˜¶æ®µ3å®Œæˆ - æ¸…ç†å¤§å—ä»£ç  (150+ å¤„)
  - typecheck: âœ“ é€šè¿‡
  - lint: âœ“ é€šè¿‡
  - build: âœ“ æˆåŠŸ
  - test: âœ“ é€šè¿‡

[2025-11-11 16:00] æ¸…ç†å®Œæˆ - å‡†å¤‡åˆå¹¶
```

---

## ğŸ“ æœ€ä½³å®è·µæ€»ç»“

### DOï¼ˆæ¨èï¼‰
âœ… æ¸è¿›å¼æ¸…ç†ï¼Œæ¯é˜¶æ®µéªŒè¯
âœ… ä½¿ç”¨ git åˆ†æ”¯ä¿æŠ¤åŸä»£ç 
âœ… ä¿ç•™æ‰€æœ‰è¯´æ˜æ€§æ³¨é‡Š
âœ… åˆ é™¤å‰æœç´¢å¼•ç”¨
âœ… åˆ é™¤åå……åˆ†æµ‹è¯•
âœ… è®°å½•æ¸…ç†è¿‡ç¨‹

### DON'Tï¼ˆé¿å…ï¼‰
âŒ ä¸è¦ç›²ç›®ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·
âŒ ä¸è¦åˆ é™¤è¯´æ˜æ€§æ³¨é‡Š
âŒ ä¸è¦è·³è¿‡éªŒè¯æ­¥éª¤
âŒ ä¸è¦ä¸€æ¬¡æ€§ä¿®æ”¹å¤ªå¤šæ–‡ä»¶
âŒ ä¸è¦åœ¨ç”Ÿäº§åˆ†æ”¯ç›´æ¥æ“ä½œ
âŒ ä¸è¦ä¸åˆ›å»ºå¤‡ä»½

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœåœ¨æ¸…ç†è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹è¯¦ç»†ç­–ç•¥**: `cat æ”¹é€ æ–¹æ¡ˆæ–‡æ¡£/æ³¨é‡Šä»£ç æ¸…ç†ç­–ç•¥.md`
2. **è¿è¡Œåˆ†æå·¥å…·**: `bash æ”¹é€ æ–¹æ¡ˆæ–‡æ¡£/æ³¨é‡Šä»£ç æ¸…ç†è„šæœ¬.sh --help`
3. **æ£€æŸ¥éªŒè¯ç»“æœ**: `tail -n 50 æ”¹é€ æ–¹æ¡ˆæ–‡æ¡£/typecheck-result.log`
4. **å›æ»šæ”¹åŠ¨**: `git checkout HEAD -- <file>` æˆ– `git reset --hard`

---

## ğŸ“ é™„å½•: å¿«é€Ÿå‘½ä»¤å‚è€ƒå¡

```bash
# === åˆ†æé˜¶æ®µ ===
bash æ”¹é€ æ–¹æ¡ˆæ–‡æ¡£/æ³¨é‡Šä»£ç æ¸…ç†è„šæœ¬.sh           # å®Œæ•´åˆ†æ
git diff HEAD --stat                              # æŸ¥çœ‹æ”¹åŠ¨ç»Ÿè®¡

# === æ¸…ç†é˜¶æ®µ ===
git checkout -b cleanup-commented-code-$(date +%Y%m%d)  # åˆ›å»ºåˆ†æ”¯
# æ‰‹åŠ¨ç¼–è¾‘æ–‡ä»¶åˆ é™¤æ³¨é‡Š...
git add -p                                        # æš‚å­˜éƒ¨åˆ†æ”¹åŠ¨
git commit -m "refactor: æ¸…ç†æ³¨é‡Šä»£ç  - é˜¶æ®µ1"   # æäº¤æ”¹åŠ¨

# === éªŒè¯é˜¶æ®µ ===
pnpm typecheck                                    # ç±»å‹æ£€æŸ¥
pnpm lint                                         # ä»£ç æ£€æŸ¥
pnpm build > build.log 2>&1                       # æ„å»º
pnpm test:affected                                # è¿è¡Œæµ‹è¯•

# === ç´§æ€¥å›æ»š ===
git checkout HEAD -- <file>                       # æ¢å¤å•ä¸ªæ–‡ä»¶
git reset --hard HEAD                             # æ¢å¤æ‰€æœ‰æ”¹åŠ¨ï¼ˆå±é™©ï¼‰
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-10
**é¢„è®¡æ¸…ç†æ—¶é—´**: 6-9 å°æ—¶ï¼ˆåˆ† 3 å¤©ï¼‰
**é¢„æœŸåˆ é™¤**: 200-250 è¡Œæ— ç”¨æ³¨é‡Š
**é¢„æœŸä¿ç•™**: 70-80 è¡Œæœ‰ä»·å€¼æ³¨é‡Š
