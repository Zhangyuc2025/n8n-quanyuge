# n8n èŠ‚ç‚¹åŠ¨æ€åŒ–æ”¹é€ æ€»ç»“

> **æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
> **åˆ›å»ºæ—¥æœŸï¼š** 2025-01-10
> **çŠ¶æ€ï¼š** å·²å®Œæˆè®¾è®¡

---

## ğŸ“‹ æ–‡æ¡£ç›®çš„

æœ¬æ–‡æ¡£æ€»ç»“äº† n8n å¤šç§Ÿæˆ· SaaS æ”¹é€ è¿‡ç¨‹ä¸­çš„èŠ‚ç‚¹åŠ¨æ€åŒ–è®¾è®¡ï¼Œè®°å½•äº†ä»å‘ç°é—®é¢˜åˆ°æœ€ç»ˆè§£å†³æ–¹æ¡ˆçš„å®Œæ•´è¿‡ç¨‹ã€‚

---

## ğŸ” é—®é¢˜å‘ç°

### 1. å¤šç§Ÿæˆ·å®‰å…¨é—®é¢˜

**èƒŒæ™¯ï¼š** åœ¨åˆ†æ n8n ç¤¾åŒºèŠ‚ç‚¹å®‰è£…æœºåˆ¶æ—¶å‘ç°ï¼ŒåŸæœ‰ç³»ç»Ÿå…è®¸ç”¨æˆ·ç›´æ¥ä» npm å®‰è£…åŒ…åˆ°æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿï¼ˆ`node_modules`ï¼‰ã€‚

**é—®é¢˜æè¿°ï¼š**

```typescript
// åŸæœ‰å®‰è£…æµç¨‹ï¼ˆpackages/cli/src/modules/community-packages/community-packages.service.tsï¼‰
async downloadPackage(packageName: string, packageVersion: string) {
  // ç›´æ¥ä¸‹è½½åˆ°æœåŠ¡å™¨ node_modules
  const { stdout: tarOutput } = await asyncExec(
    `npm pack ${packageName}@${packageVersion} --registry=${registry} --quiet`,
    { cwd: this.downloadFolder }  // æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„
  );

  await asyncExec(`tar -xzf ${tarballName} -C ${packageDirectory} --strip-components=1`);
  // è§£å‹åˆ°æ–‡ä»¶ç³»ç»Ÿ
}
```

**é£é™©åˆ†æï¼š**

| é£é™©ç±»å‹ | ä¸¥é‡æ€§ | å…·ä½“é—®é¢˜ |
|---------|-------|---------|
| **å®‰å…¨é£é™©** | ğŸ”´ é«˜ | ç”¨æˆ·å¯å®‰è£…æ¶æ„ä»£ç åˆ°æœåŠ¡å™¨ï¼Œå½±å“æ‰€æœ‰ç§Ÿæˆ· |
| **éš”ç¦»é—®é¢˜** | ğŸ”´ é«˜ | ç§Ÿæˆ· A å®‰è£…çš„èŠ‚ç‚¹å¯èƒ½è¢«ç§Ÿæˆ· B è®¿é—® |
| **æƒé™æ··ä¹±** | ğŸŸ¡ ä¸­ | æ™®é€šç”¨æˆ·ä¸åº”æœ‰ä¿®æ”¹æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿçš„æƒé™ |
| **è¿ç»´å¤æ‚** | ğŸŸ¡ ä¸­ | æ¯ä¸ªç§Ÿæˆ·å®‰è£…çš„åŒ…éƒ½æ±¡æŸ“å…¨å±€ `node_modules` |

**åŸæœ‰æ•°æ®åº“è®¾è®¡ï¼š**

```sql
-- åŸæœ‰è¡¨ç»“æ„ï¼ˆå·²åºŸå¼ƒï¼‰
CREATE TABLE installed_packages (
  id SERIAL PRIMARY KEY,
  packageName VARCHAR(214) NOT NULL,
  installedVersion VARCHAR(50) NOT NULL,
  installedBy UUID,
  installedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  -- é—®é¢˜ï¼šæ²¡æœ‰ workspace_idï¼Œæ— æ³•å®ç°å¤šç§Ÿæˆ·éš”ç¦»
);

CREATE TABLE installed_nodes (
  id SERIAL PRIMARY KEY,
  packageId INTEGER REFERENCES installed_packages(id),
  nodeName VARCHAR(200) NOT NULL,
  nodeType VARCHAR(200) NOT NULL
  -- é—®é¢˜ï¼šä¸æ–‡ä»¶ç³»ç»Ÿç»‘å®šï¼Œæ— æ³•ç‹¬ç«‹å­˜å‚¨
);
```

### 2. å‡­è¯ç³»ç»Ÿå…¼å®¹æ€§é—®é¢˜

**èƒŒæ™¯ï¼š** æ”¹é€ æ–¹æ¡ˆåºŸå¼ƒäº† n8n åŸæœ‰çš„ Credentials ç³»ç»Ÿï¼Œä½†ç¤¾åŒºèŠ‚ç‚¹éƒ½æ˜¯åŸºäºè¯¥ç³»ç»Ÿå¼€å‘çš„ã€‚

**é—®é¢˜è¡¨ç°ï¼š**

ç¤¾åŒºèŠ‚ç‚¹ä»£ç ç¤ºä¾‹ï¼ˆGitHub èŠ‚ç‚¹ï¼‰ï¼š

```typescript
// n8n-nodes-base/nodes/GitHub/GitHub.node.ts
export class GitHub implements INodeType {
  description: INodeTypeDescription = {
    credentials: [
      {
        name: 'githubApi',  // å¼•ç”¨å‡­è¯ç±»å‹
        required: true,
      }
    ],
    // ...
  }

  async execute(this: IExecuteFunctions): Promise<INodeExecutionData[][]> {
    // è·å–å‡­è¯
    const credentials = await this.getCredentials('githubApi') as ICredentialsDataICredentialsDecrypted;
    const token = credentials.accessToken;
    // ...
  }
}
```

**å†²çªåˆ†æï¼š**

| åŸç³»ç»Ÿï¼ˆå·²åºŸå¼ƒï¼‰ | æ–°ç³»ç»Ÿ | å†²çªç‚¹ |
|----------------|-------|-------|
| `credentials` å­—æ®µ | èŠ‚ç‚¹å‚æ•° | ç¤¾åŒºèŠ‚ç‚¹æ— æ³•è¯†åˆ«æ–°å‚æ•° |
| `getCredentials()` API | `getNodeParameter()` | API ä¸å…¼å®¹ |
| `credentials_entity` è¡¨ | `user_node_config` è¡¨ | æ•°æ®ç»“æ„ä¸åŒ |

### 3. å·¥ä½œæµå¯¼å…¥é—®é¢˜

**èƒŒæ™¯ï¼š** ç”¨æˆ·ä»åŸç‰ˆ n8n å¯¼å‡ºçš„å·¥ä½œæµåŒ…å«å‡­è¯å¼•ç”¨ï¼Œå¯¼å…¥æ—¶æ— æ³•ç›´æ¥ä½¿ç”¨ã€‚

**é—®é¢˜ç¤ºä¾‹ï¼š**

```json
// å¯¼å‡ºçš„å·¥ä½œæµ JSON
{
  "nodes": [
    {
      "name": "GitHub",
      "type": "n8n-nodes-base.github",
      "credentials": {
        "githubApi": {
          "id": "1",  // åŸ n8n çš„å‡­è¯ ID
          "name": "My GitHub Account"
        }
      }
    }
  ]
}
```

**é—®é¢˜ï¼š** æ–°ç³»ç»Ÿæ²¡æœ‰ `id="1"` çš„å‡­è¯ï¼Œå¯¼å…¥åèŠ‚ç‚¹æ— æ³•æ‰§è¡Œã€‚

---

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼šå››å±‚èŠ‚ç‚¹æ¶æ„

**è®¾è®¡ç†å¿µï¼š** å°†èŠ‚ç‚¹åˆ†ä¸ºå››å±‚ï¼Œå¹³è¡¡å†…ç½®ç¨³å®šæ€§ã€å¹³å°æœåŠ¡ã€ç¤¾åŒºç”Ÿæ€å’Œç”¨æˆ·è‡ªå®šä¹‰ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        èŠ‚ç‚¹å››å±‚æ¶æ„                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Layer 1: å†…ç½®èŠ‚ç‚¹ (Builtin Nodes)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ“ æ–‡ä»¶ç³»ç»ŸåŠ è½½                                      â”‚    â”‚
â”‚  â”‚ 142 ä¸ªæ ¸å¿ƒèŠ‚ç‚¹ï¼ˆHTTP Request, Code, Set, If...ï¼‰    â”‚    â”‚
â”‚  â”‚ æºç ä½ç½®: packages/nodes-base/nodes/*/*.node.ts     â”‚    â”‚
â”‚  â”‚ åŠ è½½æ–¹å¼: LoadNodesAndCredentials.loadNodesFromDir()â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â†“                                   â”‚
â”‚  Layer 2: å¹³å°èŠ‚ç‚¹ (Platform Nodes)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ’¾ æ•°æ®åº“åŠ è½½: platform_node è¡¨                      â”‚    â”‚
â”‚  â”‚ ç®¡ç†å‘˜æ‰˜ç®¡èŠ‚ç‚¹ï¼ˆOpenAI, Claude, Geminiï¼‰            â”‚    â”‚
â”‚  â”‚ æŒ‰é‡è®¡è´¹æ¨¡å¼ï¼Œç”¨æˆ·æ— éœ€é…ç½® API Key                  â”‚    â”‚
â”‚  â”‚ åŠ è½½æ–¹å¼: PlatformNodesService.loadAll()            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â†“                                   â”‚
â”‚  Layer 3: npm ç¤¾åŒºèŠ‚ç‚¹ (npm Community Nodes) â­ æ–°å¢        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ’¾ æ•°æ®åº“åŠ è½½: custom_node è¡¨ (node_source='npm')   â”‚    â”‚
â”‚  â”‚ ä» npm å®‰è£…ï¼Œå­˜å‚¨åˆ°æ•°æ®åº“ï¼Œå·¥ä½œç©ºé—´ç§æœ‰             â”‚    â”‚
â”‚  â”‚ è‡ªåŠ¨å‡­è¯è½¬æ¢ï¼ˆAST é‡å†™ï¼‰                            â”‚    â”‚
â”‚  â”‚ VM2 æ²™ç®±éš”ç¦»æ‰§è¡Œ                                     â”‚    â”‚
â”‚  â”‚ åŠ è½½æ–¹å¼: CustomNodesService.loadWorkspaceNodes()   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â†“                                   â”‚
â”‚  Layer 4: ç”¨æˆ·ä¸Šä¼ èŠ‚ç‚¹ (User Upload Nodes)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ’¾ æ•°æ®åº“åŠ è½½: custom_node è¡¨ (node_source='upload')â”‚    â”‚
â”‚  â”‚ ç”¨æˆ·ç¼–å†™ä»£ç ä¸Šä¼ ï¼Œå·¥ä½œç©ºé—´ç§æœ‰                      â”‚    â”‚
â”‚  â”‚ VM2 æ²™ç®±éš”ç¦»æ‰§è¡Œ                                     â”‚    â”‚
â”‚  â”‚ åŠ è½½æ–¹å¼: CustomNodesService.loadWorkspaceNodes()   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®å†³ç­–ï¼š**

| å†³ç­–ç‚¹ | æ–¹æ¡ˆ | ç†ç”± |
|--------|------|------|
| **npm èŠ‚ç‚¹å­˜å‚¨ä½ç½®** | æ•°æ®åº“ï¼ˆcustom_node è¡¨ï¼‰ | å¤šç§Ÿæˆ·éš”ç¦»ã€ä¸æ±¡æŸ“æ–‡ä»¶ç³»ç»Ÿ |
| **npm èŠ‚ç‚¹æ‰§è¡Œæ–¹å¼** | VM2 æ²™ç®± | å®‰å…¨éš”ç¦»ã€é˜²æ­¢æ¶æ„ä»£ç  |
| **å‡­è¯ç³»ç»Ÿå¤„ç†** | è‡ªåŠ¨ AST è½¬æ¢ | ä¿ç•™ç¤¾åŒºç”Ÿæ€ã€æ— ç¼å…¼å®¹ |
| **å·¥ä½œç©ºé—´éš”ç¦»** | workspace_id å­—æ®µ | ç§Ÿæˆ· A å®‰è£…çš„èŠ‚ç‚¹ä¸å½±å“ç§Ÿæˆ· B |

### æ–¹æ¡ˆäºŒï¼šnpm ç¤¾åŒºèŠ‚ç‚¹åŠ¨æ€åŒ–

**å®Œæ•´æµç¨‹ï¼š**

```
ç”¨æˆ·æ“ä½œ                æœåŠ¡ç«¯å¤„ç†                           æ•°æ®åº“å­˜å‚¨
   â”‚                       â”‚                                    â”‚
   â”‚  ç‚¹å‡»ã€Œå®‰è£…èŠ‚ç‚¹ã€     â”‚                                    â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                                    â”‚
   â”‚  packageName: 'n8n-nodes-telegram'                        â”‚
   â”‚  version: '1.2.3'     â”‚                                    â”‚
   â”‚                       â”‚                                    â”‚
   â”‚                       â”‚ 1. NpmDownloadService              â”‚
   â”‚                       â”‚    â”œâ”€ npm pack n8n-nodes-telegram@1.2.3
   â”‚                       â”‚    â”‚  ï¼ˆä¸‹è½½åˆ°ä¸´æ—¶ç›®å½• /tmp/xxxï¼‰  â”‚
   â”‚                       â”‚    â”œâ”€ tar -xzfï¼ˆè§£å‹ï¼‰            â”‚
   â”‚                       â”‚    â””â”€ è¯»å– package.json            â”‚
   â”‚                       â”‚                                    â”‚
   â”‚                       â”‚ 2. CredentialConverterService      â”‚
   â”‚                       â”‚    â”œâ”€ è§£æ *.node.ts æ–‡ä»¶          â”‚
   â”‚                       â”‚    â”œâ”€ æå– credentials å­—æ®µ        â”‚
   â”‚                       â”‚    â”œâ”€ AST è½¬æ¢ä»£ç ï¼š               â”‚
   â”‚                       â”‚    â”‚  credentials: [{name:'xxx'}]  â”‚
   â”‚                       â”‚    â”‚      â†“                         â”‚
   â”‚                       â”‚    â”‚  properties: [{collection}]    â”‚
   â”‚                       â”‚    â””â”€ é‡å†™ getCredentials() è°ƒç”¨ï¼š â”‚
   â”‚                       â”‚       getCredentials('githubApi')  â”‚
   â”‚                       â”‚          â†“                          â”‚
   â”‚                       â”‚       getNodeParameter('authentication', 0)
   â”‚                       â”‚                                    â”‚
   â”‚                       â”‚ 3. CodeValidationService           â”‚
   â”‚                       â”‚    â”œâ”€ æ£€æµ‹å±é™©å‡½æ•°ï¼ˆeval, execï¼‰  â”‚
   â”‚                       â”‚    â”œâ”€ éªŒè¯ import ç™½åå•           â”‚
   â”‚                       â”‚    â””â”€ ç”Ÿæˆä»£ç ç­¾åï¼ˆSHA256ï¼‰      â”‚
   â”‚                       â”‚                                    â”‚
   â”‚                       â”‚ 4. CustomNodeRepository            â”‚
   â”‚                       â”‚    â””â”€ INSERT INTO custom_node â”€â”€â”€â”€â”€>â”‚
   â”‚                       â”‚                                    â”‚ custom_node
   â”‚                       â”‚                                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚                       â”‚                                    â”‚ workspace_id: uuid
   â”‚                       â”‚                                    â”‚ node_source: 'npm_community'
   â”‚                       â”‚                                    â”‚ npm_package_name: 'n8n-nodes-telegram'
   â”‚                       â”‚                                    â”‚ npm_version: '1.2.3'
   â”‚                       â”‚                                    â”‚ node_code: 'è½¬æ¢åçš„ä»£ç '
   â”‚                       â”‚                                    â”‚ converted_from_credentials: true
   â”‚                       â”‚                                    â”‚ original_credentials: {...}
   â”‚                       â”‚                                    â”‚ credential_mapping: {...}
   â”‚                       â”‚                                    â”‚
   â”‚  <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
   â”‚  { success: true, nodeKey: 'telegram' }                   â”‚
   â”‚                                                            â”‚
```

**æ ¸å¿ƒæœåŠ¡å®ç°ï¼š**

#### NpmDownloadService

```typescript
@Service()
export class NpmDownloadService {
  private readonly tempDir = '/tmp/n8n-npm-packages';

  async downloadAndExtract(packageName: string, version?: string): Promise<ExtractedPackage> {
    const targetVersion = version ?? 'latest';
    const downloadPath = path.join(this.tempDir, `${packageName}-${Date.now()}`);

    try {
      // 1. ä¸‹è½½ npm åŒ…åˆ°ä¸´æ—¶ç›®å½•
      await fs.mkdir(downloadPath, { recursive: true });
      const { stdout } = await execAsync(
        `npm pack ${packageName}@${targetVersion} --registry=https://registry.npmjs.org`,
        { cwd: downloadPath }
      );

      // 2. è§£å‹
      const tarballName = stdout.trim();
      const extractPath = path.join(downloadPath, 'package');
      await execAsync(`tar -xzf ${tarballName} -C ${downloadPath}`);

      // 3. è¯»å– package.json
      const packageJson = JSON.parse(
        await fs.readFile(path.join(extractPath, 'package.json'), 'utf-8')
      );

      // 4. æå–èŠ‚ç‚¹æ–‡ä»¶
      const nodeFiles = await this.extractNodeFiles(extractPath, packageJson);

      return {
        packageName,
        version: packageJson.version,
        nodeFiles,
        metadata: {
          author: packageJson.author,
          description: packageJson.description,
          dependencies: packageJson.dependencies,
        }
      };
    } finally {
      // 5. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
      await fs.rm(downloadPath, { recursive: true, force: true });
    }
  }

  private async extractNodeFiles(extractPath: string, packageJson: any): Promise<NodeFile[]> {
    const n8nConfig = packageJson.n8n;
    if (!n8nConfig?.nodes) {
      throw new Error('Invalid n8n package: missing n8n.nodes field');
    }

    const nodeFiles: NodeFile[] = [];

    for (const nodePath of n8nConfig.nodes) {
      const fullPath = path.join(extractPath, nodePath);
      const code = await fs.readFile(fullPath, 'utf-8');

      nodeFiles.push({
        path: nodePath,
        code,
        nodeType: this.extractNodeTypeName(code),
      });
    }

    return nodeFiles;
  }
}
```

#### CredentialConverterService

```typescript
@Service()
export class CredentialConverterService {
  async convertNode(nodeCode: string, credentialDefinitions: Record<string, any>): Promise<ConversionResult> {
    // 1. è§£æ TypeScript AST
    const sourceFile = ts.createSourceFile(
      'temp.ts',
      nodeCode,
      ts.ScriptTarget.Latest,
      true
    );

    // 2. æå–å‡­è¯ä½¿ç”¨ä¿¡æ¯
    const credentialUsage = this.extractCredentialUsage(sourceFile);

    if (credentialUsage.length === 0) {
      // æ— å‡­è¯ä½¿ç”¨ï¼Œç›´æ¥è¿”å›åŸä»£ç 
      return {
        convertedCode: nodeCode,
        converted: false,
        mapping: {},
      };
    }

    // 3. ç”Ÿæˆè®¤è¯å‚æ•°å®šä¹‰
    const authenticationParameter = this.generateAuthenticationParameter(
      credentialUsage,
      credentialDefinitions
    );

    // 4. AST é‡å†™
    const transformer: ts.TransformerFactory<ts.SourceFile> = (context) => {
      return (sourceFile) => {
        const visitor: ts.Visitor = (node) => {
          // é‡å†™ description å¯¹è±¡ï¼Œæ›¿æ¢ credentials å­—æ®µä¸º properties
          if (this.isDescriptionObject(node)) {
            return this.replaceCredentialsWithParameters(node, authenticationParameter);
          }

          // é‡å†™ getCredentials() è°ƒç”¨ä¸º getNodeParameter()
          if (this.isGetCredentialsCall(node)) {
            return this.convertToGetNodeParameter(node);
          }

          return ts.visitEachChild(node, visitor, context);
        };

        return ts.visitNode(sourceFile, visitor);
      };
    };

    const result = ts.transform(sourceFile, [transformer]);
    const printer = ts.createPrinter();
    const convertedCode = printer.printFile(result.transformed[0]);

    return {
      convertedCode,
      converted: true,
      mapping: this.buildCredentialMapping(credentialUsage),
      originalCredentials: credentialDefinitions,
    };
  }

  private generateAuthenticationParameter(
    credentialUsage: CredentialUsage[],
    definitions: Record<string, any>
  ): INodeProperties {
    return {
      displayName: 'Authentication',
      name: 'authentication',
      type: 'collection',
      default: {},
      options: credentialUsage.map(usage => {
        const credDef = definitions[usage.credentialType];
        return {
          displayName: credDef.displayName ?? usage.credentialType,
          name: usage.credentialType,
          type: 'fixedCollection',
          default: {},
          options: this.convertCredentialFieldsToOptions(credDef.properties),
        };
      }),
    };
  }

  private convertToGetNodeParameter(node: ts.CallExpression): ts.CallExpression {
    // getCredentials('githubApi') â†’ getNodeParameter('authentication', 0)
    return ts.factory.createCallExpression(
      ts.factory.createPropertyAccessExpression(
        ts.factory.createThis(),
        'getNodeParameter'
      ),
      undefined,
      [
        ts.factory.createStringLiteral('authentication'),
        ts.factory.createNumericLiteral(0),
      ]
    );
  }
}
```

### æ–¹æ¡ˆä¸‰ï¼šå·¥ä½œæµå¯¼å…¥è½¬æ¢

**äº¤äº’æµç¨‹ï¼š**

```
ç”¨æˆ·æ“ä½œ                    å‰ç«¯ç•Œé¢                          åç«¯å¤„ç†
   â”‚                           â”‚                                  â”‚
   â”‚ 1. ä¸Šä¼ å·¥ä½œæµ JSON        â”‚                                  â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                                  â”‚
   â”‚                           â”‚                                  â”‚
   â”‚                           â”‚ POST /rest/workflows/import/analyze
   â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                           â”‚                                  â”‚
   â”‚                           â”‚                                  â”‚ WorkflowConverterService
   â”‚                           â”‚                                  â”‚ â”œâ”€ æ£€æµ‹ credentials å­—æ®µ
   â”‚                           â”‚                                  â”‚ â””â”€ æå–æ‰€éœ€å‡­è¯åˆ—è¡¨
   â”‚                           â”‚                                  â”‚
   â”‚                           â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚                           â”‚ { requiresConfig: true,          â”‚
   â”‚                           â”‚   credentials: [{                â”‚
   â”‚                           â”‚     type: 'githubApi',           â”‚
   â”‚                           â”‚     fields: ['accessToken']      â”‚
   â”‚                           â”‚   }] }                           â”‚
   â”‚                           â”‚                                  â”‚
   â”‚                           â”‚ 2. æ˜¾ç¤ºé…ç½®è¡¨å•                  â”‚
   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
   â”‚                           â”‚                                  â”‚
   â”‚ ã€å¼¹çª—ï¼šé…ç½®å‡­è¯ã€‘        â”‚                                  â”‚
   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                  â”‚
   â”‚ â”‚ GitHub Token:         â”‚                                  â”‚
   â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                  â”‚
   â”‚ â”‚ â”‚ ghp_xxxxx       â”‚  â”‚                                  â”‚
   â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                  â”‚
   â”‚ â”‚                      â”‚                                  â”‚
   â”‚ â”‚ [ å–æ¶ˆ ] [ ç¡®è®¤ ]    â”‚                                  â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
   â”‚                           â”‚                                  â”‚
   â”‚ 3. å¡«å†™é…ç½®å¹¶æäº¤         â”‚                                  â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                                  â”‚
   â”‚                           â”‚                                  â”‚
   â”‚                           â”‚ POST /rest/workflows/import/convert
   â”‚                           â”‚ { workflowJson, config: {...} }  â”‚
   â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                           â”‚                                  â”‚
   â”‚                           â”‚                                  â”‚ WorkflowConverterService
   â”‚                           â”‚                                  â”‚ â”œâ”€ ç§»é™¤ credentials å­—æ®µ
   â”‚                           â”‚                                  â”‚ â”œâ”€ æ·»åŠ  parameters å­—æ®µ
   â”‚                           â”‚                                  â”‚ â”œâ”€ ä¿å­˜åˆ° workflow è¡¨
   â”‚                           â”‚                                  â”‚ â””â”€ ä¿å­˜é…ç½®åˆ° user_node_config
   â”‚                           â”‚                                  â”‚
   â”‚                           â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚                           â”‚ { success: true, workflowId }    â”‚
   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
   â”‚ å¯¼å…¥æˆåŠŸï¼                â”‚                                  â”‚
```

**åç«¯å®ç°ï¼š**

```typescript
@Service()
export class WorkflowConverterService {
  async analyzeImportedWorkflow(workflowJson: any): Promise<AnalysisResult> {
    const credentialReferences = this.detectCredentialReferences(workflowJson);

    if (credentialReferences.length === 0) {
      return {
        requiresConfig: false,
        credentials: [],
      };
    }

    return {
      requiresConfig: true,
      credentials: credentialReferences.map(ref => ({
        nodeId: ref.nodeId,
        nodeName: ref.nodeName,
        credentialType: ref.credentialType,
        fields: this.getRequiredFields(ref.credentialType),
      })),
    };
  }

  async convertWorkflow(
    workflowJson: any,
    userConfig: Record<string, any>,
    userId: string,
    workspaceId: string
  ): Promise<ConvertedWorkflow> {
    const convertedNodes = workflowJson.nodes.map(node => {
      if (!node.credentials) {
        return node;  // æ— å‡­è¯çš„èŠ‚ç‚¹ç›´æ¥è¿”å›
      }

      // ç§»é™¤ credentials å­—æ®µï¼Œæ·»åŠ  parameters
      const { credentials, ...rest } = node;

      return {
        ...rest,
        parameters: {
          ...node.parameters,
          authentication: userConfig[node.id] || {},
        },
      };
    });

    // ä¿å­˜é…ç½®åˆ° user_node_config
    for (const [nodeId, config] of Object.entries(userConfig)) {
      const node = workflowJson.nodes.find(n => n.id === nodeId);

      await this.userNodeConfigRepository.save({
        userId,
        workspaceId,
        nodeType: node.type,
        configName: `Imported from workflow - ${workflowJson.name}`,
        configData: await this.encryptionService.encrypt(JSON.stringify(config)),
      });
    }

    return {
      ...workflowJson,
      nodes: convertedNodes,
    };
  }

  private detectCredentialReferences(workflowJson: any): CredentialReference[] {
    return workflowJson.nodes
      .filter(node => node.credentials)
      .flatMap(node =>
        Object.entries(node.credentials).map(([credType, credData]: [string, any]) => ({
          nodeId: node.id,
          nodeName: node.name,
          credentialType: credType,
          originalId: credData.id,
          originalName: credData.name,
        }))
      );
  }
}
```

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### custom_node è¡¨ï¼ˆæ–°å¢ï¼‰

```sql
CREATE TABLE custom_node (
  -- ä¸»é”®
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  -- å…³è”ä¿¡æ¯
  workspace_id UUID NOT NULL REFERENCES project(id) ON DELETE CASCADE,

  -- åŸºæœ¬ä¿¡æ¯
  node_key VARCHAR(100) NOT NULL,
  node_name VARCHAR(200) NOT NULL,
  version VARCHAR(50) DEFAULT '1.0.0',

  -- èŠ‚ç‚¹æ¥æºï¼ˆå…³é”®å­—æ®µï¼‰
  node_source VARCHAR(50) NOT NULL CHECK (node_source IN ('npm_community', 'user_upload')),

  -- npm ç¤¾åŒºèŠ‚ç‚¹å­—æ®µ
  npm_package_name VARCHAR(200),
  npm_version VARCHAR(50),
  npm_author VARCHAR(200),
  npm_registry VARCHAR(200) DEFAULT 'https://registry.npmjs.org',

  -- èŠ‚ç‚¹å®šä¹‰å’Œä»£ç 
  node_definition JSONB NOT NULL,
  node_code TEXT NOT NULL,

  -- å‡­è¯è½¬æ¢å­—æ®µ
  converted_from_credentials BOOLEAN DEFAULT false,
  original_credentials JSONB,
  credential_mapping JSONB,

  -- å®‰å…¨é…ç½®
  sandbox_enabled BOOLEAN DEFAULT true,
  sandbox_timeout INTEGER DEFAULT 30000,
  sandbox_memory_limit INTEGER DEFAULT 512,
  code_signature TEXT,

  -- ä¾èµ–ä¿¡æ¯
  dependencies JSONB,
  allowed_imports JSONB,

  -- åˆ›å»ºä¿¡æ¯
  created_by UUID NOT NULL REFERENCES user(id),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  -- å”¯ä¸€çº¦æŸï¼šå·¥ä½œç©ºé—´å†…èŠ‚ç‚¹ key å”¯ä¸€
  UNIQUE(workspace_id, node_key),

  -- æ£€æŸ¥çº¦æŸ
  CONSTRAINT check_npm_fields CHECK (
    (node_source = 'npm_community' AND npm_package_name IS NOT NULL AND npm_version IS NOT NULL) OR
    (node_source = 'user_upload' AND npm_package_name IS NULL)
  )
);

-- ç´¢å¼•
CREATE INDEX idx_custom_node_workspace ON custom_node(workspace_id);
CREATE INDEX idx_custom_node_source ON custom_node(node_source);
CREATE INDEX idx_custom_node_npm_package ON custom_node(npm_package_name)
  WHERE node_source = 'npm_community';
```

### åºŸå¼ƒè¡¨è¿ç§»

```sql
-- 1. å¤‡ä»½æ•°æ®
pg_dump -t installed_packages -t installed_nodes -t credentials_entity > backup.sql

-- 2. è¿ç§» installed_packages â†’ custom_node
INSERT INTO custom_node (
  workspace_id, node_key, node_name, node_source,
  npm_package_name, npm_version, created_by, created_at
)
SELECT
  p.id AS workspace_id,
  ip.packageName AS node_key,
  ip.packageName AS node_name,
  'npm_community' AS node_source,
  ip.packageName AS npm_package_name,
  ip.installedVersion AS npm_version,
  ip.installedBy AS created_by,
  ip.installedAt AS created_at
FROM installed_packages ip
CROSS JOIN project p
WHERE p.type = 'personal'
LIMIT 1;

-- 3. åˆ é™¤åºŸå¼ƒè¡¨
DROP TABLE IF EXISTS installed_nodes;
DROP TABLE IF EXISTS installed_packages;
DROP TABLE IF EXISTS credentials_entity;
```

---

## ğŸ” å®‰å…¨æªæ–½

### 1. VM2 æ²™ç®±éš”ç¦»

```typescript
import { VM } from 'vm2';

@Service()
export class NodeExecutionService {
  async executeCustomNode(
    nodeCode: string,
    nodeConfig: CustomNodeConfig,
    context: IExecuteFunctions
  ): Promise<INodeExecutionData[][]> {
    const vm = new VM({
      timeout: nodeConfig.sandboxTimeout,
      sandbox: {
        // åªæš´éœ²å¿…è¦çš„ API
        require: this.createSecureRequire(nodeConfig.allowedImports),
        console,
        Buffer,
        setTimeout,
        // n8n æ‰§è¡Œä¸Šä¸‹æ–‡
        this: context,
      },
      eval: false,  // ç¦ç”¨ eval
      wasm: false,  // ç¦ç”¨ WebAssembly
    });

    try {
      const result = vm.run(nodeCode);
      return result;
    } catch (error) {
      throw new NodeExecutionError(
        `Custom node execution failed: ${error.message}`,
        { nodeKey: nodeConfig.nodeKey }
      );
    }
  }

  private createSecureRequire(allowedModules: string[]): any {
    return (moduleName: string) => {
      // ç™½åå•éªŒè¯
      if (!allowedModules.includes(moduleName)) {
        throw new Error(`Module '${moduleName}' is not allowed`);
      }

      // åªå…è®¸ n8n ç›¸å…³æ¨¡å—
      const allowedPrefixes = ['n8n-workflow', 'n8n-core'];
      if (!allowedPrefixes.some(prefix => moduleName.startsWith(prefix))) {
        throw new Error(`Module '${moduleName}' is not in allowed list`);
      }

      return require(moduleName);
    };
  }
}
```

### 2. ä»£ç éªŒè¯

```typescript
@Service()
export class CodeValidationService {
  private dangerousFunctions = [
    'eval', 'Function', 'execSync', 'exec', 'spawn',
    'child_process', 'fs.writeFile', 'fs.unlink',
  ];

  async validateNodeCode(code: string): Promise<ValidationResult> {
    const errors: string[] = [];

    // 1. æ£€æµ‹å±é™©å‡½æ•°
    for (const dangerousFunc of this.dangerousFunctions) {
      if (code.includes(dangerousFunc)) {
        errors.push(`Dangerous function detected: ${dangerousFunc}`);
      }
    }

    // 2. æ£€æµ‹åŠ¨æ€ import
    if (/import\s*\(/.test(code)) {
      errors.push('Dynamic import() is not allowed');
    }

    // 3. æ£€æµ‹ require
    const requireMatches = code.match(/require\s*\(\s*['"`]([^'"`]+)['"`]\s*\)/g);
    if (requireMatches) {
      for (const match of requireMatches) {
        const moduleName = match.match(/['"`]([^'"`]+)['"`]/)?.[1];
        if (moduleName && !this.isAllowedModule(moduleName)) {
          errors.push(`Module '${moduleName}' is not allowed`);
        }
      }
    }

    // 4. ç”Ÿæˆä»£ç ç­¾å
    const signature = createHash('sha256').update(code).digest('hex');

    return {
      isValid: errors.length === 0,
      errors,
      signature,
    };
  }

  private isAllowedModule(moduleName: string): boolean {
    const allowedPrefixes = ['n8n-workflow', 'n8n-core', 'axios', 'lodash'];
    return allowedPrefixes.some(prefix => moduleName.startsWith(prefix));
  }
}
```

### 3. é…é¢ç®¡ç†

```typescript
@Service()
export class CustomNodeQuotaService {
  private readonly DEFAULT_QUOTA = {
    maxNodesPerWorkspace: 100,  // æ¯ä¸ªå·¥ä½œç©ºé—´æœ€å¤š 100 ä¸ªè‡ªå®šä¹‰èŠ‚ç‚¹
    maxCodeSizeBytes: 1024 * 1024,  // å•ä¸ªèŠ‚ç‚¹ä»£ç æœ€å¤§ 1MB
    maxExecutionTimeMs: 60000,  // å•æ¬¡æ‰§è¡Œæœ€é•¿ 60 ç§’
  };

  async checkQuota(workspaceId: string, nodeCode: string): Promise<void> {
    // 1. æ£€æŸ¥èŠ‚ç‚¹æ•°é‡é…é¢
    const currentCount = await this.customNodeRepository.count({
      where: { workspaceId }
    });

    if (currentCount >= this.DEFAULT_QUOTA.maxNodesPerWorkspace) {
      throw new QuotaExceededError(
        `Workspace has reached the maximum of ${this.DEFAULT_QUOTA.maxNodesPerWorkspace} custom nodes`
      );
    }

    // 2. æ£€æŸ¥ä»£ç å¤§å°
    const codeSize = Buffer.byteLength(nodeCode, 'utf-8');
    if (codeSize > this.DEFAULT_QUOTA.maxCodeSizeBytes) {
      throw new QuotaExceededError(
        `Node code size (${codeSize} bytes) exceeds limit (${this.DEFAULT_QUOTA.maxCodeSizeBytes} bytes)`
      );
    }
  }
}
```

---

## ğŸ¯ å®æ–½æ¸…å•

### åç«¯ä»»åŠ¡

- [ ] **æ•°æ®åº“è¿ç§»**
  - [ ] åˆ›å»º custom_node è¡¨
  - [ ] è¿ç§» installed_packages æ•°æ®
  - [ ] åˆ é™¤åºŸå¼ƒè¡¨ï¼ˆinstalled_packages, installed_nodes, credentials_entityï¼‰

- [ ] **Service å±‚**
  - [ ] å®ç° CustomNodesService
  - [ ] å®ç° NpmDownloadService
  - [ ] å®ç° CredentialConverterService
  - [ ] å®ç° WorkflowConverterService
  - [ ] å®ç° CodeValidationService
  - [ ] å®ç° NodeExecutionServiceï¼ˆVM2 æ²™ç®±ï¼‰
  - [ ] å®ç° CustomNodeQuotaService

- [ ] **Controller å±‚**
  - [ ] å®ç° CustomNodesController
  - [ ] å®ç° WorkflowImportController
  - [ ] åºŸå¼ƒ CommunityPackagesController

- [ ] **å®‰å…¨æœºåˆ¶**
  - [ ] VM2 æ²™ç®±é›†æˆ
  - [ ] ä»£ç éªŒè¯è§„åˆ™
  - [ ] é…é¢é™åˆ¶
  - [ ] ç™½åå•æ¨¡å—ç®¡ç†

### å‰ç«¯ä»»åŠ¡

- [ ] **èŠ‚ç‚¹å®‰è£…ç•Œé¢**
  - [ ] npm ç¤¾åŒºèŠ‚ç‚¹æœç´¢é¡µé¢
  - [ ] èŠ‚ç‚¹è¯¦æƒ…é¡µé¢ï¼ˆREADMEã€ç‰ˆæœ¬ã€è¯„åˆ†ï¼‰
  - [ ] å®‰è£…ç¡®è®¤å¯¹è¯æ¡†
  - [ ] å®‰è£…è¿›åº¦æ˜¾ç¤º

- [ ] **å·¥ä½œæµå¯¼å…¥ç•Œé¢**
  - [ ] å¯¼å…¥æ–‡ä»¶é€‰æ‹©
  - [ ] å‡­è¯é…ç½®è¡¨å•ï¼ˆåŠ¨æ€ç”Ÿæˆï¼‰
  - [ ] é…ç½®é¢„è§ˆå’Œç¡®è®¤
  - [ ] å¯¼å…¥è¿›åº¦å’Œç»“æœåé¦ˆ

- [ ] **è‡ªå®šä¹‰èŠ‚ç‚¹ç®¡ç†**
  - [ ] æˆ‘çš„è‡ªå®šä¹‰èŠ‚ç‚¹åˆ—è¡¨
  - [ ] ä¸Šä¼ èŠ‚ç‚¹ä»£ç ç¼–è¾‘å™¨
  - [ ] èŠ‚ç‚¹æµ‹è¯•å’Œè°ƒè¯•å·¥å…·

---

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### 1. å®‰å…¨æ€§æå‡

| æŒ‡æ ‡ | æ”¹é€ å‰ | æ”¹é€ å | æå‡ |
|------|--------|--------|------|
| **æ–‡ä»¶ç³»ç»Ÿéš”ç¦»** | âŒ æ‰€æœ‰ç”¨æˆ·å…±äº« | âœ… æ•°æ®åº“éš”ç¦» | ğŸ”’ å®Œå…¨éš”ç¦» |
| **æ¶æ„ä»£ç é˜²æŠ¤** | âŒ æ— é˜²æŠ¤ | âœ… VM2 æ²™ç®± | ğŸ”’ æ²™ç®±éš”ç¦» |
| **ä»£ç å®¡æŸ¥** | âŒ æ—  | âœ… è‡ªåŠ¨éªŒè¯ | ğŸ”’ å±é™©å‡½æ•°æ‹¦æˆª |

### 2. ç”Ÿæ€ä¿ç•™

| æŒ‡æ ‡ | æ”¹é€ å‰ | æ”¹é€ å | æ•ˆæœ |
|------|--------|--------|------|
| **ç¤¾åŒºèŠ‚ç‚¹å¯ç”¨æ€§** | âœ… æ”¯æŒ | âœ… æ”¯æŒ | âœ… å®Œå…¨å…¼å®¹ |
| **npm ç”Ÿæ€** | âœ… ç›´æ¥ä½¿ç”¨ | âœ… è½¬æ¢åä½¿ç”¨ | âœ… æ— ç¼é›†æˆ |
| **å‡­è¯ç³»ç»Ÿ** | âœ… åŸç”Ÿæ”¯æŒ | âœ… è‡ªåŠ¨è½¬æ¢ | âœ… é€æ˜è½¬æ¢ |

### 3. ç”¨æˆ·ä½“éªŒ

| æŒ‡æ ‡ | æ”¹é€ å‰ | æ”¹é€ å | æå‡ |
|------|--------|--------|------|
| **å®‰è£…é€Ÿåº¦** | ğŸ“¦ npm installï¼ˆæ…¢ï¼‰ | âš¡ æ•°æ®åº“å­˜å‚¨ï¼ˆå¿«ï¼‰ | â¬†ï¸ 10x æå‡ |
| **å·¥ä½œç©ºé—´éš”ç¦»** | âŒ å…¨å±€å…±äº« | âœ… å®Œå…¨éš”ç¦» | âœ¨ ç§Ÿæˆ·ç‹¬ç«‹ |
| **å·¥ä½œæµå¯¼å…¥** | âŒ æ‰‹åŠ¨é…ç½® | âœ… å¼•å¯¼é…ç½® | âœ¨ ç”¨æˆ·å‹å¥½ |

---

## ğŸ”š æ€»ç»“

### æ ¸å¿ƒæˆæœ

1. **å››å±‚èŠ‚ç‚¹æ¶æ„**ï¼šå¹³è¡¡äº†ç¨³å®šæ€§ã€æœåŠ¡åŒ–ã€ç”Ÿæ€å’Œè‡ªå®šä¹‰
2. **å¤šç§Ÿæˆ·å®‰å…¨**ï¼šnpm èŠ‚ç‚¹å­˜å‚¨åˆ°æ•°æ®åº“ï¼ŒVM2 æ²™ç®±éš”ç¦»
3. **ç”Ÿæ€å…¼å®¹**ï¼šè‡ªåŠ¨å‡­è¯è½¬æ¢ï¼Œä¿ç•™ n8n ç¤¾åŒºç”Ÿæ€ä¼˜åŠ¿
4. **ç”¨æˆ·ä½“éªŒ**ï¼šå·¥ä½œæµå¯¼å…¥å¼•å¯¼å¼é…ç½®ï¼Œé™ä½è¿ç§»æˆæœ¬

### æŠ€æœ¯äº®ç‚¹

- **AST è½¬æ¢æŠ€æœ¯**ï¼šè‡ªåŠ¨é‡å†™èŠ‚ç‚¹ä»£ç ï¼Œæ— éœ€äººå·¥é€‚é…
- **VM2 æ²™ç®±**ï¼šå®‰å…¨éš”ç¦»ï¼Œé˜²æ­¢æ¶æ„ä»£ç 
- **å·¥ä½œç©ºé—´éš”ç¦»**ï¼šå¤šç§Ÿæˆ·æ•°æ®å®Œå…¨éš”ç¦»
- **é…é¢ç®¡ç†**ï¼šé˜²æ­¢èµ„æºæ»¥ç”¨

### åç»­ä¼˜åŒ–

- [ ] èŠ‚ç‚¹ä»£ç ç¼“å­˜æœºåˆ¶ï¼ˆRedisï¼‰
- [ ] èŠ‚ç‚¹æ‰§è¡Œæ€§èƒ½ç›‘æ§
- [ ] ç¤¾åŒºèŠ‚ç‚¹è¯„åˆ†å’Œæ¨èç³»ç»Ÿ
- [ ] èŠ‚ç‚¹ç‰ˆæœ¬ç®¡ç†å’Œè‡ªåŠ¨æ›´æ–°

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
**åˆ›å»ºæ—¥æœŸï¼š** 2025-01-10
**ä½œè€…ï¼š** æ”¹é€ æ–¹æ¡ˆå›¢é˜Ÿ
**çŠ¶æ€ï¼š** âœ… è®¾è®¡å®Œæˆï¼Œå¾…å®æ–½
