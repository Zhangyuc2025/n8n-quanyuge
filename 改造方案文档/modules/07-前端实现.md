# å‰ç«¯å®ç°

> **ç‰ˆæœ¬ï¼š** v1.0
> **çŠ¶æ€ï¼š** è®¾è®¡ä¸­

[â† è¿”å›æ€»è§ˆ](../00-æ€»è§ˆä¸å¯¼èˆª.md)

---

## ğŸ¨ å‰ç«¯å®ç°

### èŠ‚ç‚¹é€‰æ‹©å™¨æ”¹é€ 

**æ–‡ä»¶ï¼š** `packages/editor-ui/src/components/Node/NodeCreator/NodeCreator.vue`

```vue
<template>
  <div class="node-creator">
    <!-- æœç´¢æ¡† -->
    <div class="node-creator-search">
      <n8n-input
        v-model="searchQuery"
        placeholder="æœç´¢èŠ‚ç‚¹..."
        prefix-icon="search"
      />
    </div>

    <!-- Tab åˆ‡æ¢ -->
    <n8n-tabs v-model="activeTab" class="node-creator-tabs">
      <!-- Tab 1: åŸºç¡€èŠ‚ç‚¹ï¼ˆ142ä¸ªå†…ç½®ï¼‰ -->
      <n8n-tab-pane label="åŸºç¡€èŠ‚ç‚¹" name="builtin">
        <div class="tab-description">
          n8n å†…ç½®çš„æ ¸å¿ƒèŠ‚ç‚¹ï¼Œæ¶µç›–æ•°æ®å¤„ç†ã€æµç¨‹æ§åˆ¶ç­‰åŸºç¡€åŠŸèƒ½
        </div>
        <NodeCategoryList :nodes="filteredBuiltinNodes" />
      </n8n-tab-pane>

      <!-- Tab 2: æ‰©å±•èŠ‚ç‚¹ï¼ˆå¹³å° + ç¬¬ä¸‰æ–¹ï¼‰ -->
      <n8n-tab-pane label="æ‰©å±•èŠ‚ç‚¹" name="extension">
        <div class="tab-description">
          å¹³å°æä¾›å’Œç¤¾åŒºè´¡çŒ®çš„èŠ‚ç‚¹ï¼Œæ‰€æœ‰ç”¨æˆ·å¯ç”¨
        </div>

        <!-- å¹³å°å®˜æ–¹èŠ‚ç‚¹ -->
        <div class="node-section">
          <h3 class="section-title">
            <n8n-tag type="success" size="small">å¹³å°å®˜æ–¹</n8n-tag>
            å¹³å°èŠ‚ç‚¹
          </h3>
          <NodeGrid :nodes="filteredPlatformOfficialNodes" />
        </div>

        <!-- ç¬¬ä¸‰æ–¹èŠ‚ç‚¹ -->
        <div class="node-section">
          <h3 class="section-title">
            <n8n-tag type="info" size="small">ç¤¾åŒºè´¡çŒ®</n8n-tag>
            ç¬¬ä¸‰æ–¹èŠ‚ç‚¹
          </h3>
          <NodeGrid :nodes="filteredThirdPartyNodes" />
        </div>

        <n8n-empty
          v-if="extensionNodes.length === 0"
          description="æš‚æ— æ‰©å±•èŠ‚ç‚¹"
        />
      </n8n-tab-pane>

      <!-- Tab 3: æˆ‘çš„èŠ‚ç‚¹ï¼ˆå·¥ä½œç©ºé—´ç§æœ‰ï¼‰ -->
      <n8n-tab-pane label="æˆ‘çš„èŠ‚ç‚¹" name="workspace">
        <div class="tab-description">
          æœ¬å·¥ä½œç©ºé—´ä¸Šä¼ çš„ç§æœ‰èŠ‚ç‚¹ï¼Œä»…å›¢é˜Ÿæˆå‘˜å¯è§
        </div>

        <NodeList :nodes="filteredWorkspaceNodes" />

        <n8n-empty
          v-if="workspaceNodes.length === 0"
          description="è¿˜æ²¡æœ‰ä¸Šä¼ ç§æœ‰èŠ‚ç‚¹"
        >
          <n8n-button @click="showUploadDialog = true" type="primary">
            ä¸Šä¼ èŠ‚ç‚¹
          </n8n-button>
        </n8n-empty>

        <div class="workspace-actions">
          <n8n-button @click="showUploadDialog = true" icon="plus">
            ä¸Šä¼ æ–°èŠ‚ç‚¹
          </n8n-button>
        </div>
      </n8n-tab-pane>
    </n8n-tabs>

    <!-- ä¸Šä¼ å¯¹è¯æ¡† -->
    <NodeUploadDialog
      v-if="showUploadDialog"
      @close="showUploadDialog = false"
      @uploaded="handleNodeUploaded"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue';
import { useNodeTypesStore } from '@/stores/nodeTypes.store';

const nodeTypesStore = useNodeTypesStore();

const searchQuery = ref('');
const activeTab = ref('builtin');
const showUploadDialog = ref(false);

// å†…ç½®èŠ‚ç‚¹
const builtinNodes = computed(() => nodeTypesStore.builtinNodes);
const filteredBuiltinNodes = computed(() =>
  builtinNodes.value.filter(matchesSearch)
);

// æ‰©å±•èŠ‚ç‚¹ï¼ˆå¹³å° + ç¬¬ä¸‰æ–¹ï¼‰
const extensionNodes = computed(() => nodeTypesStore.extensionNodes);

const filteredPlatformOfficialNodes = computed(() =>
  extensionNodes.value
    .filter(node => node.nodeType === 'platform_official')
    .filter(matchesSearch)
);

const filteredThirdPartyNodes = computed(() =>
  extensionNodes.value
    .filter(node => node.nodeType === 'third_party_approved')
    .filter(matchesSearch)
);

// å·¥ä½œç©ºé—´ç§æœ‰èŠ‚ç‚¹
const workspaceNodes = computed(() => nodeTypesStore.workspaceNodes);
const filteredWorkspaceNodes = computed(() =>
  workspaceNodes.value.filter(matchesSearch)
);

function matchesSearch(node: any) {
  if (!searchQuery.value) return true;
  const query = searchQuery.value.toLowerCase();
  return (
    node.displayName?.toLowerCase().includes(query) ||
    node.description?.toLowerCase().includes(query) ||
    node.name?.toLowerCase().includes(query)
  );
}

async function handleNodeUploaded() {
  // é‡æ–°åŠ è½½èŠ‚ç‚¹åˆ—è¡¨
  await nodeTypesStore.fetchNodeTypes();
  // åˆ‡æ¢åˆ°"æˆ‘çš„èŠ‚ç‚¹" Tab
  activeTab.value = 'workspace';
  showUploadDialog.value = false;
}

onMounted(async () => {
  await nodeTypesStore.fetchNodeTypes();
});
</script>
```

### NodeTypes Store

**æ–‡ä»¶ï¼š** `packages/editor-ui/src/stores/nodeTypes.store.ts`

```typescript
import { defineStore } from 'pinia';
import { ref, computed } from 'vue';
import * as nodeTypesApi from '@/api/nodeTypes';

export const useNodeTypesStore = defineStore('nodeTypes', () => {
  const nodeTypes = ref<Record<string, INodeTypeWithSource>>({});
  const loading = ref(false);
  const error = ref<Error | null>(null);

  /**
   * âœ… åŠ è½½æ‰€æœ‰å¯ç”¨èŠ‚ç‚¹
   * åŒ…æ‹¬ï¼šå†…ç½® + å¹³å° + ç¬¬ä¸‰æ–¹ + å·¥ä½œç©ºé—´ç§æœ‰
   */
  async function fetchNodeTypes() {
    loading.value = true;
    error.value = null;

    try {
      const nodes = await nodeTypesApi.getAllNodeTypes();

      nodeTypes.value = {};
      for (const node of nodes) {
        // âœ… åç«¯å·²éªŒè¯å…ƒæ•°æ®ï¼Œå‰ç«¯å¯ä»¥ä¿¡ä»»æ•°æ®
        // ä½†ä»ç„¶åšåŸºæœ¬çš„ç©ºå€¼æ£€æŸ¥
        if (node && node.name) {
          nodeTypes.value[node.name] = node;
        } else {
          console.warn('Received invalid node from API:', node);
        }
      }
    } catch (err) {
      error.value = err as Error;
      console.error('Failed to load node types:', err);
      // âœ… ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œå…è®¸åº”ç”¨ç»§ç»­è¿è¡Œ
    } finally {
      loading.value = false;
    }
  }

  /**
   * å®‰å…¨è·å–èŠ‚ç‚¹
   */
  function getNodeType(name: string): INodeTypeWithSource | null {
    return nodeTypes.value[name] || null;
  }

  /**
   * å®‰å…¨è·å–èŠ‚ç‚¹å±æ€§
   */
  function getNodeProperty<K extends keyof INodeTypeDescription>(
    nodeName: string,
    property: K
  ): INodeTypeDescription[K] | undefined {
    const node = nodeTypes.value[nodeName];
    return node?.[property];
  }

  /**
   * è®¡ç®—å±æ€§ï¼šå†…ç½®èŠ‚ç‚¹ï¼ˆ142ä¸ªï¼‰
   */
  const builtinNodes = computed(() =>
    Object.values(nodeTypes.value).filter(node => node.source === 'builtin')
  );

  /**
   * è®¡ç®—å±æ€§ï¼šæ‰©å±•èŠ‚ç‚¹ï¼ˆå¹³å° + ç¬¬ä¸‰æ–¹ï¼Œå…¨å¹³å°å¯ç”¨ï¼‰
   */
  const extensionNodes = computed(() =>
    Object.values(nodeTypes.value).filter(
      node => node.nodeType === 'platform_official' || node.nodeType === 'third_party_approved'
    )
  );

  /**
   * è®¡ç®—å±æ€§ï¼šå·¥ä½œç©ºé—´ç§æœ‰èŠ‚ç‚¹
   */
  const workspaceNodes = computed(() =>
    Object.values(nodeTypes.value).filter(
      node => node.nodeType === 'workspace'
    )
  );

  /**
   * æŒ‰åˆ†ç±»å®‰å…¨è·å–èŠ‚ç‚¹
   */
  function getNodesByCategory(category: string): INodeTypeWithSource[] {
    return Object.values(nodeTypes.value).filter(node => {
      // âœ… å®‰å…¨è®¿é—® group å±æ€§
      if (!node.group || !Array.isArray(node.group)) {
        console.warn(`Node ${node.name} has invalid group property`);
        return false;
      }
      return node.group.includes(category);
    });
  }

  return {
    nodeTypes,
    loading,
    error,
    fetchNodeTypes,
    getNodeType,
    getNodeProperty,
    builtinNodes,
    extensionNodes,
    workspaceNodes,
    getNodesByCategory,
  };
});
```

---


[â† ä¸Šä¸€ç« ï¼šåç«¯å®ç°](./06-åç«¯å®ç°.md) | [è¿”å›æ€»è§ˆ](../00-æ€»è§ˆä¸å¯¼èˆª.md) | [ä¸‹ä¸€ç« ï¼šç”¨æˆ·ä½“éªŒ â†’](./08-ç”¨æˆ·ä½“éªŒ.md)
