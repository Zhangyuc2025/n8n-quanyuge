# 用户体验设计

> **版本：** v1.0
> **状态：** 设计中

[← 返回总览](../00-总览与导航.md)

---

## 👥 用户节点中心

### 概述

**用户节点中心** 是用户管理和使用节点的统一入口，包括：
1. **节点选择器**（NodeCreator）- 添加节点到工作流时使用
2. **节点管理页面**（Node Management Page）- 管理工作空间上传的私有节点
3. **节点市场**（Node Marketplace，可选）- 浏览和提交第三方节点

### 1. 节点选择器（添加节点时）

**触发场景：**
- 用户在工作流编辑器中点击 "+" 按钮
- 右键点击画布选择 "Add Node"

**界面结构：**

```
┌─────────────────────────────────────────────────┐
│  🔍 搜索节点...                      [关闭 ×]   │
├─────────────────────────────────────────────────┤
│  [基础节点] [扩展节点] [我的节点]              │
├─────────────────────────────────────────────────┤
│                                                 │
│  【当前选中：基础节点 Tab】                     │
│                                                 │
│  n8n 内置的核心节点，涵盖数据处理、流程控制    │
│                                                 │
│  ┌─ 流程控制 ───────────────────────┐          │
│  │  [If] [Switch] [Merge] [Wait]    │          │
│  └──────────────────────────────────┘          │
│                                                 │
│  ┌─ 数据处理 ───────────────────────┐          │
│  │  [Set] [Code] [Function]         │          │
│  └──────────────────────────────────┘          │
│                                                 │
│  ┌─ AI 工具 ────────────────────────┐          │
│  │  [Agent] [RAG] [Text Classifier] │          │
│  └──────────────────────────────────┘          │
│                                                 │
└─────────────────────────────────────────────────┘
```

#### Tab 1: 基础节点（Built-in Nodes）

**显示内容：**
- 142 个内置节点
- 按分类分组显示（流程控制、数据处理、AI 工具、集成等）
- 每个节点显示：图标、名称、简短描述

**交互：**
- 点击节点卡片 → 添加到画布
- 搜索实时过滤
- 支持键盘导航（上下键选择，Enter 确认）

#### Tab 2: 扩展节点（Extension Nodes）

**显示内容：**

```
┌─────────────────────────────────────────────────┐
│  平台提供和社区贡献的节点，所有用户可用         │
├─────────────────────────────────────────────────┤
│                                                 │
│  ✅ 平台官方  平台节点                          │
│  ┌──────┬──────┬──────┬──────┐                │
│  │ 天气 │ OCR  │ 翻译 │ 语音 │                │
│  │ 查询 │ 识别 │ 服务 │ 识别 │                │
│  └──────┴──────┴──────┴──────┘                │
│                                                 │
│  ℹ️  社区贡献  第三方节点                       │
│  ┌──────┬──────┬──────┐                       │
│  │ 邮件 │ 短信 │ 推送 │                       │
│  │ 模板 │ 验证 │ 通知 │                       │
│  └──────┴──────┴──────┘                       │
│                                                 │
│  （暂无扩展节点）                               │
└─────────────────────────────────────────────────┘
```

**节点卡片信息：**
- 图标 + 名称
- 简短描述（1 行）
- 标签：`平台官方` 或 `社区贡献`
- 如果是计费节点，显示价格（如 `¥0.01/次`）

#### Tab 3: 我的节点（Workspace Nodes）

**显示内容：**

```
┌─────────────────────────────────────────────────┐
│  本工作空间上传的私有节点，仅团队成员可见       │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌──────────────────────────────────────────┐  │
│  │ 📦 企业内部 API 连接器                   │  │
│  │    连接到公司内部 CRM 系统               │  │
│  │    上传者: 张三  |  2025-01-08           │  │
│  │    状态: [✅ 正常] [📝 编辑] [🗑️ 删除]   │  │
│  └──────────────────────────────────────────┘  │
│                                                 │
│  ┌──────────────────────────────────────────┐  │
│  │ 📦 数据清洗工具                          │  │
│  │    自定义数据清洗和验证逻辑              │  │
│  │    上传者: 李四  |  2025-01-05           │  │
│  │    状态: [⏳ 审核中] [查看详情]          │  │
│  └──────────────────────────────────────────┘  │
│                                                 │
│  【还没有上传私有节点】                         │
│  [+ 上传新节点]                                │
│                                                 │
└─────────────────────────────────────────────────┘
```

**空状态：**
- 提示文案："还没有上传私有节点"
- 引导按钮："上传新节点"

**有节点时：**
- 列表展示所有私有节点
- 每个节点显示：名称、描述、上传者、上传时间、状态
- 状态标签：
  - `✅ 正常` - 可正常使用
  - `⏳ 审核中` - 已提交平台审核
  - `✅ 已发布` - 审核通过，已发布到扩展节点
  - `❌ 审核拒绝` - 审核未通过
- 操作按钮：编辑、删除、提交审核（如果是草稿状态）

### 2. 节点管理页面（独立页面）

**访问路径：**
- 主菜单 → 设置 → 节点管理
- URL: `/settings/nodes`

**页面布局：**

```
┌─────────────────────────────────────────────────────────────┐
│  节点管理                                    [+ 上传新节点]  │
├─────────────────────────────────────────────────────────────┤
│  [我的节点] [审核记录]                                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  我的节点 (3)                                               │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  📦 企业内部 API 连接器              v1.0.0          │   │
│  │  ─────────────────────────────────────────────────  │   │
│  │  描述: 连接到公司内部 CRM 系统                      │   │
│  │  分类: 集成 | 创建时间: 2025-01-08 15:30           │   │
│  │  使用次数: 23 次 | 最后使用: 2 小时前               │   │
│  │                                                     │   │
│  │  状态: ✅ 正常使用                                  │   │
│  │                                                     │   │
│  │  [📝 编辑] [📋 查看代码] [📊 使用统计] [🗑️ 删除]   │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  📦 数据清洗工具                     v1.0.0          │   │
│  │  ─────────────────────────────────────────────────  │   │
│  │  描述: 自定义数据清洗和验证逻辑                     │   │
│  │  分类: 数据处理 | 创建时间: 2025-01-05 10:20       │   │
│  │  使用次数: 8 次 | 最后使用: 昨天                    │   │
│  │                                                     │   │
│  │  状态: ⏳ 审核中（2025-01-06 提交）                 │   │
│  │  审核说明: 已提交至平台审核，预计 3-5 工作日       │   │
│  │                                                     │   │
│  │  [查看详情] [撤回审核]                              │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  📦 自动回复机器人                   v1.2.0          │   │
│  │  ─────────────────────────────────────────────────  │   │
│  │  描述: 智能客服自动回复节点                         │   │
│  │  分类: AI 工具 | 创建时间: 2024-12-20 09:15        │   │
│  │  使用次数: 156 次 | 最后使用: 1 小时前              │   │
│  │                                                     │   │
│  │  状态: ✅ 已发布到平台（2025-01-03 审核通过）       │   │
│  │  在 "扩展节点" Tab 中可见，所有用户可用             │   │
│  │                                                     │   │
│  │  [📝 更新版本] [📊 使用统计] [🌐 查看市场页面]      │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 功能详解

**我的节点 Tab：**
- 显示本工作空间上传的所有私有节点
- 节点卡片包含：
  - 基本信息：名称、版本、描述、分类
  - 使用统计：使用次数、最后使用时间
  - 状态信息：正常/审核中/已发布/审核拒绝
  - 操作按钮：编辑、查看代码、使用统计、删除

**审核记录 Tab：**
- 显示提交审核的节点历史
- 包含：提交时间、审核结果、审核意见

### 3. 上传节点对话框

**触发：**
- 节点选择器 → "我的节点" Tab → "上传新节点"
- 节点管理页面 → "上传新节点"

**对话框界面：**

```
┌─────────────────────────────────────────────────┐
│  上传自定义节点                        [关闭 ×] │
├─────────────────────────────────────────────────┤
│                                                 │
│  步骤 1/3: 基本信息                             │
│  ─────────────────────────────────────────────  │
│                                                 │
│  节点名称 *                                     │
│  ┌─────────────────────────────────────────┐   │
│  │ 企业内部 API 连接器                     │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  节点标识 (唯一) *                              │
│  ┌─────────────────────────────────────────┐   │
│  │ n8n-nodes-enterprise-api                │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  分类                                           │
│  ┌─────────────────────────────────────────┐   │
│  │ 集成 ▼                                  │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  描述                                           │
│  ┌─────────────────────────────────────────┐   │
│  │ 连接到公司内部 CRM 系统，支持客户       │   │
│  │ 数据查询、创建和更新操作                │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  图标 URL（可选）                               │
│  ┌─────────────────────────────────────────┐   │
│  │ https://example.com/icon.png            │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│                                [取消] [下一步]  │
└─────────────────────────────────────────────────┘
```

**步骤 2/3: 上传代码**

```
┌─────────────────────────────────────────────────┐
│  上传自定义节点                        [关闭 ×] │
├─────────────────────────────────────────────────┤
│                                                 │
│  步骤 2/3: 上传代码                             │
│  ─────────────────────────────────────────────  │
│                                                 │
│  上传方式:                                      │
│  ○ 上传文件  ● 粘贴代码                         │
│                                                 │
│  节点代码 (TypeScript) *                        │
│  ┌─────────────────────────────────────────┐   │
│  │ import { INodeType, ... } from 'n8n-   │   │
│  │   workflow';                            │   │
│  │                                         │   │
│  │ export class EnterpriseAPI implements  │   │
│  │   INodeType {                           │   │
│  │   description: INodeTypeDescription = { │   │
│  │     displayName: '企业内部 API',        │   │
│  │     name: 'enterpriseApi',              │   │
│  │     ...                                 │   │
│  │   }                                     │   │
│  │ }                                       │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  ✅ 代码验证通过                                │
│                                                 │
│  [上一步] [取消]                    [下一步]    │
└─────────────────────────────────────────────────┘
```

**步骤 3/3: 配置选项**

```
┌─────────────────────────────────────────────────┐
│  上传自定义节点                        [关闭 ×] │
├─────────────────────────────────────────────────┤
│                                                 │
│  步骤 3/3: 配置选项                             │
│  ─────────────────────────────────────────────  │
│                                                 │
│  配置模式                                       │
│  ○ 个人配置（每个用户独立配置 API Key 等）      │
│  ● 团队共享（管理员统一配置，全员共享）         │
│                                                 │
│  【仅当选择"团队共享"时显示】                   │
│  ┌─────────────────────────────────────────┐   │
│  │ 共享配置（JSON 格式）                   │   │
│  │ ┌─────────────────────────────────────┐ │   │
│  │ │ {                                   │ │   │
│  │ │   "apiKey": "sk-xxxxx",             │ │   │
│  │ │   "baseUrl": "https://api.example.  │ │   │
│  │ │     com"                            │ │   │
│  │ │ }                                   │ │   │
│  │ └─────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  可见性                                         │
│  ● 工作空间私有（仅本团队可见）                 │
│  ○ 提交到平台（需审核，通过后全平台可见）       │
│                                                 │
│  【仅当选择"提交到平台"时显示】                 │
│  ⚠️  提交审核说明：                             │
│  • 审核周期: 3-5 个工作日                       │
│  • 审核标准: 代码质量、安全性、实用性           │
│  • 审核通过后，节点将在"扩展节点"中显示         │
│                                                 │
│  [上一步] [取消]                    [完成上传]  │
└─────────────────────────────────────────────────┘
```

### 4. 节点详情页面

**访问：** 节点管理页面 → 点击节点卡片

**页面布局：**

```
┌─────────────────────────────────────────────────────────────┐
│  ← 返回节点管理                                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  📦 企业内部 API 连接器                          v1.0.0      │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  [概览] [代码] [配置] [使用统计] [审核记录]                 │
│  ──────────────────────────────────────────────────────────│
│                                                             │
│  【概览 Tab】                                               │
│                                                             │
│  基本信息                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  名称: 企业内部 API 连接器                          │   │
│  │  标识: n8n-nodes-enterprise-api                     │   │
│  │  版本: 1.0.0                                        │   │
│  │  分类: 集成                                         │   │
│  │  描述: 连接到公司内部 CRM 系统                      │   │
│  │  上传者: 张三 (zhang.san@example.com)              │   │
│  │  创建时间: 2025-01-08 15:30:25                     │   │
│  │  最后更新: 2025-01-08 15:30:25                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  使用情况                                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  总使用次数: 23 次                                  │   │
│  │  最后使用: 2 小时前                                 │   │
│  │  活跃工作流: 5 个                                   │   │
│  │  活跃用户: 3 人                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  状态                                                       │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  ✅ 正常使用                                        │   │
│  │  可见性: 工作空间私有                               │   │
│  │  配置模式: 团队共享                                 │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  [编辑节点] [提交审核] [删除节点]                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5. 用户工作流程

#### 5.1 上传私有节点流程

```mermaid
graph TD
    A[点击 "上传新节点"] --> B[填写基本信息]
    B --> C[上传/粘贴代码]
    C --> D{代码验证}
    D -->|失败| E[显示错误提示]
    E --> C
    D -->|成功| F[配置选项]
    F --> G{选择可见性}
    G -->|工作空间私有| H[完成上传]
    G -->|提交到平台| I[提交审核]
    H --> J[节点仅本工作空间可用]
    I --> K[等待平台审核]
    K --> L{审核结果}
    L -->|通过| M[节点发布到扩展节点]
    L -->|拒绝| N[查看审核意见并修改]
    N --> I
```

#### 5.2 使用节点流程

**场景 1: 使用内置节点**
```
1. 工作流编辑器 → 点击 "+"
2. 节点选择器打开 → 默认显示"基础节点" Tab
3. 浏览或搜索节点
4. 点击节点 → 添加到画布
5. 配置节点参数
6. 运行工作流
```

**场景 2: 使用平台扩展节点**
```
1. 工作流编辑器 → 点击 "+"
2. 切换到"扩展节点" Tab
3. 浏览平台官方或第三方节点
4. 点击节点 → 添加到画布
5. 配置节点参数（如果需要）
6. 运行工作流
   - 如果是计费节点 → 自动从余额扣费
```

**场景 3: 使用工作空间私有节点**
```
1. 工作流编辑器 → 点击 "+"
2. 切换到"我的节点" Tab
3. 选择私有节点
4. 点击节点 → 添加到画布
5. 配置节点参数
   - 如果是"个人配置"模式 → 每个用户独立配置
   - 如果是"团队共享"模式 → 使用管理员配置的共享参数
6. 运行工作流
```

#### 5.3 提交节点审核流程

```mermaid
graph LR
    A[节点管理页面] --> B[选择节点]
    B --> C[点击 "提交审核"]
    C --> D[确认提交]
    D --> E[状态变为 "审核中"]
    E --> F[等待 3-5 工作日]
    F --> G{审核结果}
    G -->|通过| H[状态变为 "已发布"]
    G -->|拒绝| I[状态变为 "审核拒绝"]
    H --> J[节点出现在 "扩展节点" Tab]
    I --> K[查看审核意见]
    K --> L[修改代码]
    L --> C
```

### 6. 权限和访问控制

| 操作 | 工作空间成员 | 工作空间管理员 | 平台管理员 |
|------|--------------|----------------|------------|
| **查看内置节点** | ✅ | ✅ | ✅ |
| **查看扩展节点** | ✅ | ✅ | ✅ |
| **查看本工作空间私有节点** | ✅ | ✅ | ✅ |
| **上传私有节点** | ✅ | ✅ | ✅ |
| **编辑私有节点** | ⚠️ 仅上传者 | ✅ | ✅ |
| **删除私有节点** | ⚠️ 仅上传者 | ✅ | ✅ |
| **提交节点审核** | ✅ | ✅ | ✅ |
| **审核第三方节点** | ❌ | ❌ | ✅ |
| **管理平台官方节点** | ❌ | ❌ | ✅ |
| **配置共享参数（团队共享模式）** | ❌ | ✅ | ✅ |

### 7. 用户反馈和提示

#### 成功提示
- **上传节点成功:** "节点已成功上传，现在可以在工作流中使用"
- **提交审核成功:** "节点已提交审核，预计 3-5 工作日完成审核"
- **审核通过:** "恭喜！您的节点已通过审核，现在所有用户都可以使用"

#### 错误提示
- **代码验证失败:** "节点代码包含错误: [具体错误信息]"
- **节点名称重复:** "节点标识已存在，请使用不同的标识"
- **权限不足:** "您没有权限执行此操作"

#### 警告提示
- **删除节点:** "删除后，所有使用此节点的工作流将受到影响。确定要删除吗？"
- **审核拒绝:** "您的节点审核未通过。原因: [审核意见]。请修改后重新提交。"

### 8. 移动端适配

**节点选择器（移动端）:**
- Tab 切换改为下拉菜单
- 节点卡片改为列表模式
- 搜索框常驻顶部

**节点管理页面（移动端）:**
- 折叠详细信息，仅显示关键信息
- 操作按钮改为底部抽屉菜单

---


[← 上一章：前端实现](./07-前端实现.md) | [返回总览](../00-总览与导航.md) | [下一章：实施计划 →](./09-实施计划.md)
