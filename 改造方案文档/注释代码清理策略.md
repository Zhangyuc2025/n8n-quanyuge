# æ³¨é‡Šä»£ç æ¸…ç†ç­–ç•¥æ–‡æ¡£

## 1. æ¦‚è¿°

### å½“å‰æ”¹åŠ¨ç»Ÿè®¡
- **æ–°å¢è¡Œæ•°**: 864 è¡Œ
- **åˆ é™¤è¡Œæ•°**: 5,459 è¡Œ
- **å‡€åˆ é™¤**: 4,595 è¡Œ

### æ³¨é‡Šåˆ†å¸ƒæƒ…å†µ
- **æ–°å¢æ³¨é‡Šè¡Œ**: 440 è¡Œï¼ˆå…¶ä¸­ 71 è¡Œæ˜¯"Credential system has been removed"æ ‡è®°ï¼‰
- **åˆ é™¤æ³¨é‡Šè¡Œ**: 164 è¡Œ
- **å‡€æ–°å¢æ³¨é‡Š**: 276 è¡Œ

---

## 2. æ³¨é‡Šä»£ç æ¨¡å¼åˆ†æ

### 2.1 æ–°å¢çš„æ³¨é‡Šç±»å‹

#### A. è¯´æ˜æ€§æ³¨é‡Šï¼ˆ**åº”ä¿ç•™**ï¼‰
```typescript
// Credential system has been removed
// Credential system has been removed - keeping this for backward compatibility
// Credential system has been removed - local type for compatibility
// Credential system has been removed - temporary types for backward compatibility
```
**æ•°é‡**: 71 å¤„
**ç”¨é€”**: è¯´æ˜åˆ é™¤åŸå› ï¼Œå¸®åŠ©ç†è§£ä»£ç å˜æ›´
**å»ºè®®**: **ä¿ç•™è¿™äº›æ³¨é‡Š**ï¼Œå®ƒä»¬æ˜¯é‡è¦çš„æ–‡æ¡£è¯´æ˜

#### B. @deprecated æ ‡è®°ï¼ˆ**åº”ä¿ç•™**ï¼‰
```typescript
/**
 * @deprecated OAuth2 authentication removed - credentials system has been removed
 * This function now throws an error as OAuth2 is no longer supported
 */
```
**æ•°é‡**: 5 å¤„
**ç”¨é€”**: æ ‡è®°å·²åºŸå¼ƒçš„APIï¼Œé˜²æ­¢è¯¯ç”¨
**å»ºè®®**: **ä¿ç•™è¿™äº›æ³¨é‡Š**ï¼Œå®ƒä»¬æ˜¯APIåºŸå¼ƒæ–‡æ¡£

#### C. æ³¨é‡Šæ‰çš„ä»£ç å—ï¼ˆ**åº”åˆ é™¤**ï¼‰

##### C1. æ³¨é‡Šæ‰çš„ import è¯­å¥
```typescript
// import type {
// 	ICredentialDataDecryptedObject,
// 	INodeCredentialTestRequest,
// 	IPersonalizationSurveyAnswersV4,
// } from 'n8n-workflow';

// import omit from 'lodash/omit';
// import { CredentialsFinderService } from '@/credentials/credentials-finder.service';
// import { CredentialsService } from '@/credentials/credentials.service';
```
**æ•°é‡**: çº¦ 23 å¤„
**å»ºè®®**: **å¯ä»¥å®‰å…¨åˆ é™¤**

##### C2. æ³¨é‡Šæ‰çš„æ¥å£å’Œç±»å‹å®šä¹‰
```typescript
// export interface ICredentialsDb extends ICredentialsBase, ICredentialsEncrypted {
// 	id: string;
// 	name: string;
// }

// Credential system has been removed
// export interface ICredentialsExpressionResolveValues {
// 	connectionInputData: INodeExecutionData[];
// 	itemIndex: number;
// 	node: INode;
// 	runExecutionData: IRunExecutionData | null;
// 	runIndex: number;
// 	workflow: Workflow;
// }
```
**æ•°é‡**: çº¦ 30 å¤„
**å»ºè®®**: **å¯ä»¥å®‰å…¨åˆ é™¤**

##### C3. æ³¨é‡Šæ‰çš„å˜é‡å£°æ˜å’Œå‡½æ•°è°ƒç”¨
```typescript
// const shareUsedCredentials = ref(false);
// const usedCredentials = ref<IUsedCredential[]>([]);
// const allCredentials = ref<ICredentialsResponse[]>([]);

// const userCredentials = await this.credentialsService.getCredentialsAUserCanUseInAWorkflow(
// 	currentUser,
// 	{ workflowId: workflow.id },
// );
```
**æ•°é‡**: çº¦ 50+ å¤„
**å»ºè®®**: **å¯ä»¥å®‰å…¨åˆ é™¤**

##### C4. æ³¨é‡Šæ‰çš„å®Œæ•´å‡½æ•°å®ç°
```typescript
// function createOAuth2Client(credentials: OAuth2CredentialData): ClientOAuth2 {
// 	return new ClientOAuth2({
// 		clientId: credentials.clientId,
// 		clientSecret: credentials.clientSecret,
// 		accessTokenUri: credentials.accessTokenUrl,
// 		scopes: (credentials.scope ?? '').split(' '),
// 		ignoreSSLIssues: credentials.ignoreSSLIssues,
// 		authentication: credentials.authentication ?? 'header',
// 		...(credentials.additionalBodyProperties && {
// 			additionalBodyProperties: jsonParse(credentials.additionalBodyProperties, {
// 				fallbackValue: {},
// 			}),
// 		}),
// 	});
// }
```
**æ•°é‡**: çº¦ 20+ å¤„å¤§å—ä»£ç 
**å»ºè®®**: **å¯ä»¥å®‰å…¨åˆ é™¤**

##### C5. æ³¨é‡Šæ‰çš„ä¾èµ–æ³¨å…¥å‚æ•°
```typescript
constructor(
    private readonly logger: Logger,
    private readonly workflowRepository: WorkflowRepository,
    // Credential system has been removed
    // private readonly credentialsRepository: CredentialsRepository,
    // private readonly credentialsService: CredentialsService,
    private readonly ownershipService: OwnershipService,
)
```
**æ•°é‡**: çº¦ 15 å¤„
**å»ºè®®**: **å¯ä»¥å®‰å…¨åˆ é™¤**

#### D. Vue æ¨¡æ¿ä¸­çš„ HTML æ³¨é‡Šï¼ˆ**åº”åˆ é™¤**ï¼‰
```vue
<!-- Credential system has been removed -->
<!-- <ModalRoot :name="CREDENTIAL_EDIT_MODAL_KEY">
    <template #default="{ modalName, activeId, mode }">
        <CredentialEdit :modal-name="modalName" :mode="mode" :active-id="activeId" />
    </template>
</ModalRoot> -->

<!-- Credential system has been removed -->
<!-- <CredentialIcon
    v-else
    :credential-type-name="PROVIDER_CREDENTIAL_TYPE_MAP[agent.model.provider]"
    :size="size === 'sm' ? 16 : size === 'lg' ? 40 : 20"
/> -->
```
**æ•°é‡**: çº¦ 10+ å¤„
**å»ºè®®**: **å¯ä»¥å®‰å…¨åˆ é™¤**

### 2.2 åˆ é™¤çš„æ³¨é‡Šï¼ˆå·²åˆ é™¤ï¼Œæ— éœ€å¤„ç†ï¼‰
- åˆ é™¤çš„å®ç°è¯´æ˜æ³¨é‡Š: 70 å¤„
- åˆ é™¤çš„å•è¡Œæ³¨é‡Š: 150 å¤„
- è¿™äº›éƒ½æ˜¯éšç€ä»£ç åˆ é™¤è€Œç§»é™¤çš„æ³¨é‡Šï¼Œå±äºæ­£å¸¸æ¸…ç†

---

## 3. æ¸…ç†ç­–ç•¥

### 3.1 æ¸…ç†ä¼˜å…ˆçº§

#### ğŸ”´ **ä¼˜å…ˆçº§ 1: ç«‹å³æ¸…ç†**ï¼ˆé£é™©ä½ï¼Œæ”¶ç›Šé«˜ï¼‰

1. **æ³¨é‡Šæ‰çš„ import è¯­å¥**
   - ä½ç½®: æ‰€æœ‰ `.ts` å’Œ `.vue` æ–‡ä»¶
   - æ•°é‡: ~23 å¤„
   - é£é™©: æ— é£é™©ï¼Œå·²ç»ä¸è¢«ä½¿ç”¨
   - è¯†åˆ«æ¨¡å¼:
     ```
     // import .* from ['"].*['"];?
     ```

2. **æ³¨é‡Šæ‰çš„å˜é‡å£°æ˜ï¼ˆæœªè¢«å¼•ç”¨ï¼‰**
   - ä½ç½®: ä¸»è¦åœ¨å‰ç«¯ç»„ä»¶å’Œ stores
   - æ•°é‡: ~27 å¤„
   - é£é™©: æä½ï¼ˆéœ€è¦ç¡®è®¤å˜é‡æœªè¢«å¼•ç”¨ï¼‰
   - è¯†åˆ«æ¨¡å¼:
     ```
     // (const|let|var) \w+ = .*;?
     ```

#### ğŸŸ¡ **ä¼˜å…ˆçº§ 2: éªŒè¯åæ¸…ç†**ï¼ˆéœ€è¦æ£€æŸ¥ï¼‰

3. **å¤§å—æ³¨é‡Šæ‰çš„å‡½æ•°å®ç°**
   - ä½ç½®: ä¸»è¦åœ¨ `packages/core/src/execution-engine/`
   - æ•°é‡: ~20 å¤„
   - é£é™©: ä¸­ç­‰ï¼ˆéœ€è¦ç¡®è®¤å‡½æ•°è°ƒç”¨è€…å·²æ›´æ–°ï¼‰
   - å…³é”®æ–‡ä»¶:
     - `request-helper-functions.ts` (OAuth2 ç›¸å…³å‡½æ•°)
     - `routing-node.ts`
     - `workflow.service.ee.ts`

4. **æ³¨é‡Šæ‰çš„ç±»å‹å®šä¹‰å’Œæ¥å£**
   - ä½ç½®: ä¸»è¦åœ¨ `packages/workflow/src/interfaces.ts`
   - æ•°é‡: ~30 å¤„
   - é£é™©: ä¸­ç­‰ï¼ˆéœ€è¦ç¡®è®¤æ— æ®‹ç•™å¼•ç”¨ï¼‰

5. **Vue æ¨¡æ¿ä¸­çš„ HTML æ³¨é‡Š**
   - ä½ç½®: å‰ç«¯ `.vue` æ–‡ä»¶
   - æ•°é‡: ~10 å¤„
   - é£é™©: ä½ï¼ˆä½†éœ€è¦ç¡®è®¤UIæ­£å¸¸ï¼‰

#### ğŸŸ¢ **ä¼˜å…ˆçº§ 3: ä¿ç•™æˆ–å»¶å**ï¼ˆæ…é‡è€ƒè™‘ï¼‰

6. **è¯´æ˜æ€§æ³¨é‡Š** - **ä¿ç•™**
   ```typescript
   // Credential system has been removed
   // Credential system has been removed - keeping this for backward compatibility
   ```
   è¿™äº›æ˜¯æœ‰ä»·å€¼çš„æ–‡æ¡£è¯´æ˜

7. **@deprecated æ ‡è®°** - **ä¿ç•™**
   ```typescript
   /**
    * @deprecated OAuth2 authentication removed - credentials system has been removed
    */
   ```
   è¿™äº›æ ‡è®°é˜²æ­¢è¯¯ç”¨åºŸå¼ƒAPI

8. **å‚æ•°å ä½ç¬¦æ³¨é‡Š** - **æš‚æ—¶ä¿ç•™**
   ```typescript
   _currentUser: User,  // å‚æ•°å‰åŠ ä¸‹åˆ’çº¿ï¼Œè¡¨ç¤ºæœªä½¿ç”¨
   ```
   è¿™äº›è¡¨æ˜å‚æ•°ä¿ç•™æ˜¯ä¸ºäº†ä¿æŒAPIç­¾åå…¼å®¹

---

## 4. æ½œåœ¨é£é™©è¯†åˆ«

### 4.1 éœ€è¦ä¿ç•™çš„æ³¨é‡Šï¼ˆä¸åº”åˆ é™¤ï¼‰

#### âœ… ç±»å‹ 1: å‘åå…¼å®¹è¯´æ˜
```typescript
// Credential system has been removed - keeping this for backward compatibility
export type CredentialPayload = {
	name: string;
	type: string;
	data: Record<string, any>;  // æ”¹ä¸º any ç±»å‹è€Œä¸æ˜¯åˆ é™¤
};
```
**åŸå› **: è§£é‡Šä¸ºä»€ä¹ˆä¿ç•™è¿™ä¸ªç±»å‹

#### âœ… ç±»å‹ 2: ä¸´æ—¶ç±»å‹å®šä¹‰è¯´æ˜
```typescript
// Credential system has been removed - local type for compatibility
type ICredentialDataDecryptedObject = Record<string, any>;
```
**åŸå› **: è¯´æ˜è¿™æ˜¯ä¸´æ—¶çš„å…¼å®¹æ€§ç±»å‹

#### âœ… ç±»å‹ 3: åŠŸèƒ½ç§»é™¤è¯´æ˜
```typescript
// Credential system has been removed
workflow.usedCredentials = [];
```
**åŸå› **: è¯´æ˜ä¸ºä»€ä¹ˆè¿”å›ç©ºæ•°ç»„è€Œä¸æ˜¯å®é™…æ•°æ®

#### âœ… ç±»å‹ 4: API åºŸå¼ƒæ ‡è®°
```typescript
/**
 * @deprecated OAuth2 authentication removed - credentials system has been removed
 * This function now throws an error as OAuth2 is no longer supported
 */
export async function requestOAuth2(...): Promise<never> {
	throw new ApplicationError('OAuth2 authentication is no longer supported');
}
```
**åŸå› **: JSDoc åºŸå¼ƒæ ‡è®°ï¼Œé˜²æ­¢è¯¯ç”¨

### 4.2 å¯ä»¥åˆ é™¤çš„æ³¨é‡Šï¼ˆåº”æ¸…ç†ï¼‰

#### âŒ ç±»å‹ 1: å®Œæ•´æ³¨é‡Šæ‰çš„ä»£ç å—
```typescript
// const credentialsStore = useCredentialsStore();
// const shareUsedCredentials = ref(false);
// const usedCredentials = ref<IUsedCredential[]>([]);
```
**åŸå› **: ä»£ç å·²ä¸å†ä½¿ç”¨ï¼Œgit å†å²å¯è¿½æº¯

#### âŒ ç±»å‹ 2: æ³¨é‡Šæ‰çš„ import
```typescript
// import { CredentialsService } from '@/credentials/credentials.service';
// import { EnterpriseCredentialsService } from '@/credentials/credentials.service.ee';
```
**åŸå› **: ä¾èµ–å·²ç§»é™¤ï¼Œä¸ä¼šå†ä½¿ç”¨

#### âŒ ç±»å‹ 3: æ³¨é‡Šæ‰çš„å¤§æ®µé€»è¾‘
```typescript
// const userCredentials = await this.credentialsService.getCredentialsAUserCanUseInAWorkflow(
// 	currentUser,
// 	{ workflowId: workflow.id },
// );
// const credentialIdsUsedByWorkflow = new Set<string>();
// workflow.nodes.forEach((node) => {
// 	if (!node.credentials) return;
//  ...20+ lines...
// });
```
**åŸå› **: æ•´ä¸ªåŠŸèƒ½å·²ç§»é™¤ï¼Œgit å†å²å¯è¿½æº¯

#### âŒ ç±»å‹ 4: Vue HTML æ³¨é‡Š
```vue
<!-- Credential system has been removed -->
<!-- <ModalRoot :name="CREDENTIAL_EDIT_MODAL_KEY">
    <template #default="{ modalName, activeId, mode }">
        <CredentialEdit :modal-name="modalName" :mode="mode" :active-id="activeId" />
    </template>
</ModalRoot> -->
```
**åŸå› **: UI ç»„ä»¶å·²ä¸å†ä½¿ç”¨

---

## 5. æ¸…ç†æ£€æŸ¥æ¸…å•

### 5.1 åˆ é™¤å‰æ£€æŸ¥ï¼ˆPre-deletion Checklistï¼‰

#### âœ… ä»£ç é™æ€åˆ†æ
- [ ] **è¿è¡Œç±»å‹æ£€æŸ¥**: `pnpm typecheck`
- [ ] **è¿è¡Œä»£ç æ£€æŸ¥**: `pnpm lint`
- [ ] **æœç´¢æ®‹ç•™å¼•ç”¨**:
  ```bash
  # å¯¹äºæ¯ä¸ªè¦åˆ é™¤çš„å‡½æ•°/ç±»å‹ï¼Œæœç´¢å¼•ç”¨
  grep -r "functionName" packages/ --include="*.ts" --include="*.vue"
  ```

#### âœ… ä¾èµ–å…³ç³»æ£€æŸ¥
- [ ] **æ£€æŸ¥ import è¯­å¥**: ç¡®è®¤æ³¨é‡Šæ‰çš„ import æ²¡æœ‰è¢«å…¶ä»–åœ°æ–¹å¼•ç”¨
- [ ] **æ£€æŸ¥ç±»å‹ä½¿ç”¨**: ç¡®è®¤æ³¨é‡Šæ‰çš„æ¥å£/ç±»å‹æ²¡æœ‰è¢«å…¶ä»–åœ°æ–¹å¼•ç”¨
- [ ] **æ£€æŸ¥å‡½æ•°è°ƒç”¨**: ç¡®è®¤æ³¨é‡Šæ‰çš„å‡½æ•°æ²¡æœ‰è¢«è°ƒç”¨

#### âœ… Git å†å²æ£€æŸ¥
- [ ] **ç¡®è®¤å¯æ¢å¤æ€§**: æ‰€æœ‰åˆ é™¤çš„ä»£ç éƒ½åœ¨ git å†å²ä¸­
- [ ] **æ£€æŸ¥ commit ä¿¡æ¯**: ç¡®ä¿æœ‰æ¸…æ™°çš„åˆ é™¤åŸå› è®°å½•

#### âœ… ç‰¹æ®Šæƒ…å†µæ£€æŸ¥
- [ ] **ä¿ç•™å‘åå…¼å®¹è¯´æ˜**: ä¸åˆ é™¤å¸¦"backward compatibility"çš„æ³¨é‡Š
- [ ] **ä¿ç•™ @deprecated æ ‡è®°**: ä¸åˆ é™¤åºŸå¼ƒAPIçš„æ–‡æ¡£æ³¨é‡Š
- [ ] **ä¿ç•™ä¸´æ—¶ç±»å‹è¯´æ˜**: ä¸åˆ é™¤"local type for compatibility"æ³¨é‡Š

### 5.2 åˆ é™¤åéªŒè¯ï¼ˆPost-deletion Verificationï¼‰

#### âœ… æ„å»ºéªŒè¯
- [ ] **å®Œæ•´æ„å»º**: `pnpm build > build.log 2>&1`
- [ ] **æ£€æŸ¥æ„å»ºæ—¥å¿—**: `tail -n 50 build.log` ç¡®è®¤æ— é”™è¯¯
- [ ] **åˆ†åŒ…æ„å»ºæµ‹è¯•**:
  ```bash
  cd packages/cli && pnpm build
  cd packages/core && pnpm build
  cd packages/frontend/editor-ui && pnpm build
  ```

#### âœ… ä»£ç è´¨é‡éªŒè¯
- [ ] **ç±»å‹æ£€æŸ¥é€šè¿‡**: `pnpm typecheck` æ— é”™è¯¯
- [ ] **Lint æ£€æŸ¥é€šè¿‡**: `pnpm lint` æ— é”™è¯¯
- [ ] **æ ¼å¼æ£€æŸ¥é€šè¿‡**: `pnpm format:check`

#### âœ… åŠŸèƒ½æµ‹è¯•
- [ ] **è¿è¡Œå•å…ƒæµ‹è¯•**:
  ```bash
  # è¿è¡Œå—å½±å“çš„æµ‹è¯•
  pnpm test:affected
  ```
- [ ] **æ‰‹åŠ¨æµ‹è¯•å…³é”®æµç¨‹**:
  - [ ] å·¥ä½œæµåˆ›å»ºå’Œç¼–è¾‘
  - [ ] èŠ‚ç‚¹æ·»åŠ å’Œé…ç½®ï¼ˆæ— å‡­è¯ï¼‰
  - [ ] å·¥ä½œæµæ‰§è¡Œ
  - [ ] é¡¹ç›®å’Œæ–‡ä»¶å¤¹æ“ä½œ
  - [ ] AI åŠŸèƒ½ï¼ˆå¦‚ä½¿ç”¨ AI Hubï¼‰

#### âœ… UI æµ‹è¯•ï¼ˆé’ˆå¯¹å‰ç«¯æ³¨é‡Šæ¸…ç†ï¼‰
- [ ] **é¡µé¢æ­£å¸¸æ¸²æŸ“**: æ£€æŸ¥ç›¸å…³é¡µé¢æ— æ˜¾ç¤ºé—®é¢˜
- [ ] **æ§åˆ¶å°æ— é”™è¯¯**: æµè§ˆå™¨æ§åˆ¶å°æ—  JS é”™è¯¯
- [ ] **äº¤äº’åŠŸèƒ½æ­£å¸¸**: æŒ‰é’®ã€è¡¨å•ç­‰äº¤äº’æ­£å¸¸

#### âœ… å›å½’æµ‹è¯•
- [ ] **æ£€æŸ¥å·²æœ‰åŠŸèƒ½**: ç¡®ä¿ç°æœ‰åŠŸèƒ½ä¸å—å½±å“
- [ ] **æ£€æŸ¥è¾¹ç•Œæƒ…å†µ**: æµ‹è¯•é”™è¯¯å¤„ç†ç­‰è¾¹ç•Œæƒ…å†µ

---

## 6. æ¸…ç†æ‰§è¡Œç­–ç•¥

### 6.1 æ¸è¿›å¼æ¸…ç†æ–¹æ¡ˆï¼ˆæ¨èï¼‰

#### é˜¶æ®µ 1: ä½é£é™©æ¸…ç†ï¼ˆç¬¬1å¤©ï¼‰
**ç›®æ ‡**: æ¸…ç†æ˜ç¡®ä¸ä¼šå½±å“åŠŸèƒ½çš„æ³¨é‡Š

**æ“ä½œ**:
1. æ¸…ç†æ‰€æœ‰æ³¨é‡Šæ‰çš„ import è¯­å¥
2. æ¸…ç†ç®€å•çš„å˜é‡å£°æ˜æ³¨é‡Š
3. æ¸…ç† HTML æ¨¡æ¿æ³¨é‡Š

**éªŒè¯**:
```bash
pnpm typecheck && pnpm lint && pnpm build
```

**é¢„æœŸç»“æœ**: å¯åˆ é™¤çº¦ 50-60 å¤„æ³¨é‡Š

---

#### é˜¶æ®µ 2: ä¸­é£é™©æ¸…ç†ï¼ˆç¬¬2å¤©ï¼‰
**ç›®æ ‡**: æ¸…ç†å¤§å—æ³¨é‡Šä»£ç 

**æ“ä½œ**:
1. æ¸…ç†æ³¨é‡Šæ‰çš„ç±»å‹å®šä¹‰
2. æ¸…ç†æ³¨é‡Šæ‰çš„å‡½æ•°å®ç°
3. æ¸…ç†æ³¨é‡Šæ‰çš„å¤§æ®µé€»è¾‘

**éªŒè¯**:
```bash
pnpm typecheck && pnpm lint
pnpm build
pnpm test:affected
```

**é¢„æœŸç»“æœ**: å¯åˆ é™¤çº¦ 150-200 å¤„æ³¨é‡Š

---

#### é˜¶æ®µ 3: æœ€ç»ˆæ¸…ç†å’ŒéªŒè¯ï¼ˆç¬¬3å¤©ï¼‰
**ç›®æ ‡**: æ¸…ç†å‰©ä½™æ³¨é‡Šå¹¶å…¨é¢æµ‹è¯•

**æ“ä½œ**:
1. æ¸…ç†ä¾èµ–æ³¨å…¥å‚æ•°æ³¨é‡Š
2. æ¸…ç†å‰©ä½™é›¶æ•£æ³¨é‡Š
3. å…¨é¢æµ‹è¯•

**éªŒè¯**:
```bash
pnpm build
pnpm typecheck
pnpm lint
pnpm test
# æ‰‹åŠ¨UIæµ‹è¯•
```

**é¢„æœŸç»“æœ**: å®Œæˆæ‰€æœ‰æ¸…ç†ï¼Œç³»ç»Ÿç¨³å®šè¿è¡Œ

### 6.2 ä¸€æ¬¡æ€§æ¸…ç†æ–¹æ¡ˆï¼ˆæ¿€è¿›ï¼Œä¸æ¨èï¼‰

âš ï¸ **é£é™©é«˜ï¼Œä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒ**

**æ“ä½œ**: ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰å¯åˆ é™¤çš„æ³¨é‡Š

**è¦æ±‚**:
- æœ‰å®Œæ•´çš„æµ‹è¯•è¦†ç›–
- æœ‰å¿«é€Ÿå›æ»šèƒ½åŠ›
- åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯

---

## 7. è‡ªåŠ¨åŒ–æ¸…ç†å·¥å…·

### 7.1 æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…

#### æ¨¡å¼ 1: æ³¨é‡Šæ‰çš„ import
```bash
# æŸ¥æ‰¾
grep -rn "^[[:space:]]*// import .* from ['\"]\|^[[:space:]]*// import {" packages/ \
  --include="*.ts" --include="*.vue" \
  | grep -v "node_modules"

# æç¤º: å¯ä»¥ç”¨ sed æ‰¹é‡åˆ é™¤ï¼Œä½†è¦å°å¿ƒ
```

#### æ¨¡å¼ 2: æ³¨é‡Šæ‰çš„å•è¡Œå˜é‡å£°æ˜
```bash
# æŸ¥æ‰¾
grep -rn "^[[:space:]]*// (const|let|var) [a-zA-Z_]" packages/ \
  --include="*.ts" --include="*.vue" \
  | grep -v "node_modules"
```

#### æ¨¡å¼ 3: Vue HTML æ³¨é‡Šå—
```bash
# æŸ¥æ‰¾
grep -rn "<!--.*Credential system" packages/frontend/ \
  --include="*.vue"
```

### 7.2 è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

#### å®‰å…¨æ¸…ç†è„šæœ¬
```bash
#!/bin/bash

# åˆ›å»ºå¤‡ä»½åˆ†æ”¯
git checkout -b cleanup-commented-code-backup

# æ¸…ç†æ³¨é‡Šæ‰çš„ import è¯­å¥ï¼ˆTypeScriptï¼‰
find packages -name "*.ts" -type f -exec sed -i.bak '/^[[:space:]]*\/\/ import .* from/d' {} \;

# æ¸…ç†æ³¨é‡Šæ‰çš„ import è¯­å¥ï¼ˆVueï¼‰
find packages/frontend -name "*.vue" -type f -exec sed -i.bak '/^[[:space:]]*\/\/ import .* from/d' {} \;

# åˆ é™¤å¤‡ä»½æ–‡ä»¶
find packages -name "*.bak" -delete

# éªŒè¯
pnpm typecheck && pnpm lint

echo "æ¸…ç†å®Œæˆï¼Œè¯·è¿è¡Œæ„å»ºå’Œæµ‹è¯•éªŒè¯"
```

âš ï¸ **è­¦å‘Š**:
- è¿™ä¸ªè„šæœ¬åªæ˜¯ç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨å‰åŠ¡å¿…æµ‹è¯•
- å»ºè®®æ‰‹åŠ¨å®¡æŸ¥æ¯ä¸ªåˆ é™¤
- ä½¿ç”¨ git åˆ†æ”¯ä¿æŠ¤

---

## 8. å»ºè®®å’Œæœ€ä½³å®è·µ

### 8.1 æ¸…ç†å»ºè®®

#### âœ… DOï¼ˆæ¨èåšæ³•ï¼‰

1. **ä¿ç•™æœ‰ä»·å€¼çš„æ³¨é‡Š**
   - ä¿ç•™æ‰€æœ‰"Credential system has been removed"è¯´æ˜
   - ä¿ç•™æ‰€æœ‰ @deprecated æ ‡è®°
   - ä¿ç•™å‘åå…¼å®¹è¯´æ˜

2. **æ¸è¿›å¼æ¸…ç†**
   - åˆ†é˜¶æ®µæ¸…ç†ï¼Œæ¯é˜¶æ®µéªŒè¯
   - ä¼˜å…ˆæ¸…ç†é£é™©ä½çš„éƒ¨åˆ†
   - æ¯æ¬¡æ¸…ç†åè¿è¡Œæµ‹è¯•

3. **ä½¿ç”¨ Git åˆ†æ”¯**
   - åœ¨æ–°åˆ†æ”¯ä¸Šæ¸…ç†
   - ä¿ç•™åŸåˆ†æ”¯ä½œä¸ºå¤‡ä»½
   - æ¸…ç†å®Œæˆååˆå¹¶

4. **å……åˆ†æµ‹è¯•**
   - è¿è¡Œæ‰€æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•
   - æ‰‹åŠ¨æµ‹è¯•å…³é”®åŠŸèƒ½
   - åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯

5. **è®°å½•æ¸…ç†è¿‡ç¨‹**
   - åœ¨ commit ä¸­è¯´æ˜æ¸…ç†å†…å®¹
   - è®°å½•åˆ é™¤çš„ä»£ç è¡Œæ•°
   - è®°å½•é‡åˆ°çš„é—®é¢˜

#### âŒ DON'Tï¼ˆé¿å…åšæ³•ï¼‰

1. **ç›²ç›®ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·**
   - ä¸è¦ä¸ç»å®¡æŸ¥å°±æ‰¹é‡åˆ é™¤
   - ä¸è¦ä¾èµ–æ­£åˆ™è¡¨è¾¾å¼è¦†ç›–æ‰€æœ‰æƒ…å†µ

2. **åˆ é™¤æœ‰ä»·å€¼çš„æ³¨é‡Š**
   - ä¸è¦åˆ é™¤è¯´æ˜æ€§æ³¨é‡Š
   - ä¸è¦åˆ é™¤ @deprecated æ ‡è®°
   - ä¸è¦åˆ é™¤å‘åå…¼å®¹è¯´æ˜

3. **è·³è¿‡éªŒè¯æ­¥éª¤**
   - ä¸è¦ä¸æµ‹è¯•å°±æäº¤
   - ä¸è¦è·³è¿‡ç±»å‹æ£€æŸ¥
   - ä¸è¦å¿½è§† lint é”™è¯¯

4. **ä¸€æ¬¡æ€§å¤§é‡ä¿®æ”¹**
   - ä¸è¦ä¸€æ¬¡æ¸…ç†æ‰€æœ‰æ–‡ä»¶
   - ä¸è¦åœ¨ç”Ÿäº§åˆ†æ”¯ä¸Šç›´æ¥æ“ä½œ
   - ä¸è¦ä¸åˆ›å»ºå¤‡ä»½

### 8.2 æ–‡ä»¶ä¼˜å…ˆçº§æ¸…å•

#### ğŸ”´ **é«˜ä¼˜å…ˆçº§æ¸…ç†æ–‡ä»¶**ï¼ˆé£é™©ä½ï¼Œå½±å“å¤§ï¼‰

1. **å‰ç«¯ Vue ç»„ä»¶**
   - `packages/frontend/editor-ui/src/features/core/folders/components/MoveToFolderModal.vue`
   - `packages/frontend/editor-ui/src/app/components/Modals.vue`
   - é¢„è®¡æ¸…ç†: 50+ è¡Œ

2. **å‰ç«¯å·¥å…·å‡½æ•°**
   - `packages/frontend/editor-ui/src/app/utils/nodeTypesUtils.ts`
   - `packages/frontend/editor-ui/src/app/composables/useNodeHelpers.ts`
   - é¢„è®¡æ¸…ç†: 30+ è¡Œ

3. **åç«¯ç±»å‹å®šä¹‰**
   - `packages/@n8n/db/src/entities/types-db.ts`
   - `packages/workflow/src/interfaces.ts`
   - é¢„è®¡æ¸…ç†: 40+ è¡Œ

#### ğŸŸ¡ **ä¸­ä¼˜å…ˆçº§æ¸…ç†æ–‡ä»¶**ï¼ˆéœ€è¦ä»”ç»†æ£€æŸ¥ï¼‰

4. **åç«¯æœåŠ¡**
   - `packages/cli/src/workflows/workflow.service.ee.ts`
   - `packages/cli/src/services/frontend.service.ts`
   - é¢„è®¡æ¸…ç†: 60+ è¡Œ

5. **æ ¸å¿ƒæ‰§è¡Œå¼•æ“**
   - `packages/core/src/execution-engine/node-execution-context/utils/request-helper-functions.ts`
   - `packages/core/src/execution-engine/routing-node.ts`
   - é¢„è®¡æ¸…ç†: 100+ è¡Œ

#### ğŸŸ¢ **ä½ä¼˜å…ˆçº§æ¸…ç†æ–‡ä»¶**ï¼ˆå¯ä»¥å»¶åï¼‰

6. **æµ‹è¯•æ–‡ä»¶**
   - å„ç§ `*.test.ts` æ–‡ä»¶
   - é¢„è®¡æ¸…ç†: 20+ è¡Œ

---

## 9. é£é™©çŸ©é˜µ

| æ³¨é‡Šç±»å‹ | é£é™©ç­‰çº§ | å»ºè®®æ“ä½œ | é¢„è®¡å·¥ä½œé‡ | æ”¶ç›Š |
|---------|---------|---------|-----------|------|
| æ³¨é‡Šæ‰çš„ import | ğŸŸ¢ ä½ | ç«‹å³æ¸…ç† | 0.5 å°æ—¶ | é«˜ |
| æ³¨é‡Šæ‰çš„å˜é‡å£°æ˜ | ğŸŸ¢ ä½ | ç«‹å³æ¸…ç† | 0.5 å°æ—¶ | é«˜ |
| HTML æ³¨é‡Šå— | ğŸŸ¢ ä½ | ç«‹å³æ¸…ç† | 1 å°æ—¶ | ä¸­ |
| æ³¨é‡Šæ‰çš„ç±»å‹å®šä¹‰ | ğŸŸ¡ ä¸­ | éªŒè¯åæ¸…ç† | 2 å°æ—¶ | é«˜ |
| æ³¨é‡Šæ‰çš„å‡½æ•°å®ç° | ğŸŸ¡ ä¸­ | éªŒè¯åæ¸…ç† | 3 å°æ—¶ | é«˜ |
| å¤§æ®µæ³¨é‡Šé€»è¾‘ | ğŸŸ¡ ä¸­ | éªŒè¯åæ¸…ç† | 2 å°æ—¶ | ä¸­ |
| è¯´æ˜æ€§æ³¨é‡Š | ğŸ”´ é«˜ | ä¿ç•™ | - | - |
| @deprecated æ ‡è®° | ğŸ”´ é«˜ | ä¿ç•™ | - | - |

**æ€»é¢„è®¡æ¸…ç†å·¥ä½œé‡**: çº¦ 9 å°æ—¶ï¼ˆåˆ†3å¤©å®Œæˆï¼‰

---

## 10. æ¸…ç†åçš„ä»£ç å¥åº·æŒ‡æ ‡

### é¢„æœŸæ”¹å–„

| æŒ‡æ ‡ | æ¸…ç†å‰ | æ¸…ç†å | æ”¹å–„ |
|------|--------|--------|------|
| æ€»ä»£ç è¡Œæ•° | - | - | çº¦ -200 è¡Œ |
| æ³¨é‡Šè¡Œæ•° | 440 è¡Œæ–°å¢æ³¨é‡Š | çº¦ 200 è¡Œ | -240 è¡Œ |
| æ— æ•ˆä»£ç è¡Œæ•° | çº¦ 250 è¡Œ | 0 è¡Œ | -250 è¡Œ |
| ä»£ç å¯è¯»æ€§ | ä¸­ | é«˜ | â¬†ï¸ |
| ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ | â¬‡ï¸ |

### è´¨é‡æ ‡å‡†

æ¸…ç†ååº”è¾¾åˆ°:
- âœ… `pnpm typecheck` æ— é”™è¯¯
- âœ… `pnpm lint` æ— é”™è¯¯
- âœ… `pnpm build` æˆåŠŸ
- âœ… `pnpm test` é€šè¿‡ç‡ 100%
- âœ… ä»£ç ä¸­æ— å¤§æ®µæ³¨é‡Šæ‰çš„ä»£ç 
- âœ… ä¿ç•™æ‰€æœ‰æœ‰ä»·å€¼çš„è¯´æ˜æ³¨é‡Š

---

## 11. æ€»ç»“

### æ ¸å¿ƒåŸåˆ™
1. **ä¿å®ˆæ¸…ç†**: æœ‰ç–‘é—®æ—¶ä¿ç•™ï¼Œä¸ç¡®å®šæ—¶ä¸åˆ 
2. **æ¸è¿›å¼éªŒè¯**: æ¯æ­¥æ¸…ç†åéƒ½è¦éªŒè¯
3. **ä¿ç•™æ–‡æ¡£**: è¯´æ˜æ€§æ³¨é‡Šå’Œ @deprecated å¿…é¡»ä¿ç•™
4. **Git ä¿æŠ¤**: ä½¿ç”¨åˆ†æ”¯ï¼Œä¿ç•™å†å²

### é¢„æœŸæˆæœ
- åˆ é™¤çº¦ 200-250 è¡Œæ— ç”¨æ³¨é‡Šä»£ç 
- ä¿ç•™çº¦ 70-80 è¡Œæœ‰ä»·å€¼çš„è¯´æ˜æ³¨é‡Š
- ä»£ç å¯è¯»æ€§æ˜¾è‘—æå‡
- ç»´æŠ¤æˆæœ¬æ˜æ˜¾é™ä½
- ç³»ç»ŸåŠŸèƒ½å®Œå…¨æ­£å¸¸

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. åˆ›å»ºæ¸…ç†åˆ†æ”¯: `git checkout -b cleanup-commented-code`
2. ä»ä¼˜å…ˆçº§ 1 å¼€å§‹æ¸…ç†
3. æ¯é˜¶æ®µæ¸…ç†åè¿è¡ŒéªŒè¯
4. è®°å½•æ¸…ç†è¿‡ç¨‹å’Œé‡åˆ°çš„é—®é¢˜
5. å®Œæˆååˆå¹¶åˆ°ä¸»åˆ†æ”¯

---

## é™„å½• A: å¿«é€Ÿå‚è€ƒå‘½ä»¤

### æŸ¥æ‰¾æ³¨é‡Šä»£ç 
```bash
# æŸ¥æ‰¾æ‰€æœ‰æ³¨é‡Šæ‰çš„ import
grep -rn "^[[:space:]]*// import" packages/ --include="*.ts" --include="*.vue" | wc -l

# æŸ¥æ‰¾æ‰€æœ‰"Credential system has been removed"æ³¨é‡Š
grep -rn "Credential system has been removed" packages/ | wc -l

# æŸ¥æ‰¾å¤§å—æ³¨é‡Šä»£ç ï¼ˆè¿ç»­ 5 è¡Œä»¥ä¸Šï¼‰
git diff HEAD | awk '/^+.*\/\//{ count++ } /^[^+]|^+[^/]/{if(count>5) print count; count=0}'
```

### éªŒè¯å‘½ä»¤
```bash
# å®Œæ•´éªŒè¯æµç¨‹
pnpm typecheck && pnpm lint && pnpm build && pnpm test:affected

# å¿«é€ŸéªŒè¯ï¼ˆä¸å«æµ‹è¯•ï¼‰
pnpm typecheck && pnpm lint

# åˆ†åŒ…éªŒè¯
cd packages/cli && pnpm typecheck && pnpm lint
cd packages/core && pnpm typecheck && pnpm lint
cd packages/frontend/editor-ui && pnpm typecheck && pnpm lint
```

### Git æ“ä½œ
```bash
# åˆ›å»ºæ¸…ç†åˆ†æ”¯
git checkout -b cleanup-commented-code-$(date +%Y%m%d)

# æŸ¥çœ‹æ”¹åŠ¨ç»Ÿè®¡
git diff --stat
git diff --numstat | awk '{print $1, $2, $3}'

# æš‚å­˜éƒ¨åˆ†ä¿®æ”¹ï¼ˆäº¤äº’å¼ï¼‰
git add -p

# æŸ¥çœ‹ç‰¹å®šæ–‡ä»¶çš„æ”¹åŠ¨
git diff packages/cli/src/workflows/workflow.service.ee.ts
```

---

## é™„å½• B: å…³é”®æ–‡ä»¶æ¸…ç†æ¸…å•

### éœ€è¦æ¸…ç†çš„å…³é”®æ–‡ä»¶åŠé¢„ä¼°

| æ–‡ä»¶è·¯å¾„ | æ³¨é‡Šè¡Œæ•° | é£é™©ç­‰çº§ | é¢„è®¡æ—¶é—´ |
|---------|---------|---------|----------|
| `packages/workflow/src/interfaces.ts` | 50+ | ä¸­ | 1h |
| `packages/core/src/execution-engine/node-execution-context/utils/request-helper-functions.ts` | 80+ | ä¸­ | 1.5h |
| `packages/cli/src/workflows/workflow.service.ee.ts` | 40+ | ä¸­ | 1h |
| `packages/frontend/editor-ui/src/features/core/folders/components/MoveToFolderModal.vue` | 30+ | ä½ | 0.5h |
| `packages/frontend/editor-ui/src/app/composables/useNodeHelpers.ts` | 20+ | ä½ | 0.5h |
| å…¶ä»–æ–‡ä»¶ | 30+ | ä½ | 1h |

**æ€»è®¡**: çº¦ 250 è¡Œï¼Œ6.5 å°æ—¶

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-10
**æœ€åæ›´æ–°**: 2025-11-10
**é€‚ç”¨èŒƒå›´**: n8n å‡­è¯ç³»ç»Ÿåˆ é™¤åçš„æ³¨é‡Šä»£ç æ¸…ç†
**è´£ä»»äºº**: å¼€å‘å›¢é˜Ÿ
