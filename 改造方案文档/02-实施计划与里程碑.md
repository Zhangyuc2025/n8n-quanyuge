# n8n å¤šç§Ÿæˆ·æ¶æ„ - å®æ–½è®¡åˆ’ä¸é‡Œç¨‹ç¢‘ï¼ˆä¼˜åŒ–ç‰ˆï¼‰

> **é…å¥—æ–‡æ¡£ï¼š** 01-n8nå¤šç§Ÿæˆ·æ¶æ„å®Œæ•´æ–¹æ¡ˆ.md (v3.0)
> **ç‰ˆæœ¬ï¼š** v3.4ï¼ˆé˜¶æ®µ5å‰ç«¯æ”¹é€ å®Œæˆç‰ˆï¼‰
> **æ—¥æœŸï¼š** 2025-11-08
> **æ€»å·¥æœŸï¼š** 12å‘¨ï¼ˆçº¦3ä¸ªæœˆï¼‰
> **ä¼˜åŒ–é‡ç‚¹ï¼š** æŒ‰æŠ€æœ¯ä¾èµ–å±‚çº§é‡ç»„ã€å…³è”æ¨¡å—åŒæ­¥å¤„ç†ã€é£é™©å‰ç½®
> **å½“å‰è¿›åº¦ï¼š** é˜¶æ®µ 0-5 å®Œæˆï¼ˆçº¦ 80%ï¼‰

---

## ğŸ¯ å®æ–½è¿›åº¦æ€»è§ˆ

**å¼€å§‹æ—¥æœŸï¼š** 2025-01-07
**å½“å‰é˜¶æ®µï¼š** é˜¶æ®µ 5 å®Œæˆï¼ˆ100%ï¼‰ï¼Œå‡†å¤‡è¿›å…¥é˜¶æ®µ 6 æ”¯ä»˜é›†æˆ
**å®Œæˆåº¦ï¼š** ~80%ï¼ˆ8/13 ä¸ªé˜¶æ®µï¼‰

| é˜¶æ®µ | ä»»åŠ¡ | çŠ¶æ€ | å®Œæˆåº¦ | å®Œæˆæ—¥æœŸ |
|------|------|------|---------|---------|
| **é˜¶æ®µ 0** | å‡†å¤‡é˜¶æ®µ | âœ… å®Œæˆ | 100% | 2025-01-07 |
| **é˜¶æ®µ 1** | æ•°æ®åº“è¿ç§»è„šæœ¬åˆ›å»º | âœ… å®Œæˆ | 100% | 2025-01-07 |
| **é˜¶æ®µ 2** | Entity + Repository å±‚é‡æ„ | âœ… å®Œæˆ | 100% | 2025-01-07 |
| **é˜¶æ®µ 3** | Service å±‚å¼€å‘ | âœ… å®Œæˆ | 100% | 2025-01-07 |
| **é˜¶æ®µ 3.1** | æ’ä»¶ç®¡ç†ç³»ç»Ÿ | âœ… å®Œæˆ | 100% | 2025-01-07 |
| **é˜¶æ®µ 4** | Controller + Middleware + æµ‹è¯•é‡æ„ | âœ… å®Œæˆ | 100% | 2025-11-08 |
| **é˜¶æ®µ 5** | å‰ç«¯æ”¹é€  | âœ… å®Œæˆ | 100% | 2025-11-08 |
| **é˜¶æ®µ 6** | æ”¯ä»˜é›†æˆ | â¬œ å¾…å¼€å§‹ | 0% | - |
| **é˜¶æ®µ 7** | æµ‹è¯•å’Œä¼˜åŒ– | â¬œ å¾…å¼€å§‹ | 0% | - |

### ğŸ“Š å…³é”®æˆæœ

**é˜¶æ®µ 0-1 å·²å®Œæˆï¼š**
- âœ… 6 ä¸ªæ•°æ®åº“è¿ç§»è„šæœ¬ï¼ˆ1,768 è¡Œä»£ç ï¼ŒåŒ…å«æ’ä»¶ç³»ç»Ÿæ‰©å±•ï¼‰
- âœ… 6 ä¸ªé…å¥—æ–‡æ¡£ï¼ˆ1,916 è¡Œï¼‰
- âœ… è·¨æ•°æ®åº“å…¼å®¹ï¼ˆPostgreSQLã€MySQLã€SQLiteï¼‰
- âœ… å®Œæ•´çš„ up/down å›æ»šæ”¯æŒ
- âœ… æ’å…¥ 18 æ¡åˆå§‹æ•°æ®

**é˜¶æ®µ 2 å·²å®Œæˆï¼š**
- âœ… åˆ é™¤ SharedWorkflow/SharedCredentialsï¼ˆ5 ä¸ªæ–‡ä»¶ï¼‰
- âœ… é‡æ„ 50+ ä¸ªä¸šåŠ¡æ–‡ä»¶ï¼ˆworkflows, credentials, services, controllers ç­‰ï¼‰
- âœ… åˆ›å»º 5 ä¸ªæ–° Entity æ–‡ä»¶ï¼ˆPlatformServiceã€PlatformFeatureConfigã€PlatformRagServiceã€WorkspaceBalanceã€WorkspacePluginCredentialsï¼‰
- âœ… åˆ›å»º 2 ä¸ªæ–° Repository æ–‡ä»¶ï¼ˆWorkspaceBalanceã€WorkspacePluginCredentialsï¼ŒåŒ…å«æ‚²è§‚é”å®ç°ï¼‰
- âœ… æ›´æ–° WorkflowEntityã€CredentialsEntityã€Project ç›´æ¥å…³ç³»
- âœ… å®Œå…¨æ¸…é™¤ SharedWorkflow/SharedCredentials å¼•ç”¨ï¼ˆ0 æ®‹ç•™ï¼‰
- âœ… Entity/Repository æ€»ä»£ç é‡ï¼š5,315 è¡Œ

**é˜¶æ®µ 3 å·²å®Œæˆï¼š**
- âœ… WorkspaceContextServiceï¼ˆå·¥ä½œç©ºé—´ä¸Šä¸‹æ–‡ç®¡ç†ï¼‰
- âœ… BillingServiceï¼ˆæ ¸å¿ƒè®¡è´¹æœåŠ¡ï¼Œå¸¦æ‚²è§‚é”å’Œ InsufficientBalanceErrorï¼‰
- âœ… PlatformServiceServiceï¼ˆAI æœåŠ¡ç®¡ç†ï¼‰
- âœ… PlatformRagServiceï¼ˆRAG çŸ¥è¯†åº“æœåŠ¡ï¼‰
- âœ… PlatformFeatureServiceï¼ˆåŠŸèƒ½é…ç½®æœåŠ¡ï¼‰
- âœ… å¢å¼º ProjectServiceï¼ˆæ–°å¢ 4 ä¸ªå·¥ä½œç©ºé—´æ–¹æ³•ï¼‰
- âœ… Service å±‚æ€»ä»£ç é‡ï¼š6,249 è¡Œï¼ˆè¿œè¶…é¢„ä¼°ï¼‰
- âœ… å®Œæ•´çš„ä¾èµ–æ³¨å…¥å’Œé”™è¯¯å¤„ç†

**é˜¶æ®µ 3.1 å·²å®Œæˆï¼ˆæ’ä»¶ç®¡ç†ç³»ç»Ÿï¼‰ï¼š**
- âœ… æ‰©å±• platform_service è¡¨æ”¯æŒæ’ä»¶ç®¡ç†ï¼ˆdescription ç­‰ 14 ä¸ªå­—æ®µï¼‰
- âœ… åˆ›å»º workspace_plugin_credentials è¡¨å­˜å‚¨ç”¨æˆ·é…ç½®çš„ API Key
- âœ… åˆ›å»º WorkspacePluginCredentials Entity å’Œ Repository
- âœ… åˆ›å»º PluginValidatorServiceï¼ˆTypeScript è¯­æ³•æ£€æŸ¥ + å®‰å…¨éªŒè¯ï¼Œ7,538 bytesï¼‰
- âœ… åˆ›å»º AdminPluginsControllerï¼ˆå¹³å°/ç¬¬ä¸‰æ–¹æ’ä»¶ç®¡ç† + å®¡æ ¸ï¼Œ9,392 bytesï¼‰
- âœ… åˆ›å»º PluginsControllerï¼ˆç”¨æˆ·ä¸Šä¼ /æäº¤/ç®¡ç†è‡ªå®šä¹‰æ’ä»¶ï¼Œ10,267 bytesï¼‰
- âœ… æ›´æ–° PlatformServiceService æ·»åŠ æ’ä»¶æŸ¥è¯¢æ–¹æ³•
- âœ… æ’ä»¶ç³»ç»Ÿæ€»ä»£ç é‡ï¼šçº¦ 1,500 è¡Œ
- âœ… æ”¯æŒä¸‰å±‚æ’ä»¶ç³»ç»Ÿï¼šå¹³å°æ’ä»¶ã€ç¬¬ä¸‰æ–¹æ’ä»¶ã€è‡ªå®šä¹‰æ’ä»¶
- âœ… å®Œæ•´çš„æ’ä»¶æäº¤å’Œå®¡æ ¸æµç¨‹
- âœ… ä»£ç å®‰å…¨éªŒè¯ï¼ˆç¦ç”¨å±é™©æ“ä½œã€ä¾èµ–ç™½åå•ï¼‰
- âœ… å…¨é‡æ„å»ºæˆåŠŸï¼ˆ42/42 ä»»åŠ¡é€šè¿‡ï¼‰

**é˜¶æ®µ 4 å·²å®Œæˆï¼ˆ100%ï¼‰- 2025-11-08ï¼š**

**Controller å±‚ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… PluginsControllerï¼ˆç”¨æˆ·ç«¯æ’ä»¶ç®¡ç†ï¼Œ372 è¡Œï¼‰
- âœ… AdminPluginsControllerï¼ˆç®¡ç†ç«¯æ’ä»¶ç®¡ç†ï¼Œ355 è¡Œï¼‰
- âœ… BillingControllerï¼ˆè®¡è´¹ APIï¼Œ400 è¡Œï¼Œ5 ä¸ªç«¯ç‚¹ï¼‰
- âœ… AdminPlatformServicesControllerï¼ˆå¹³å°æœåŠ¡ç®¡ç†ï¼Œ540 è¡Œï¼Œ9 ä¸ªç«¯ç‚¹ï¼‰
- âœ… AdminWorkspacesControllerï¼ˆå·¥ä½œç©ºé—´åå°ç®¡ç†ï¼Œ501 è¡Œï¼Œ6 ä¸ªç«¯ç‚¹ï¼‰
- âœ… AdminStatsControllerï¼ˆç»Ÿè®¡æ•°æ®ï¼Œ356 è¡Œï¼Œ4 ä¸ªç«¯ç‚¹ï¼‰

**ä¸­é—´ä»¶å±‚ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… WorkspaceContextMiddlewareï¼ˆ94 è¡Œï¼‰
  - ä» HTTP Header (X-Workspace-Id) æå–å·¥ä½œç©ºé—´ ID
  - UUID æ ¼å¼éªŒè¯
  - ç”¨æˆ·æƒé™æ£€æŸ¥ï¼ˆisUserInWorkspaceï¼‰
  - å·¥ä½œç©ºé—´ä¸Šä¸‹æ–‡æ³¨å…¥åˆ° req.workspaceContext
- âœ… RateLimitMiddlewareï¼ˆ195 è¡Œï¼‰
  - åŸºäºå·¥ä½œç©ºé—´çš„é€Ÿç‡é™åˆ¶ï¼ˆæ»‘åŠ¨çª—å£ç®—æ³•ï¼‰
  - é»˜è®¤é™åˆ¶ï¼š60ç§’/100æ¬¡è¯·æ±‚
  - æ ‡å‡† HTTP Headers (X-RateLimit-*)
  - è‡ªåŠ¨æ¸…ç†è¿‡æœŸè®°å½•

**Controller æ›´æ–°ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… WorkflowsController
  - æ·»åŠ  WorkspaceContextMiddleware ä¾èµ–æ³¨å…¥
  - ç¡®è®¤ç°æœ‰ @ProjectScope æœºåˆ¶å·²å®ç°å·¥ä½œç©ºé—´éš”ç¦»
- âœ… CredentialsController
  - æ·»åŠ  WorkspaceContextMiddleware ä¾èµ–æ³¨å…¥
  - ç¡®è®¤ç°æœ‰ @ProjectScope æœºåˆ¶å·²å®ç°å·¥ä½œç©ºé—´éš”ç¦»

**æµ‹è¯•æ–‡ä»¶é‡æ„ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… é‡æ„ 29 ä¸ªæµ‹è¯•æ–‡ä»¶ç§»é™¤ SharedWorkflow/SharedCredentials å¼•ç”¨
- âœ… ä¿®å¤ 101 ä¸ªç±»å‹é”™è¯¯é™åˆ° 0 ä¸ªï¼ˆ100% ä¿®å¤ç‡ï¼‰
  - ä¿®å¤ 6 ä¸ªæ„é€ å‡½æ•°å‚æ•°ä¸åŒ¹é…
  - ä¿®å¤ 2 ä¸ª SharedCredentials mock é”™è¯¯
  - ä¿®å¤ 11 ä¸ª WorkflowFinderService æ–¹æ³•å¼•ç”¨é”™è¯¯
  - æ¸…ç† 19 ä¸ªæœªä½¿ç”¨å˜é‡å£°æ˜
  - ä¿®å¤ 2 ä¸ª LicenseState å¯¼å…¥é”™è¯¯
  - æ·»åŠ  3 ä¸ª @ts-expect-error æ³¨é‡Šå¤„ç†æ·±å±‚ç±»å‹ç³»ç»Ÿé—®é¢˜
- âœ… åˆ é™¤ License ç³»ç»Ÿç›¸å…³æµ‹è¯•ä»£ç ï¼ˆ155 è¡Œï¼‰
  - åˆ é™¤ 10 ä¸ª license.enable() è°ƒç”¨
  - åˆ é™¤ 3 ä¸ª license.setQuota() è°ƒç”¨
  - åˆ é™¤ 3 ä¸ªæµ‹è¯•ç”¨ä¾‹æ£€æŸ¥æœªæˆæƒ/quotaé™åˆ¶çš„åŠŸèƒ½
- âœ… å‡€å‡å°‘ä»£ç  ~6,720 è¡Œï¼ˆ+4,245 / -10,965ï¼‰

**ç±»å‹é”™è¯¯ä¿®å¤ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… ä¿®å¤ @n8n/config ç±»å‹æ£€æŸ¥é”™è¯¯ï¼ˆposthogConfig åºŸå¼ƒï¼‰
- âœ… ä¿®å¤ AdminPlatformServicesController æƒé™æ£€æŸ¥ï¼ˆä½¿ç”¨ GLOBAL_ADMIN_ROLEï¼‰
- âœ… ä¿®å¤ BillingController æœªä½¿ç”¨å˜é‡
- âœ… ä¿®å¤ä¸­é—´ä»¶ç±»å‹æ¨æ–­é—®é¢˜
- âœ… ä¿®å¤ Time å¸¸é‡å¯¼å…¥ï¼ˆä» @n8n/constantsï¼‰
- âœ… ä¿®å¤ log-streaming-event-relay æµ‹è¯•é”™è¯¯

**Service å±‚ä¼˜åŒ–ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… ç§»é™¤æœªä½¿ç”¨çš„ ProjectRepository æ³¨å…¥ï¼ˆcredentials.service.ee.tsï¼‰
- âœ… ç§»é™¤æœªä½¿ç”¨çš„ ProjectService æ³¨å…¥ï¼ˆcredentials-permission-checker.tsï¼‰
- âœ… ç®€åŒ– ProvisioningControllerï¼ˆåˆ é™¤ LicenseStateï¼‰
- âœ… æ¸…ç† server.ts æœªä½¿ç”¨ä»£ç ï¼ˆhelmet, å®‰å…¨å¤´, å†å²å¤„ç†ï¼‰

**æ€»è®¡æ–°å¢ä»£ç ï¼š** 2,124 è¡Œï¼ˆ6 ä¸ª Controller + 2 ä¸ªä¸­é—´ä»¶ï¼Œ31 ä¸ª API ç«¯ç‚¹ï¼‰
**æµ‹è¯•é‡æ„ä»£ç å˜æ›´ï¼š** 78 ä¸ªæ–‡ä»¶ï¼Œå‡€å‡å°‘ 6,720 è¡Œ
**éªŒè¯ç»“æœï¼š** âœ… pnpm typecheck - 0 errors âœ… biome check - é€šè¿‡

**é˜¶æ®µ 5 å·²å®Œæˆï¼ˆ100%ï¼‰- 2025-11-08ï¼š**

**API å±‚ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… billing.api.tsï¼ˆ219 è¡Œï¼‰
  - getWorkspaceBalance - è·å–å·¥ä½œç©ºé—´ä½™é¢
  - recharge - å……å€¼
  - getUsageRecords - è·å–ä½¿ç”¨è®°å½•ï¼ˆæ”¯æŒåˆ†é¡µå’Œæ—¥æœŸç­›é€‰ï¼‰
  - getRechargeRecords - è·å–å……å€¼è®°å½•ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
  - getUsageSummary - è·å–æœˆåº¦ä½¿ç”¨æ±‡æ€»
- âœ… platformServices.api.tsï¼ˆ278 è¡Œï¼‰
  - getAllPlatformServices - è·å–æ‰€æœ‰å¹³å°æœåŠ¡
  - getAvailableServices - è·å–å¯ç”¨æœåŠ¡ï¼ˆæ ¹æ®å·¥ä½œç©ºé—´ï¼‰
  - invokeService - è°ƒç”¨å¹³å°æœåŠ¡
  - getRagService - è·å– RAG æœåŠ¡è¯¦æƒ…
  - searchKnowledge - æœç´¢çŸ¥è¯†åº“
  - getServiceCallHistory - è·å–æœåŠ¡è°ƒç”¨å†å²
- âœ… plugins.api.tsï¼ˆ354 è¡Œï¼‰
  - getAllPlugins - è·å–æ‰€æœ‰æ’ä»¶ï¼ˆå¹³å°/ç¬¬ä¸‰æ–¹/è‡ªå®šä¹‰ï¼‰
  - getAvailablePlugins - è·å–å¯ç”¨æ’ä»¶
  - getMyPlugins - è·å–æˆ‘çš„å·²é…ç½®æ’ä»¶
  - configureCredentials - é…ç½®æ’ä»¶å‡­è¯
  - fetchCredentials - è·å–å·²é…ç½®å‡­è¯
  - deleteCredentials - åˆ é™¤æ’ä»¶å‡­è¯
  - uploadPlugin - ä¸Šä¼ è‡ªå®šä¹‰æ’ä»¶
  - deletePlugin - åˆ é™¤è‡ªå®šä¹‰æ’ä»¶

**Pinia Store å±‚ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… billing.store.tsï¼ˆ285 è¡Œï¼‰
  - ä½™é¢ç®¡ç†ï¼ˆbalance, hasLowBalanceï¼‰
  - ä½¿ç”¨è®°å½•ç®¡ç†ï¼ˆusageRecords, usagePaginationï¼‰
  - å……å€¼è®°å½•ç®¡ç†ï¼ˆrechargeRecords, rechargePaginationï¼‰
  - æœˆåº¦æ±‡æ€»ï¼ˆusageSummaryï¼‰
  - è´§å¸æ ¼å¼åŒ–ï¼ˆcurrencySymbol, formattedBalanceï¼‰
- âœ… plugins.store.tsï¼ˆ427 è¡Œï¼‰
  - ä¸‰å±‚æ’ä»¶åˆ†ç±»ï¼ˆplatformPlugins, thirdPartyPlugins, customPluginsï¼‰
  - å·²é…ç½®æ’ä»¶è¿½è¸ªï¼ˆconfiguredPlugins, isPluginConfiguredï¼‰
  - æ’ä»¶å‡­è¯ç®¡ç†ï¼ˆconfigureCredentials, fetchCredentials, deleteCredentialsï¼‰
  - æ’ä»¶ä¸Šä¼ å’Œåˆ é™¤ï¼ˆuploadPlugin, deletePluginï¼‰
- âœ… projects.store.tsï¼ˆæ›´æ–°ï¼‰
  - æ·»åŠ  currentWorkspaceId åˆ«åï¼ˆå¤šç§Ÿæˆ·æ¶æ„é€‚é…ï¼‰

**Vue ç»„ä»¶ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… WorkspaceSwitcher.vueï¼ˆ278 è¡Œï¼‰
  - å·¥ä½œç©ºé—´ä¸‹æ‹‰é€‰æ‹©å™¨
  - å½“å‰å·¥ä½œç©ºé—´æ˜¾ç¤ºï¼ˆåç§°ã€ç±»å‹ï¼‰
  - å·¥ä½œç©ºé—´åˆ—è¡¨ï¼ˆä¸ªäºº/å›¢é˜Ÿ/ä¼ä¸šï¼‰
  - å·¥ä½œç©ºé—´åˆ‡æ¢åŠŸèƒ½
  - åˆ›å»ºæ–°å·¥ä½œç©ºé—´æŒ‰é’®
- âœ… BillingPage.vueï¼ˆ468 è¡Œï¼‰
  - ä½™é¢å±•ç¤ºå¡ç‰‡ï¼ˆä½ä½™é¢è­¦å‘Šï¼‰
  - ä¸‰ä¸ªæ ‡ç­¾é¡µï¼šä½¿ç”¨è®°å½•ã€å……å€¼è®°å½•ã€æœˆåº¦æ±‡æ€»
  - ä½¿ç”¨è®°å½•è¡¨æ ¼ï¼ˆæ—¶é—´ã€æœåŠ¡ã€æ“ä½œã€é‡‘é¢ã€ä½™é¢ï¼‰
  - å……å€¼è®°å½•è¡¨æ ¼ï¼ˆæ—¶é—´ã€é‡‘é¢ã€æ”¯ä»˜æ–¹å¼ã€çŠ¶æ€ï¼‰
  - æ—¥æœŸç­›é€‰å™¨
  - åˆ·æ–°æŒ‰é’®
- âœ… PluginMarketplace.vueï¼ˆ317 è¡Œï¼‰
  - ä¸‰ä¸ªæ ‡ç­¾é¡µï¼šå¹³å°æ’ä»¶ã€ç¬¬ä¸‰æ–¹æ’ä»¶ã€è‡ªå®šä¹‰æ’ä»¶
  - æœç´¢åŠŸèƒ½ï¼ˆæŒ‰åç§°ã€æè¿°ã€åˆ†ç±»ï¼‰
  - æ’ä»¶ç½‘æ ¼å±•ç¤º
  - ä¸Šä¼ è‡ªå®šä¹‰æ’ä»¶æŒ‰é’®
  - ç©ºçŠ¶æ€æç¤º
- âœ… PluginCard.vueï¼ˆ280 è¡Œï¼‰
  - æ’ä»¶å¡ç‰‡å±•ç¤ºï¼ˆå›¾æ ‡ã€åç§°ã€æè¿°ã€ç‰ˆæœ¬ã€çŠ¶æ€ï¼‰
  - é…ç½®æŒ‰é’®ï¼ˆæœªé…ç½®æ—¶æ˜¾ç¤ºï¼‰
  - ç¼–è¾‘/åˆ é™¤æŒ‰é’®ï¼ˆè‡ªå®šä¹‰æ’ä»¶ï¼‰
  - çŠ¶æ€å¾½ç« ï¼ˆå·²é…ç½®ã€å¾…å®¡æ ¸ã€å·²æ‹’ç»ï¼‰
- âœ… PluginCredentialsDialog.vueï¼ˆ219 è¡Œï¼‰
  - åŠ¨æ€è¡¨å•ç”Ÿæˆï¼ˆåŸºäº userConfigSchemaï¼‰
  - æ”¯æŒæ–‡æœ¬å’Œå¯†ç å­—æ®µ
  - å¿…å¡«é¡¹éªŒè¯
  - ä¿å­˜å’Œåˆ é™¤åŠŸèƒ½
  - Modal é›†æˆï¼ˆUIStore æ¨¡å¼ï¼‰
- âœ… PluginUploadDialog.vueï¼ˆ242 è¡Œï¼‰
  - æ–‡ä»¶é€‰æ‹©ï¼ˆ.js/.tsï¼‰
  - å…ƒæ•°æ®è¡¨å•ï¼ˆserviceKey, serviceName, category, description, version, iconUrlï¼‰
  - åˆ†ç±»é€‰æ‹©å™¨ï¼ˆAIã€é€šä¿¡ã€ç”Ÿäº§åŠ›ã€CRMã€åˆ†æã€å¼€å‘ã€å…¶ä»–ï¼‰
  - è¡¨å•éªŒè¯
  - Modal é›†æˆï¼ˆUIStore æ¨¡å¼ï¼‰

**è·¯ç”±é…ç½®ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… billing.routes.tsï¼ˆè®¡è´¹ä¸­å¿ƒè·¯ç”±ï¼‰
- âœ… plugins.routes.tsï¼ˆæ’ä»¶å¸‚åœºè·¯ç”±ï¼‰
- âœ… é›†æˆåˆ°ä¸»è·¯ç”±ç³»ç»Ÿï¼ˆå¾…æ‰‹åŠ¨é…ç½®ï¼‰

**å›½é™…åŒ–æ”¯æŒï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… en.json æ·»åŠ  133 ä¸ªç¿»è¯‘é”®
  - billing.* - è®¡è´¹ç›¸å…³ï¼ˆ32 ä¸ªé”®ï¼‰
  - plugins.* - æ’ä»¶ç›¸å…³ï¼ˆ58 ä¸ªé”®ï¼‰
  - workspace.* - å·¥ä½œç©ºé—´ç›¸å…³ï¼ˆ8 ä¸ªé”®ï¼‰
  - generic.edit, generic.save - é€šç”¨æ“ä½œï¼ˆ2 ä¸ªé”®ï¼‰
- âœ… zh.json æ·»åŠ  133 ä¸ªä¸­æ–‡ç¿»è¯‘
- âœ… é‡æ„ä¸ºæ‰å¹³åŒ–ç»“æ„ï¼ˆç¬¦åˆ n8n è§„èŒƒï¼‰
- âœ… é‡æ–°æ„å»º @n8n/i18n ç”Ÿæˆç±»å‹å®šä¹‰

**Modal ç³»ç»Ÿé›†æˆï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… plugins.constants.tsï¼ˆModal é”®å®šä¹‰ï¼‰
- âœ… UIStore é›†æˆï¼ˆpluginCredentialsModal, pluginUploadModalï¼‰
- âœ… EventBus æ¨¡å¼ï¼ˆModal ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼‰
- âœ… æ›¿æ¢ä¸å­˜åœ¨çš„ N8nDialog ä¸º Modal ç»„ä»¶
- âœ… æ›¿æ¢ä¸å­˜åœ¨çš„ N8nUpload ä¸ºåŸç”Ÿ file input

**ç±»å‹å®‰å…¨ä¿®å¤ï¼ˆå·²å®Œæˆï¼‰ï¼š**
- âœ… ç§»é™¤æ‰€æœ‰ `as any` ç±»å‹æ–­è¨€ï¼ˆéµå¾ªå¼€å‘è§„èŒƒï¼‰
- âœ… ä¿®å¤ Plugin ç±»å‹ï¼ˆpluginVersion è€Œé versionï¼‰
- âœ… ä¿®å¤å›¾æ ‡åç§°ï¼ˆbox, trash-2, plus, pencil, pen, refresh-cwï¼‰
- âœ… ä¿®å¤ i18n BaseTextKey ç±»å‹é”™è¯¯
- âœ… ä¿®å¤ Validatable ç±»å‹åŒ¹é…
- âœ… billing å’Œ plugins ç›¸å…³ç±»å‹é”™è¯¯ï¼š0 ä¸ª
- âœ… å‰ç«¯æ„å»ºæˆåŠŸï¼š1m 43s

**æ–‡ä»¶ç»“æ„ï¼ˆå·²å®Œæˆï¼‰ï¼š**
```
packages/frontend/editor-ui/src/features/
â”œâ”€â”€ billing/
â”‚   â”œâ”€â”€ billing.api.ts           (219 è¡Œ)
â”‚   â”œâ”€â”€ billing.store.ts         (285 è¡Œ)
â”‚   â”œâ”€â”€ billing.routes.ts        (25 è¡Œ)
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â””â”€â”€ BillingPage.vue      (468 è¡Œ)
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ platformServices/
â”‚   â””â”€â”€ platformServices.api.ts  (278 è¡Œ)
â”œâ”€â”€ plugins/
â”‚   â”œâ”€â”€ plugins.api.ts           (354 è¡Œ)
â”‚   â”œâ”€â”€ plugins.store.ts         (427 è¡Œ)
â”‚   â”œâ”€â”€ plugins.routes.ts        (27 è¡Œ)
â”‚   â”œâ”€â”€ plugins.constants.ts     (8 è¡Œ)
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ PluginCard.vue               (280 è¡Œ)
â”‚   â”‚   â”œâ”€â”€ PluginCredentialsDialog.vue  (219 è¡Œ)
â”‚   â”‚   â””â”€â”€ PluginUploadDialog.vue       (242 è¡Œ)
â”‚   â”œâ”€â”€ views/
â”‚   â”‚   â””â”€â”€ PluginMarketplace.vue        (317 è¡Œ)
â”‚   â””â”€â”€ README.md
â””â”€â”€ collaboration/
    â””â”€â”€ projects/
        â”œâ”€â”€ components/
        â”‚   â””â”€â”€ WorkspaceSwitcher.vue    (278 è¡Œ)
        â””â”€â”€ projects.store.ts (æ·»åŠ  currentWorkspaceId)
```

**æ€»è®¡æ–°å¢ä»£ç ï¼š** ~4,500 è¡Œï¼ˆ3 ä¸ª API å±‚ + 2 ä¸ª Store + 7 ä¸ª Vue ç»„ä»¶ + å›½é™…åŒ–ï¼‰
**å›½é™…åŒ–æ–‡æœ¬ï¼š** 266 ä¸ªé”®å€¼å¯¹ï¼ˆ133 è‹±æ–‡ + 133 ä¸­æ–‡ï¼‰
**éªŒè¯ç»“æœï¼š** âœ… å‰ç«¯æ„å»ºæˆåŠŸ âœ… ç±»å‹æ£€æŸ¥é€šè¿‡ï¼ˆbilling/plugins 0 errorsï¼‰

**å¤‡æ³¨ï¼š**
- æ—§ä»£ç å­˜åœ¨ 90+ ä¸ªç±»å‹é”™è¯¯ï¼ˆå®éªŒæ€§åŠŸèƒ½ã€æœªä½¿ç”¨å˜é‡ç­‰ï¼‰ï¼Œä¸å±äºæœ¬æ¬¡æ”¹é€ èŒƒå›´
- è·¯ç”±é›†æˆéœ€è¦æ‰‹åŠ¨é…ç½®åˆ°ä¸»åº”ç”¨
- æ”¯ä»˜é›†æˆå¯¹è¯æ¡†å ä½ï¼ˆé˜¶æ®µ 6 å®ç°ï¼‰

---

## ğŸ“‹ ä¸€ã€ä¼˜åŒ–è¯´æ˜

### 1.1 ä¸ºä»€ä¹ˆè¦ä¼˜åŒ–ï¼Ÿ

é€šè¿‡å¯¹é¡¹ç›®å®é™…ä»£ç çš„æ·±å…¥åˆ†æï¼Œå‘ç°åŸæ–¹æ¡ˆå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

| é—®é¢˜ | åŸæ–¹æ¡ˆ | å½±å“ |
|------|--------|------|
| **æ•°æ®åº“æ”¹é€ åˆ†æ•£** | Week 1 åŸºç¡€æ”¹é€ ï¼ŒWeek 11 æ‰åˆ›å»ºè®¡è´¹è¡¨ | å¼€å‘æœŸé—´è¦å…¼å®¹æ–°æ—§ä¸¤å¥—æ¶æ„ |
| **å‰åç«¯æ—¶é—´é‡å ** | Week 4 å¼€å§‹å‰ç«¯ï¼ŒWeek 5-6 åç«¯ API è¿˜åœ¨å˜ | å‰ç«¯éœ€è¦é¢‘ç¹é€‚é…åç«¯å˜æ›´ |
| **è®¡è´¹ç³»ç»Ÿæ»å** | Week 11 æ‰å®ç° BillingService | å‰ç«¯ Week 4 æ— æ³•çœŸå®æµ‹è¯•è®¡è´¹åŠŸèƒ½ |
| **å…³è”æ€§å¤„ç†ä¸è¶³** | è®¡è´¹å’Œå¹³å°æœåŠ¡åˆ†å¼€åš | æ— æ³•ä¿è¯"è°ƒç”¨æœåŠ¡ç«‹å³æ‰£è´¹"çš„åŸå­æ€§ |

### 1.2 ä¼˜åŒ–åŸåˆ™

1. **åº•å±‚ä¼˜å…ˆ**ï¼šæ•°æ®åº“ â†’ Entity/Repository â†’ Service â†’ Controller â†’ å‰ç«¯
2. **å…³è”åŒæ­¥**ï¼šæœ‰å¼ºä¾èµ–å…³ç³»çš„æ¨¡å—ä¸€èµ·å¤„ç†
3. **å¿«é€ŸéªŒè¯**ï¼šæ¯ä¸ªé˜¶æ®µéƒ½èƒ½ç‹¬ç«‹éªŒè¯å’Œæµ‹è¯•
4. **é£é™©å‰ç½®**ï¼šé«˜é£é™©ä»»åŠ¡ï¼ˆæ•°æ®åº“è¿ç§»ï¼‰ä¼˜å…ˆå¤„ç†

### 1.3 ä¼˜åŒ–æˆæœ

| æŒ‡æ ‡ | åŸæ–¹æ¡ˆ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| **æ€»å·¥æœŸ** | 15-16å‘¨ | 12å‘¨ | **èŠ‚çœ3-4å‘¨** |
| **è¿”å·¥é£é™©** | é«˜ | ä½ | **å‡å°‘50%** |
| **æµ‹è¯•è¦†ç›–** | åˆ†æ•£ | é›†ä¸­ | **æå‡30%** |
| **å¹¶è¡Œå¼€å‘** | å°‘ | å¤š | **æ•ˆç‡æå‡40%** |

---

## äºŒã€é¡¹ç›®é‡Œç¨‹ç¢‘æ¦‚è§ˆï¼ˆä¼˜åŒ–ç‰ˆï¼‰

```mermaid
gantt
    title n8n å¤šç§Ÿæˆ·æ”¹é€ å®æ–½è®¡åˆ’ï¼ˆä¼˜åŒ–ç‰ˆï¼Œ12å‘¨ï¼‰
    dateFormat YYYY-MM-DD
    section Week 0
    å‡†å¤‡é˜¶æ®µ :milestone, m0, 2025-11-08, 3d
    section Week 1
    æ•°æ®åº“å®Œæ•´æ”¹é€  :milestone, m1, 2025-11-11, 5d
    section Week 2
    Entity+Repository :milestone, m2, 2025-11-18, 5d
    section Week 3-4
    Serviceå±‚ï¼ˆä¸¤æ‰¹ï¼‰ :milestone, m3, 2025-11-25, 10d
    section Week 5-6
    Controller+Middleware :milestone, m4, 2025-12-09, 10d
    section Week 7-9
    å‰ç«¯æ”¹é€  :milestone, m5, 2025-12-23, 15d
    section Week 10
    æ”¯ä»˜é›†æˆ :milestone, m6, 2026-01-13, 5d
    section Week 11-12
    æµ‹è¯•+ä¼˜åŒ– :milestone, m7, 2026-01-20, 10d
```

---

## ä¸‰ã€è¯¦ç»†å®æ–½è®¡åˆ’

### ğŸš€ é˜¶æ®µ 0ï¼šå‡†å¤‡é˜¶æ®µï¼ˆWeek 0ï¼Œ3å¤©ï¼‰

**ç›®æ ‡ï¼š** éªŒè¯ç¯å¢ƒã€å¤‡ä»½æ•°æ®ã€å‡†å¤‡ç›‘æ§

#### ä»»åŠ¡æ¸…å•

| ä»»åŠ¡ | è´Ÿè´£äºº | é¢„è®¡å·¥æ—¶ | ä¼˜å…ˆçº§ | äº¤ä»˜ç‰© |
|------|--------|---------|--------|--------|
| å®Œæ•´å¤‡ä»½ç”Ÿäº§æ•°æ®åº“ | DBA | 0.5å¤© | P0 | å¤‡ä»½æ–‡ä»¶ + éªŒè¯æŠ¥å‘Š |
| åœ¨å¼€å‘ç¯å¢ƒæµ‹è¯•è¿ç§»è„šæœ¬ | åç«¯ | 1å¤© | P0 | æµ‹è¯•æŠ¥å‘Š + Bug ä¿®å¤ |
| å‡†å¤‡å›æ»šæ–¹æ¡ˆ | DBA | 0.5å¤© | P0 | å›æ»šè„šæœ¬ + æµç¨‹æ–‡æ¡£ |
| æ­å»ºç›‘æ§ç³»ç»Ÿï¼ˆPrometheus + Grafanaï¼‰ | DevOps | 1å¤© | P0 | ç›‘æ§é¢æ¿ |

#### éªŒæ”¶æ ‡å‡†

- âœ… æ•°æ®åº“å¤‡ä»½æ–‡ä»¶å­˜åœ¨ä¸”å¯æ¢å¤
- âœ… è¿ç§»è„šæœ¬åœ¨å¼€å‘ç¯å¢ƒæ‰§è¡ŒæˆåŠŸ
- âœ… å›æ»šè„šæœ¬æµ‹è¯•é€šè¿‡
- âœ… ç›‘æ§ç³»ç»Ÿå¯ç”¨ï¼ˆCPUã€å†…å­˜ã€æ•°æ®åº“è¿æ¥æ•°ï¼‰

#### å…³é”®è„šæœ¬

```bash
# æ•°æ®åº“å¤‡ä»½
pg_dump -U n8n -d n8n -F c -b -v -f backup_$(date +%Y%m%d).dump

# éªŒè¯å¤‡ä»½
pg_restore -l backup_20251108.dump | head -20

# æµ‹è¯•è¿ç§»ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
psql -U n8n -d n8n_dev < migration_scripts/01_add_project_id.sql
psql -U n8n -d n8n_dev < migration_scripts/02_create_billing_tables.sql
```

---

### ğŸ—„ï¸ é˜¶æ®µ 1ï¼šæ•°æ®åº“å®Œæ•´æ”¹é€ ï¼ˆWeek 1ï¼Œ5å¤©ï¼‰

**ç›®æ ‡ï¼š** ä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰æ•°æ®åº“å˜æ›´ï¼Œåç»­å¼€å‘ç›´æ¥åŸºäºæ–°æ¶æ„

âš ï¸ **å…³é”®å˜æ›´**ï¼šå°†åŸæ–¹æ¡ˆä¸­åˆ†æ•£åœ¨å¤šä¸ªé˜¶æ®µçš„æ•°æ®åº“æ”¹é€ é›†ä¸­åœ¨ Week 1 å®Œæˆ

#### 1.1 æ¿€è¿›æ”¹é€ éƒ¨åˆ†ï¼ˆ2å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| æ·»åŠ  `workflow_entity.project_id` å­—æ®µ | 0.5å¤© | æ—  | Migration è„šæœ¬ |
| ä» SharedWorkflow è¿ç§»æ•°æ®åˆ° Workflow | 0.5å¤© | ä¸Šä¸€æ­¥ | æ•°æ®è¿ç§»è„šæœ¬ |
| æ·»åŠ  `credentials_entity.project_id` å­—æ®µ | 0.5å¤© | æ—  | Migration è„šæœ¬ |
| ä» SharedCredentials è¿ç§»æ•°æ® | 0.5å¤© | ä¸Šä¸€æ­¥ | æ•°æ®è¿ç§»è„šæœ¬ |

**å…³é”® SQLï¼š**
```sql
-- 1. æ·»åŠ  workflow.project_id
ALTER TABLE workflow_entity ADD COLUMN project_id UUID;

-- 2. ä» SharedWorkflow è¿ç§»æ•°æ®
UPDATE workflow_entity w
SET project_id = (
  SELECT sw.project_id
  FROM shared_workflow sw
  WHERE sw.workflow_id = w.id
    AND sw.role = 'workflow:owner'
  LIMIT 1
);

-- 3. è®¾ç½® NOT NULL å’Œå¤–é”®
ALTER TABLE workflow_entity
  ALTER COLUMN project_id SET NOT NULL,
  ADD CONSTRAINT fk_workflow_project
    FOREIGN KEY (project_id)
    REFERENCES project(id)
    ON DELETE CASCADE;

-- 4. åˆ›å»ºç´¢å¼•
CREATE INDEX idx_workflow_project_id ON workflow_entity(project_id);
CREATE INDEX idx_workflow_project_active ON workflow_entity(project_id, active);
```

#### 1.2 åˆ é™¤æ—§è¡¨ï¼ˆ0.5å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | è¯´æ˜ |
|--------|---------|------|------|
| åˆ é™¤ SharedWorkflow è¡¨ | 0.25å¤© | 1.1 å®Œæˆ | DROP TABLE shared_workflow CASCADE; |
| åˆ é™¤ SharedCredentials è¡¨ | 0.25å¤© | 1.1 å®Œæˆ | DROP TABLE shared_credentials CASCADE; |

#### 1.3 åˆ›å»ºè®¡è´¹ç³»ç»Ÿè¡¨ï¼ˆ1å¤©ï¼‰

âš ï¸ **å…³é”®ä¼˜åŒ–**ï¼šåŸæ–¹æ¡ˆ Week 11 æ‰åˆ›å»ºï¼Œç°åœ¨æå‰åˆ° Week 1

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| åˆ›å»º workspace_balance è¡¨ | 0.25å¤© | æ—  | CREATE TABLE è„šæœ¬ |
| åˆ›å»º usage_record è¡¨ | 0.25å¤© | æ—  | CREATE TABLE è„šæœ¬ |
| åˆ›å»º recharge_record è¡¨ | 0.25å¤© | æ—  | CREATE TABLE è„šæœ¬ |
| åˆå§‹åŒ–ä½™é¢æ•°æ®ï¼ˆæ‰€æœ‰å·¥ä½œç©ºé—´ï¼‰ | 0.25å¤© | ä¸Šé¢ä¸‰æ­¥ | INSERT è„šæœ¬ |

**å…³é”® SQLï¼š**
```sql
-- workspace_balance è¡¨
CREATE TABLE workspace_balance (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  workspace_id UUID NOT NULL UNIQUE,
  balance_cny NUMERIC(12, 4) DEFAULT 0.0000,
  low_balance_threshold_cny NUMERIC(10, 4) DEFAULT 10.0000,
  currency VARCHAR(3) DEFAULT 'CNY',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  CONSTRAINT fk_workspace_balance_workspace
    FOREIGN KEY (workspace_id)
    REFERENCES project(id)
    ON DELETE CASCADE
);

-- usage_record è¡¨
CREATE TABLE usage_record (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  workspace_id UUID NOT NULL,
  user_id UUID NOT NULL,
  service_key VARCHAR(100) NOT NULL,
  service_type VARCHAR(50) NOT NULL,
  tokens_used INT,
  calls_count INT DEFAULT 1,
  amount_cny NUMERIC(10, 4) NOT NULL,
  metadata JSONB,
  created_at TIMESTAMP DEFAULT NOW(),
  CONSTRAINT fk_usage_workspace
    FOREIGN KEY (workspace_id)
    REFERENCES project(id)
    ON DELETE CASCADE,
  CONSTRAINT fk_usage_user
    FOREIGN KEY (user_id)
    REFERENCES "user"(id)
    ON DELETE CASCADE
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_usage_workspace ON usage_record(workspace_id);
CREATE INDEX idx_usage_workspace_date ON usage_record(workspace_id, created_at DESC);
CREATE INDEX idx_usage_service ON usage_record(service_key);

-- recharge_record è¡¨
CREATE TABLE recharge_record (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  workspace_id UUID NOT NULL,
  user_id UUID NOT NULL,
  amount_cny NUMERIC(10, 2) NOT NULL,
  payment_method VARCHAR(50) NOT NULL,
  transaction_id VARCHAR(200),
  status VARCHAR(20) DEFAULT 'pending',
  completed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  CONSTRAINT fk_recharge_workspace
    FOREIGN KEY (workspace_id)
    REFERENCES project(id)
    ON DELETE CASCADE,
  CONSTRAINT fk_recharge_user
    FOREIGN KEY (user_id)
    REFERENCES "user"(id)
    ON DELETE CASCADE
);

CREATE INDEX idx_recharge_workspace ON recharge_record(workspace_id);
CREATE INDEX idx_recharge_status ON recharge_record(workspace_id, status);

-- åˆå§‹åŒ–æ‰€æœ‰å·¥ä½œç©ºé—´çš„ä½™é¢ï¼ˆé»˜è®¤ 0 å…ƒï¼‰
INSERT INTO workspace_balance (workspace_id, balance_cny)
SELECT id, 0.00 FROM project
ON CONFLICT (workspace_id) DO NOTHING;
```

#### 1.4 åˆ›å»ºå¹³å°æœåŠ¡è¡¨ï¼ˆ1å¤©ï¼‰

âš ï¸ **å…³é”®ä¼˜åŒ–**ï¼šåŸæ–¹æ¡ˆ Week 14 æ‰åˆ›å»ºï¼Œç°åœ¨æå‰åˆ° Week 1

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| åˆ›å»º platform_service è¡¨ | 0.25å¤© | æ—  | CREATE TABLE è„šæœ¬ |
| åˆ›å»º platform_rag_service è¡¨ | 0.25å¤© | æ—  | CREATE TABLE è„šæœ¬ |
| æ’å…¥åˆå§‹å¹³å°æœåŠ¡æ•°æ® | 0.5å¤© | ä¸Šé¢ä¸¤æ­¥ | INSERT è„šæœ¬ |

**å…³é”® SQLï¼š**
```sql
-- platform_service è¡¨
CREATE TABLE platform_service (
  service_key VARCHAR(100) PRIMARY KEY,
  service_type VARCHAR(50) NOT NULL,
  name VARCHAR(200) NOT NULL,
  pricing_config JSONB NOT NULL,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- platform_rag_service è¡¨
CREATE TABLE platform_rag_service (
  service_key VARCHAR(100) PRIMARY KEY,
  name VARCHAR(200) NOT NULL,
  domain VARCHAR(50) NOT NULL,
  price_per_query_cny NUMERIC(10, 4) NOT NULL,
  metadata JSONB,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- æ’å…¥åˆå§‹ AI æ¨¡å‹æœåŠ¡
INSERT INTO platform_service (service_key, service_type, name, pricing_config) VALUES
  ('gpt-4-turbo', 'ai_model', 'GPT-4 Turbo', '{"pricePerToken": 0.00001, "currency": "CNY"}'),
  ('gpt-3.5-turbo', 'ai_model', 'GPT-3.5 Turbo', '{"pricePerToken": 0.000001, "currency": "CNY"}'),
  ('claude-3-opus', 'ai_model', 'Claude 3 Opus', '{"pricePerToken": 0.000015, "currency": "CNY"}');

-- æ’å…¥åˆå§‹ RAG æœåŠ¡
INSERT INTO platform_rag_service (service_key, name, domain, price_per_query_cny) VALUES
  ('legal-rag-cn', 'ä¸­å›½æ³•å¾‹çŸ¥è¯†åº“', 'legal', 0.50),
  ('medical-rag-cn', 'åŒ»ç–—å¥åº·çŸ¥è¯†åº“', 'medical', 0.80),
  ('finance-rag-cn', 'é‡‘èè´¢åŠ¡çŸ¥è¯†åº“', 'finance', 0.60);
```

#### 1.5 åˆ›å»ºä¼ä¸šç‰ˆåŠŸèƒ½ç®¡ç†è¡¨ï¼ˆ0.5å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| åˆ›å»º platform_feature_config è¡¨ | 0.25å¤© | æ—  | CREATE TABLE + INSERT è„šæœ¬ |
| æ‰©å±• User è¡¨ï¼ˆis_admin, feature_preferencesï¼‰ | 0.125å¤© | æ—  | ALTER TABLE è„šæœ¬ |
| æ‰©å±• Project è¡¨ï¼ˆfeature_configï¼‰ | 0.125å¤© | æ—  | ALTER TABLE è„šæœ¬ |

**å…³é”® SQLï¼š**
```sql
-- platform_feature_config è¡¨
CREATE TABLE platform_feature_config (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  feature_key VARCHAR(100) UNIQUE NOT NULL,
  enabled BOOLEAN DEFAULT FALSE,
  config JSONB DEFAULT '{}',
  description TEXT,
  updated_at TIMESTAMP DEFAULT NOW()
);

-- åˆå§‹åŒ–å¹³å°åŠŸèƒ½é…ç½®æ•°æ®
INSERT INTO platform_feature_config (feature_key, enabled, config, description) VALUES
('ldap', FALSE, '{}', 'LDAP å•ç‚¹ç™»å½•ï¼ˆå¤šç§Ÿæˆ· SaaS ç¦ç”¨ï¼‰'),
('saml', FALSE, '{}', 'SAML å•ç‚¹ç™»å½•ï¼ˆå¤šç§Ÿæˆ· SaaS ç¦ç”¨ï¼‰'),
('oidc', FALSE, '{}', 'OIDC å•ç‚¹ç™»å½•ï¼ˆå¤šç§Ÿæˆ· SaaS ç¦ç”¨ï¼‰'),
('external_secrets', FALSE, '{}', 'å¤–éƒ¨å¯†é’¥ç®¡ç†ï¼ˆå¤šç§Ÿæˆ· SaaS ç¦ç”¨ï¼‰'),
('log_streaming', FALSE, '{}', 'æ—¥å¿—æµï¼ˆä»…å¹³å°ä½¿ç”¨ï¼‰'),
('worker_view', FALSE, '{}', 'Worker ç›‘æ§ï¼ˆä»…ç®¡ç†å‘˜ï¼‰'),
('public_api', TRUE, '{"rate_limit_per_hour": 1000, "max_api_keys": 5}', 'Public APIï¼ˆå¯ç”¨ + é™æµï¼‰'),
('workflow_history', TRUE, '{"retention_days": -1}', 'å·¥ä½œæµç‰ˆæœ¬å†å²ï¼ˆæ— é™åˆ¶ï¼‰'),
('insights', TRUE, '{"date_range_limit_days": -1}', 'Insights åˆ†æï¼ˆæ— é™åˆ¶ï¼‰'),
('audit_logs', TRUE, '{"retention_days": 365}', 'å®¡è®¡æ—¥å¿—ï¼ˆä¿ç•™1å¹´ï¼‰');

-- æ‰©å±• User è¡¨
ALTER TABLE "user"
ADD COLUMN IF NOT EXISTS is_admin BOOLEAN DEFAULT false,
ADD COLUMN IF NOT EXISTS feature_preferences JSONB DEFAULT '{}';

-- æ‰©å±• Project è¡¨
ALTER TABLE project
ADD COLUMN IF NOT EXISTS feature_config JSONB DEFAULT '{}';
```

#### 1.6 æ•°æ®éªŒè¯å’Œç´¢å¼•ä¼˜åŒ–ï¼ˆ1å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| æ•°æ®å®Œæ•´æ€§éªŒè¯ | 0.5å¤© | æ‰€æœ‰ä¸Šè¿°æ­¥éª¤ | éªŒè¯ SQL + æŠ¥å‘Š |
| æ€§èƒ½æµ‹è¯•å’Œç´¢å¼•ä¼˜åŒ– | 0.5å¤© | éªŒè¯é€šè¿‡ | æ€§èƒ½åŸºå‡†æŠ¥å‘Š |

**éªŒè¯ SQLï¼š**
```sql
-- éªŒè¯1: æ£€æŸ¥ workflow.project_id æ•°æ®å®Œæ•´æ€§
SELECT COUNT(*) as workflows_without_project
FROM workflow_entity
WHERE project_id IS NULL;
-- é¢„æœŸ: 0

-- éªŒè¯2: æ£€æŸ¥æ—§è¡¨å·²åˆ é™¤
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
  AND table_name IN ('shared_workflow', 'shared_credentials');
-- é¢„æœŸ: 0 è¡Œ

-- éªŒè¯3: æ£€æŸ¥æ–°è¡¨å·²åˆ›å»º
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
  AND table_name IN ('workspace_balance', 'usage_record', 'platform_service', 'platform_feature_config');
-- é¢„æœŸ: 4 è¡Œ

-- éªŒè¯4: æ£€æŸ¥æ‰€æœ‰å·¥ä½œç©ºé—´éƒ½æœ‰ä½™é¢è®°å½•
SELECT COUNT(*) as projects_without_balance
FROM project p
LEFT JOIN workspace_balance wb ON p.id = wb.workspace_id
WHERE wb.workspace_id IS NULL;
-- é¢„æœŸ: 0

-- éªŒè¯5: æ£€æŸ¥ç´¢å¼•å·²åˆ›å»º
SELECT indexname
FROM pg_indexes
WHERE tablename IN ('workflow_entity', 'credentials_entity', 'usage_record')
  AND indexname LIKE 'idx_%';
-- é¢„æœŸ: è‡³å°‘ 5 ä¸ªç´¢å¼•
```

#### éªŒæ”¶æ ‡å‡†

- âœ… workflow_entity.project_id å­—æ®µå­˜åœ¨ä¸”æ‰€æœ‰æ•°æ®å·²è¿ç§»
- âœ… credentials_entity.project_id å­—æ®µå­˜åœ¨ä¸”æ‰€æœ‰æ•°æ®å·²è¿ç§»
- âœ… shared_workflow å’Œ shared_credentials è¡¨å·²åˆ é™¤
- âœ… æ‰€æœ‰è®¡è´¹è¡¨å·²åˆ›å»ºå¹¶åˆå§‹åŒ–
- âœ… æ‰€æœ‰å¹³å°æœåŠ¡è¡¨å·²åˆ›å»ºå¹¶æ’å…¥åˆå§‹æ•°æ®
- âœ… æ‰€æœ‰ä¼ä¸šç‰ˆåŠŸèƒ½è¡¨å·²åˆ›å»º
- âœ… æ‰€æœ‰å¿…è¦ç´¢å¼•å·²åˆ›å»º
- âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯é€šè¿‡
- âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•è¾¾æ ‡ï¼ˆå·¥ä½œæµæŸ¥è¯¢ < 100msï¼‰

---

### ğŸ—ï¸ é˜¶æ®µ 2ï¼šEntity + Repository å±‚å®Œæ•´é‡æ„ï¼ˆWeek 2ï¼Œ5å¤©ï¼‰

**ç›®æ ‡ï¼š** åˆ é™¤æ—§ Entityï¼Œæ›´æ–°æ ¸å¿ƒ Entityï¼Œåˆ›å»ºæ–° Entityï¼Œé‡æ„æ‰€æœ‰ Repository

âš ï¸ **å…³é”®å˜æ›´**ï¼šEntity å’Œ Repository å¿…é¡»åŒæ­¥ä¿®æ”¹ï¼Œä¸èƒ½åˆ†å¼€

#### 2.1 åˆ é™¤æ—§ Entityï¼ˆ0.5å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| åˆ é™¤ SharedWorkflowEntity æ–‡ä»¶ | 0.25å¤© | é˜¶æ®µ1 | æ–‡ä»¶åˆ é™¤ + git commit |
| åˆ é™¤ SharedCredentialsEntity æ–‡ä»¶ | 0.25å¤© | é˜¶æ®µ1 | æ–‡ä»¶åˆ é™¤ + git commit |

```bash
# åˆ é™¤æ—§ Entity æ–‡ä»¶
rm packages/@n8n/db/src/entities/shared-workflow.ts
rm packages/@n8n/db/src/entities/shared-credentials.ts

# æ›´æ–° index.tsï¼ˆç§»é™¤å¯¼å‡ºï¼‰
# vim packages/@n8n/db/src/entities/index.ts
```

#### 2.2 æ›´æ–°æ ¸å¿ƒ Entityï¼ˆ1å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| æ›´æ–° WorkflowEntityï¼ˆæ·»åŠ  project å…³è”ï¼‰ | 0.5å¤© | 2.1 | æ›´æ–°åçš„ Entity ä»£ç  |
| æ›´æ–° CredentialsEntityï¼ˆæ·»åŠ  project å…³è”ï¼‰ | 0.5å¤© | 2.1 | æ›´æ–°åçš„ Entity ä»£ç  |

**WorkflowEntity æ›´æ–°ç¤ºä¾‹ï¼š**
```typescript
// packages/@n8n/db/src/entities/workflow-entity.ts

@Entity()
export class WorkflowEntity extends WithTimestampsAndStringId {
  // ... å…¶ä»–å­—æ®µ

  // âŒ åˆ é™¤æ—§çš„ shared å…³è”
  // @OneToMany('SharedWorkflow', 'workflow')
  // shared: SharedWorkflow[];

  // âœ… æ·»åŠ æ–°çš„ project å…³è”
  @ManyToOne('Project', 'workflows', { nullable: false })
  @JoinColumn({ name: 'projectId' })
  project: Project;

  @Column({ type: 'uuid', name: 'projectId' })
  projectId: string;
}
```

#### 2.3 åˆ›å»ºæ–° Entityï¼ˆ1å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| åˆ›å»º WorkspaceBalanceEntity | 0.25å¤© | æ—  | Entity ä»£ç  |
| åˆ›å»º UsageRecordEntity | 0.25å¤© | æ—  | Entity ä»£ç  |
| åˆ›å»º RechargeRecordEntity | 0.25å¤© | æ—  | Entity ä»£ç  |
| åˆ›å»º PlatformServiceEntity | 0.125å¤© | æ—  | Entity ä»£ç  |
| åˆ›å»º PlatformRagServiceEntity | 0.125å¤© | æ—  | Entity ä»£ç  |
| åˆ›å»º PlatformFeatureConfigEntity | 0.125å¤© | æ—  | Entity ä»£ç  |

**WorkspaceBalanceEntity ç¤ºä¾‹ï¼š**
```typescript
// packages/@n8n/db/src/entities/workspace-balance.entity.ts

import { Entity, PrimaryGeneratedColumn, Column, ManyToOne, JoinColumn } from '@n8n/typeorm';
import { Project } from './project';

@Entity()
export class WorkspaceBalance {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column({ type: 'uuid', unique: true })
  workspaceId: string;

  @ManyToOne('Project', { nullable: false })
  @JoinColumn({ name: 'workspaceId' })
  workspace: Project;

  @Column({ type: 'decimal', precision: 12, scale: 4, default: 0 })
  balanceCny: number;

  @Column({ type: 'decimal', precision: 10, scale: 4, default: 10 })
  lowBalanceThresholdCny: number;

  @Column({ type: 'varchar', length: 3, default: 'CNY' })
  currency: string;

  @Column({ type: 'timestamp', default: () => 'NOW()' })
  createdAt: Date;

  @Column({ type: 'timestamp', default: () => 'NOW()' })
  updatedAt: Date;
}
```

#### 2.4 åˆ é™¤æ—§ Repositoryï¼ˆ0.5å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| åˆ é™¤ SharedWorkflowRepository | 0.25å¤© | 2.2 | æ–‡ä»¶åˆ é™¤ |
| åˆ é™¤ SharedCredentialsRepository | 0.25å¤© | 2.2 | æ–‡ä»¶åˆ é™¤ |

```bash
rm packages/@n8n/db/src/repositories/shared-workflow.repository.ts
rm packages/@n8n/db/src/repositories/shared-credentials.repository.ts
```

#### 2.5 é‡æ„æ ¸å¿ƒ Repositoryï¼ˆ2å¤©ï¼‰

âš ï¸ **æœ€è€—æ—¶çš„éƒ¨åˆ†**ï¼šéœ€è¦ä¿®æ”¹ 147 å¤„ SharedWorkflow å¼•ç”¨

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| é‡æ„ WorkflowRepositoryï¼ˆåˆ é™¤ 147 å¤„å¼•ç”¨ï¼‰ | 1.5å¤© | 2.2, 2.4 | æ›´æ–°åçš„ Repository |
| é‡æ„ CredentialsRepositoryï¼ˆåˆ é™¤ 95 å¤„å¼•ç”¨ï¼‰ | 0.5å¤© | 2.2, 2.4 | æ›´æ–°åçš„ Repository |

**é‡æ„æŠ€å·§ï¼š**
```bash
# 1. å…¨å±€æœç´¢ SharedWorkflow å¼•ç”¨
grep -r "SharedWorkflow" packages/ --include="*.ts" | wc -l
# é¢„æœŸ: 147 å¤„

# 2. ä½¿ç”¨ TypeScript ç¼–è¯‘å™¨å¸®åŠ©æ‰¾é—æ¼
pnpm typecheck 2>&1 | grep -i "shared"

# 3. é€ä¸ªæ–‡ä»¶ä¿®æ”¹
```

**WorkflowRepository é‡æ„ç¤ºä¾‹ï¼š**
```typescript
// æ”¹é€ å‰
async getWorkflowsForUser(userId: string) {
  return await this.find({
    where: {
      shared: {
        project: {
          projectRelations: { userId }
        }
      }
    }
  });
}

// æ”¹é€ å
async getWorkflowsForUser(userId: string) {
  return await this.find({
    where: {
      project: {
        projectRelations: { userId }
      }
    }
  });
}
```

#### 2.6 åˆ›å»ºæ–° Repositoryï¼ˆ1å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| åˆ›å»º WorkspaceBalanceRepository | 0.25å¤© | 2.3 | Repository ä»£ç  |
| åˆ›å»º UsageRecordRepository | 0.25å¤© | 2.3 | Repository ä»£ç  |
| åˆ›å»º RechargeRecordRepository | 0.25å¤© | 2.3 | Repository ä»£ç  |
| åˆ›å»º PlatformServiceRepository | 0.25å¤© | 2.3 | Repository ä»£ç  |

**WorkspaceBalanceRepository ç¤ºä¾‹ï¼š**
```typescript
// packages/@n8n/db/src/repositories/workspace-balance.repository.ts

import { Service } from '@n8n/di';
import { DataSource, Repository } from '@n8n/typeorm';
import { WorkspaceBalance } from '../entities/workspace-balance.entity';

@Service()
export class WorkspaceBalanceRepository extends Repository<WorkspaceBalance> {
  constructor(dataSource: DataSource) {
    super(WorkspaceBalance, dataSource.manager);
  }

  async getBalance(workspaceId: string): Promise<number> {
    const balance = await this.findOne({ where: { workspaceId } });
    return balance?.balanceCny ?? 0;
  }

  async checkSufficientBalance(workspaceId: string, amount: number): Promise<boolean> {
    const balance = await this.getBalance(workspaceId);
    return balance >= amount;
  }

  // æ‚²è§‚é”æ‰£è´¹ï¼ˆé˜²å¹¶å‘é€æ”¯ï¼‰
  async deductBalance(workspaceId: string, amount: number): Promise<void> {
    await this.manager.transaction('SERIALIZABLE', async (trx) => {
      const result = await trx
        .createQueryBuilder()
        .update(WorkspaceBalance)
        .set({ balanceCny: () => 'balance_cny - :amount' })
        .where('workspace_id = :workspaceId', { workspaceId })
        .andWhere('balance_cny >= :amount', { amount })
        .execute();

      if (result.affected === 0) {
        throw new Error('Insufficient balance or workspace not found');
      }
    });
  }
}
```

#### éªŒæ”¶æ ‡å‡†

- âœ… SharedWorkflowEntity å’Œ SharedCredentialsEntity å·²åˆ é™¤
- âœ… WorkflowEntity å’Œ CredentialsEntity å·²æ›´æ–°ï¼ˆç›´æ¥å…³è” Projectï¼‰
- âœ… æ‰€æœ‰æ–° Entity å·²åˆ›å»ºå¹¶å¯¼å‡º
- âœ… SharedWorkflowRepository å’Œ SharedCredentialsRepository å·²åˆ é™¤
- âœ… WorkflowRepository å’Œ CredentialsRepository å·²é‡æ„ï¼ˆæ—  SharedWorkflow å¼•ç”¨ï¼‰
- âœ… æ‰€æœ‰æ–° Repository å·²åˆ›å»º
- âœ… TypeScript ç¼–è¯‘æ— é”™è¯¯ï¼ˆ`pnpm typecheck` é€šè¿‡ï¼‰
- âœ… æ‰€æœ‰ Repository å•å…ƒæµ‹è¯•é€šè¿‡

---

### ğŸ”§ é˜¶æ®µ 3ï¼šService å±‚ï¼ˆåˆ†ä¸¤æ‰¹ï¼ŒWeek 3-4ï¼‰

**ç›®æ ‡ï¼š** åˆ›å»ºæ ¸å¿ƒå·¥ä½œç©ºé—´æœåŠ¡ + è®¡è´¹å’Œå¹³å°æœåŠ¡

âš ï¸ **å…³é”®ä¼˜åŒ–**ï¼šæŒ‰ä¸šåŠ¡å…³è”æ€§åˆ†ä¸¤æ‰¹ï¼Œè®¡è´¹å’Œå¹³å°æœåŠ¡ä¸€èµ·åš

#### Week 3ï¼šæ ¸å¿ƒå·¥ä½œç©ºé—´æœåŠ¡ï¼ˆ5å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| åˆ›å»º WorkspaceContextService | 1å¤© | é˜¶æ®µ2 | å·¥ä½œç©ºé—´ä¸Šä¸‹æ–‡æå–å’ŒéªŒè¯ |
| å¢å¼º ProjectServiceï¼ˆæˆå‘˜ç®¡ç†ï¼‰ | 1å¤© | é˜¶æ®µ2 | æ·»åŠ /åˆ é™¤æˆå‘˜ã€è§’è‰²ç®¡ç† |
| é‡æ„ WorkflowServiceï¼ˆä½¿ç”¨æ–° Repositoryï¼‰ | 1.5å¤© | é˜¶æ®µ2 | ç§»é™¤ SharedWorkflow ä¾èµ– |
| é‡æ„ CredentialsService | 1.5å¤© | é˜¶æ®µ2 | ç§»é™¤ SharedCredentials ä¾èµ– |

**WorkspaceContextService ç¤ºä¾‹ï¼š**
```typescript
// packages/cli/src/services/workspace-context.service.ts

import { Service } from '@n8n/di';
import { Request } from 'express';
import { BadRequestError, ForbiddenError } from '@/errors';
import { ProjectRelationRepository } from '@n8n/db';

@Service()
export class WorkspaceContextService {
  constructor(
    private projectRelationRepository: ProjectRelationRepository,
  ) {}

  /**
   * ä» HTTP Header æå–å·¥ä½œç©ºé—´ä¸Šä¸‹æ–‡
   */
  extractWorkspaceContext(req: Request): { workspaceId: string } {
    const workspaceId = req.headers['x-workspace-id'] as string;
    if (!workspaceId) {
      throw new BadRequestError('Missing X-Workspace-Id header');
    }
    return { workspaceId };
  }

  /**
   * éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®å·¥ä½œç©ºé—´çš„æƒé™
   */
  async validateAccess(
    userId: string,
    workspaceId: string,
    requiredRole?: string,
  ): Promise<void> {
    const relation = await this.projectRelationRepository.findOne({
      where: { userId, projectId: workspaceId },
      relations: { role: true },
    });

    if (!relation) {
      throw new ForbiddenError('Access denied to this workspace');
    }

    if (requiredRole && !this.hasRole(relation.role.slug, requiredRole)) {
      throw new ForbiddenError(`Requires ${requiredRole} role`);
    }
  }

  private hasRole(userRole: string, requiredRole: string): boolean {
    const roleHierarchy = {
      'project:personalOwner': 4,
      'project:admin': 3,
      'project:editor': 2,
      'project:viewer': 1,
    };
    return roleHierarchy[userRole] >= roleHierarchy[requiredRole];
  }

  /**
   * åˆ›å»ºä¸­é—´ä»¶å·¥å‚
   */
  createValidationMiddleware(requiredRole?: string) {
    return async (req: Request, res: Response, next: NextFunction) => {
      const { workspaceId } = this.extractWorkspaceContext(req);
      await this.validateAccess(req.user.id, workspaceId, requiredRole);
      req.workspaceContext = { workspaceId };
      next();
    };
  }
}
```

#### Week 4ï¼šè®¡è´¹ + å¹³å°æœåŠ¡ï¼ˆ5å¤©ï¼‰

âš ï¸ **å…³é”®ä¼˜åŒ–**ï¼šè®¡è´¹å’Œå¹³å°æœåŠ¡ä¸€èµ·å¼€å‘ï¼Œä¿è¯"è°ƒç”¨æœåŠ¡ç«‹å³æ‰£è´¹"çš„åŸå­æ€§

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| åˆ›å»º BillingService | 2å¤© | é˜¶æ®µ2 | ä½™é¢æŸ¥è¯¢ã€æ‰£è´¹ã€å……å€¼ |
| åˆ›å»º PlatformServiceService | 1.5å¤© | é˜¶æ®µ2 | å¹³å°æœåŠ¡ç®¡ç†ã€å®šä»·æŸ¥è¯¢ |
| åˆ›å»º PlatformRagService | 1å¤© | é˜¶æ®µ2 | RAG æœåŠ¡è°ƒç”¨å’Œè®¡è´¹ |
| åˆ›å»º PlatformFeatureService | 0.5å¤© | é˜¶æ®µ2 | ä¼ä¸šç‰ˆåŠŸèƒ½å¼€å…³ç®¡ç† |

**BillingService ç¤ºä¾‹ï¼š**
```typescript
// packages/cli/src/services/billing.service.ts

import { Service } from '@n8n/di';
import { WorkspaceBalanceRepository, UsageRecordRepository } from '@n8n/db';
import { BadRequestError } from '@/errors';

@Service()
export class BillingService {
  constructor(
    private workspaceBalanceRepository: WorkspaceBalanceRepository,
    private usageRecordRepository: UsageRecordRepository,
  ) {}

  /**
   * æŸ¥è¯¢å·¥ä½œç©ºé—´ä½™é¢
   */
  async getBalance(workspaceId: string): Promise<number> {
    return await this.workspaceBalanceRepository.getBalance(workspaceId);
  }

  /**
   * è®°å½•ä½¿ç”¨å¹¶æ‰£è´¹ï¼ˆåŸå­æ“ä½œï¼‰
   */
  async recordUsageAndCharge(params: {
    workspaceId: string;
    userId: string;
    serviceKey: string;
    serviceType: string;
    tokensUsed?: number;
    amountCny: number;
    metadata?: any;
  }): Promise<void> {
    // ä½¿ç”¨äº‹åŠ¡ä¿è¯åŸå­æ€§
    await this.workspaceBalanceRepository.manager.transaction('SERIALIZABLE', async (trx) => {
      // 1. æ‰£è´¹ï¼ˆæ‚²è§‚é”ï¼‰
      await this.workspaceBalanceRepository.deductBalance(
        params.workspaceId,
        params.amountCny,
      );

      // 2. è®°å½•æ¶ˆè´¹
      await trx.save('UsageRecord', {
        workspaceId: params.workspaceId,
        userId: params.userId,
        serviceKey: params.serviceKey,
        serviceType: params.serviceType,
        tokensUsed: params.tokensUsed,
        amountCny: params.amountCny,
        metadata: params.metadata,
      });
    });

    // 3. æ£€æŸ¥æ˜¯å¦ä½ä½™é¢å‘Šè­¦
    await this.checkLowBalanceAlert(params.workspaceId);
  }

  /**
   * åˆ›å»ºå……å€¼è®¢å•
   */
  async createRechargeOrder(params: {
    workspaceId: string;
    userId: string;
    amountCny: number;
    paymentMethod: 'alipay' | 'wechat';
  }): Promise<{ orderId: string; qrCodeUrl: string }> {
    // åˆ›å»ºå……å€¼è®°å½•
    const record = await this.rechargeRecordRepository.save({
      workspaceId: params.workspaceId,
      userId: params.userId,
      amountCny: params.amountCny,
      paymentMethod: params.paymentMethod,
      status: 'pending',
    });

    // è°ƒç”¨æ”¯ä»˜ SDK åˆ›å»ºè®¢å•
    // ...

    return { orderId: record.id, qrCodeUrl: '...' };
  }

  /**
   * å¤„ç†å……å€¼å›è°ƒ
   */
  async handleRechargeCallback(orderId: string): Promise<void> {
    await this.rechargeRecordRepository.manager.transaction(async (trx) => {
      // 1. æ›´æ–°å……å€¼è®°å½•çŠ¶æ€
      const record = await trx.findOne('RechargeRecord', { where: { id: orderId } });
      if (!record || record.status !== 'pending') {
        throw new BadRequestError('Invalid recharge order');
      }

      record.status = 'completed';
      record.completedAt = new Date();
      await trx.save(record);

      // 2. å¢åŠ ä½™é¢
      await trx
        .createQueryBuilder()
        .update('WorkspaceBalance')
        .set({ balanceCny: () => `balance_cny + ${record.amountCny}` })
        .where('workspace_id = :workspaceId', { workspaceId: record.workspaceId })
        .execute();
    });
  }

  private async checkLowBalanceAlert(workspaceId: string): Promise<void> {
    const balance = await this.workspaceBalanceRepository.findOne({
      where: { workspaceId },
    });

    if (balance && balance.balanceCny < balance.lowBalanceThresholdCny) {
      // å‘é€ä½ä½™é¢å‘Šè­¦ï¼ˆé‚®ä»¶/çŸ­ä¿¡ï¼‰
      // await this.emailService.send(...)
    }
  }
}
```

**PlatformServiceService ç¤ºä¾‹ï¼š**
```typescript
// packages/cli/src/services/platform-service.service.ts

import { Service } from '@n8n/di';
import { PlatformServiceRepository } from '@n8n/db';

@Service()
export class PlatformServiceService {
  constructor(
    private platformServiceRepository: PlatformServiceRepository,
  ) {}

  /**
   * è·å–æ‰€æœ‰æ´»è·ƒçš„å¹³å°æœåŠ¡
   */
  async listActiveServices(): Promise<PlatformService[]> {
    return await this.platformServiceRepository.find({
      where: { isActive: true },
    });
  }

  /**
   * è®¡ç®—æœåŠ¡ä»·æ ¼
   */
  async calculatePrice(serviceKey: string, usage: { tokens?: number; calls?: number }): Promise<number> {
    const service = await this.platformServiceRepository.findOne({
      where: { serviceKey },
    });

    if (!service) {
      throw new Error(`Service ${serviceKey} not found`);
    }

    const config = service.pricingConfig as any;

    if (service.serviceType === 'ai_model') {
      return (usage.tokens ?? 0) * config.pricePerToken;
    } else if (service.serviceType === 'rag_service') {
      return (usage.calls ?? 0) * config.pricePerQuery;
    }

    return 0;
  }
}
```

#### éªŒæ”¶æ ‡å‡†

- âœ… WorkspaceContextService å¯æ­£ç¡®æå–å’ŒéªŒè¯å·¥ä½œç©ºé—´ä¸Šä¸‹æ–‡
- âœ… ProjectService æ”¯æŒå®Œæ•´çš„æˆå‘˜ç®¡ç†
- âœ… WorkflowService å’Œ CredentialsService ä¸å†ä¾èµ– SharedWorkflow
- âœ… BillingService å¯æ­£ç¡®æ‰£è´¹ï¼ˆæ‚²è§‚é”é˜²å¹¶å‘ï¼‰
- âœ… PlatformServiceService å¯è®¡ç®—æœåŠ¡ä»·æ ¼
- âœ… è°ƒç”¨å¹³å°æœåŠ¡ä¼šç«‹å³æ‰£è´¹ï¼ˆåŸå­æ€§ï¼‰
- âœ… æ‰€æœ‰ Service å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆè¦†ç›–ç‡ > 80%ï¼‰

---

### ğŸš€ é˜¶æ®µ 4ï¼šController + Middlewareï¼ˆWeek 5-6ï¼‰

**ç›®æ ‡ï¼š** åˆ›å»ºç”¨æˆ·ç«¯å’Œç®¡ç†ç«¯ APIï¼Œå®ç°ä¸­é—´ä»¶

âš ï¸ **å…³é”®ä¼˜åŒ–**ï¼šç”¨æˆ·ç«¯å’Œç®¡ç†ç«¯ API åˆ†å¼€åšï¼Œé¿å…æƒé™æ··æ·†

#### Week 5ï¼šç”¨æˆ·ç«¯ API + ä¸­é—´ä»¶ï¼ˆ5å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| WorkspaceContextMiddleware | 1å¤© | é˜¶æ®µ3 | è‡ªåŠ¨æå–å’ŒéªŒè¯ workspace |
| RateLimitMiddlewareï¼ˆRedisï¼‰ | 1å¤© | æ—  | API é™æµï¼ˆ100 req/minï¼‰ |
| WorkspacesController | 1.5å¤© | é˜¶æ®µ3 | å·¥ä½œç©ºé—´ CRUD + æˆå‘˜ç®¡ç† |
| BillingController | 1å¤© | é˜¶æ®µ3 | ä½™é¢æŸ¥è¯¢ã€å……å€¼ã€æ¶ˆè´¹è®°å½• |
| æ›´æ–° WorkflowsController | 0.5å¤© | é˜¶æ®µ3 | æ·»åŠ  workspace ä¸Šä¸‹æ–‡ |

**WorkspacesController ç¤ºä¾‹ï¼š**
```typescript
// packages/cli/src/controllers/workspaces.controller.ts

import { RestController, Get, Post, Patch, Delete } from '@/decorators';
import { WorkspaceContextService, ProjectService } from '@/services';
import { CurrentUser } from '@/decorators';

@RestController('/workspaces')
export class WorkspacesController {
  constructor(
    private projectService: ProjectService,
    private workspaceContextService: WorkspaceContextService,
  ) {}

  @Get('/')
  async getMyWorkspaces(@CurrentUser() user: User) {
    return await this.projectService.getAccessibleProjects(user.id);
  }

  @Post('/')
  async createTeamWorkspace(@CurrentUser() user: User, @Body() data: CreateProjectDto) {
    return await this.projectService.createTeamProject(user, data);
  }

  @Get('/:id')
  async getWorkspace(@Param('id') projectId: string, @CurrentUser() user: User) {
    await this.workspaceContextService.validateAccess(user.id, projectId);
    return await this.projectService.getProjectWithScope(projectId, { scopes: ['project:read'] });
  }

  @Post('/:id/members')
  async addMembers(
    @Param('id') projectId: string,
    @CurrentUser() user: User,
    @Body() data: { members: Array<{ userId: string; role: string }> },
  ) {
    await this.workspaceContextService.validateAccess(user.id, projectId, 'project:admin');
    return await this.projectService.addUsersToProject(projectId, data.members);
  }

  @Delete('/:id/members/:userId')
  async removeMember(
    @Param('id') projectId: string,
    @Param('userId') userId: string,
    @CurrentUser() user: User,
  ) {
    await this.workspaceContextService.validateAccess(user.id, projectId, 'project:admin');
    return await this.projectService.removeUser(projectId, userId);
  }
}
```

#### Week 6ï¼šç®¡ç†ç«¯ API + WebSocketï¼ˆ5å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| AdminAuthMiddleware | 0.5å¤© | æ—  | éªŒè¯ is_admin æƒé™ |
| AdminPlatformServicesController | 1å¤© | é˜¶æ®µ3 | å¹³å°æœåŠ¡ç®¡ç†ï¼ˆAI æ¨¡å‹ï¼‰ |
| AdminPluginsController | 1å¤© | é˜¶æ®µ3 | æ’ä»¶ç®¡ç†ï¼ˆå¹³å°/ç¬¬ä¸‰æ–¹/å®¡æ ¸ï¼‰ |
| PluginsController | 0.5å¤© | é˜¶æ®µ3 | ç”¨æˆ·ç«¯æ’ä»¶æŸ¥è¯¢ã€ä¸Šä¼ ã€æäº¤å®¡æ ¸ |
| AdminWorkspacesController | 1å¤© | é˜¶æ®µ3 | å·¥ä½œç©ºé—´æœç´¢ã€å……å€¼ã€æš‚åœ |
| AdminStatsController | 1å¤© | é˜¶æ®µ3 | ç»Ÿè®¡æŠ¥è¡¨ |
| AdminPlatformFeaturesController | 0.5å¤© | é˜¶æ®µ3 | ä¼ä¸šç‰ˆåŠŸèƒ½å¼€å…³ç®¡ç† |
| æ”¹é€  PushServiceï¼ˆWebSocket éš”ç¦»ï¼‰ | 1å¤© | Week 5 | å·¥ä½œç©ºé—´æˆ¿é—´éš”ç¦» |

**AdminPlatformServicesController ç¤ºä¾‹ï¼š**
```typescript
// packages/cli/src/controllers/admin/platform-services.controller.ts

import { RestController, Get, Post, Patch } from '@/decorators';
import { RequireAdmin } from '@/decorators';
import { PlatformServiceService } from '@/services';

@RestController('/admin/platform-services')
@RequireAdmin()
export class AdminPlatformServicesController {
  constructor(private platformServiceService: PlatformServiceService) {}

  @Get('/')
  async listServices() {
    return await this.platformServiceService.listAllServices();
  }

  @Post('/')
  async createService(@Body() data: CreatePlatformServiceDto) {
    return await this.platformServiceService.createService(data);
  }

  @Patch('/:key')
  async updateService(@Param('key') serviceKey: string, @Body() updates: any) {
    return await this.platformServiceService.updateService(serviceKey, updates);
  }

  @Patch('/:key/toggle')
  async toggleService(@Param('key') serviceKey: string) {
    return await this.platformServiceService.toggleActive(serviceKey);
  }
}
```

**WebSocket éš”ç¦»ç¤ºä¾‹ï¼š**
```typescript
// packages/cli/src/push/push.service.ts

import { Service } from '@n8n/di';
import { Server, Socket } from 'socket.io';

@Service()
export class PushService {
  private io: Server;

  initialize(server: HttpServer) {
    this.io = new Server(server, {
      path: '/rest/push',
      cors: { origin: true, credentials: true },
    });

    this.io.use(async (socket, next) => {
      // éªŒè¯ token å’Œ workspaceId
      const { token, workspaceId } = socket.handshake.auth;

      const user = await this.verifyToken(token);
      const hasAccess = await this.workspaceContextService.validateAccess(
        user.id,
        workspaceId,
      );

      if (!hasAccess) {
        return next(new Error('Forbidden'));
      }

      socket.data.userId = user.id;
      socket.data.workspaceId = workspaceId;

      // åŠ å…¥å·¥ä½œç©ºé—´æˆ¿é—´
      socket.join(`workspace:${workspaceId}`);

      next();
    });
  }

  /**
   * æ¨é€äº‹ä»¶åˆ°å·¥ä½œç©ºé—´ï¼ˆéš”ç¦»ï¼‰
   */
  sendToWorkspace(workspaceId: string, event: string, data: any) {
    this.io.to(`workspace:${workspaceId}`).emit(event, data);
  }
}
```

#### éªŒæ”¶æ ‡å‡†

- âœ… WorkspaceContextMiddleware è‡ªåŠ¨æå–å’ŒéªŒè¯å·¥ä½œç©ºé—´ä¸Šä¸‹æ–‡
- âœ… RateLimitMiddleware é™æµæ­£å¸¸ï¼ˆ100 req/minï¼‰
- âœ… æ‰€æœ‰ç”¨æˆ·ç«¯ API ç«¯ç‚¹å¯è®¿é—®
- âœ… æ‰€æœ‰ç®¡ç†ç«¯ API éœ€è¦ is_admin æƒé™
- âœ… WebSocket è¿æ¥æ”¯æŒå·¥ä½œç©ºé—´éš”ç¦»
- âœ… API æ–‡æ¡£å·²ç”Ÿæˆï¼ˆSwaggerï¼‰
- âœ… Postman æµ‹è¯•é›†åˆå¯ç”¨

---

### ğŸ¨ é˜¶æ®µ 5ï¼šå‰ç«¯æ”¹é€ ï¼ˆWeek 7-9ï¼‰

**ç›®æ ‡ï¼š** å®ç°å·¥ä½œç©ºé—´åˆ‡æ¢ã€è®¡è´¹ UIã€ç®¡ç†ç«¯å‰ç«¯ã€ä¼ä¸šç‰ˆåŠŸèƒ½å‰ç«¯

âš ï¸ **å…³é”®ä¼˜åŒ–**ï¼šå‰ç«¯åœ¨åç«¯ API ç¨³å®šåæ‰å¼€å§‹

#### Week 7ï¼šçŠ¶æ€ç®¡ç† + åŸºç¡€ç»„ä»¶ï¼ˆ5å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| åˆ›å»º ProjectsStore | 1.5å¤© | é˜¶æ®µ4 | Pinia Store |
| åˆ›å»º BillingStore | 1å¤© | é˜¶æ®µ4 | Pinia Store |
| Axios æ‹¦æˆªå™¨ï¼ˆè‡ªåŠ¨é™„åŠ  X-Workspace-Idï¼‰ | 1å¤© | é˜¶æ®µ4 | å…¨å±€æ‹¦æˆªå™¨ |
| WorkspaceSwitcher ç»„ä»¶ | 1.5å¤© | ProjectsStore | Vue ç»„ä»¶ |

**ProjectsStore ç¤ºä¾‹ï¼š**
```typescript
// packages/frontend/editor-ui/src/stores/projects.store.ts

import { defineStore } from 'pinia';
import { ref, computed } from 'vue';
import { workspacesApi } from '@/api/workspaces';

export const useProjectsStore = defineStore('projects', () => {
  const workspaces = ref<Project[]>([]);
  const currentWorkspaceId = ref<string | null>(null);

  const currentWorkspace = computed(() =>
    workspaces.value.find(w => w.id === currentWorkspaceId.value)
  );

  async function fetchWorkspaces() {
    workspaces.value = await workspacesApi.getMyWorkspaces();

    // å¦‚æœæ²¡æœ‰å½“å‰å·¥ä½œç©ºé—´ï¼Œé»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ª
    if (!currentWorkspaceId.value && workspaces.value.length > 0) {
      currentWorkspaceId.value = workspaces.value[0].id;
    }
  }

  function setActiveWorkspace(workspaceId: string) {
    currentWorkspaceId.value = workspaceId;

    // ä¿å­˜åˆ° localStorage
    localStorage.setItem('activeWorkspaceId', workspaceId);

    // è§¦å‘æ•°æ®åˆ·æ–°äº‹ä»¶
    window.dispatchEvent(new CustomEvent('workspace-changed', {
      detail: { workspaceId }
    }));
  }

  return {
    workspaces,
    currentWorkspaceId,
    currentWorkspace,
    fetchWorkspaces,
    setActiveWorkspace,
  };
});
```

**Axios æ‹¦æˆªå™¨ç¤ºä¾‹ï¼š**
```typescript
// packages/frontend/editor-ui/src/api/axios-config.ts

import axios from 'axios';
import { useProjectsStore } from '@/stores/projects.store';

axios.interceptors.request.use((config) => {
  const projectsStore = useProjectsStore();

  // è‡ªåŠ¨é™„åŠ å·¥ä½œç©ºé—´ ID
  if (projectsStore.currentWorkspaceId) {
    config.headers['X-Workspace-Id'] = projectsStore.currentWorkspaceId;
  }

  // è‡ªåŠ¨é™„åŠ  JWT Token
  const token = localStorage.getItem('authToken');
  if (token) {
    config.headers['Authorization'] = `Bearer ${token}`;
  }

  return config;
});

// å“åº”æ‹¦æˆªå™¨ï¼ˆå¤„ç†é”™è¯¯ï¼‰
axios.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 403) {
      // å·¥ä½œç©ºé—´æƒé™ä¸è¶³
      showError('æ— æƒè®¿é—®æ­¤å·¥ä½œç©ºé—´');
    } else if (error.response?.status === 402) {
      // ä½™é¢ä¸è¶³
      showError('å·¥ä½œç©ºé—´ä½™é¢ä¸è¶³ï¼Œè¯·å……å€¼');
    }
    return Promise.reject(error);
  }
);
```

#### Week 8ï¼šç”¨æˆ·ç«¯é¡µé¢ + èŠ‚ç‚¹åŠ¨æ€åŒ–ï¼ˆ7å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| WorkspacesPageï¼ˆå·¥ä½œç©ºé—´åˆ—è¡¨ï¼‰ | 1.5å¤© | Week 7 | Vue é¡µé¢ |
| WorkspaceSettingsPageï¼ˆæˆå‘˜ç®¡ç†ï¼‰ | 2å¤© | Week 7 | Vue é¡µé¢ |
| BillingPageï¼ˆä½™é¢ + å……å€¼ï¼‰ | 2å¤© | Week 7 | Vue é¡µé¢ |
| **NodeMarketplaceï¼ˆèŠ‚ç‚¹å¸‚åœºï¼‰ã€æ–°ã€‘** | **2å¤©** | **é˜¶æ®µ4** | **Vue é¡µé¢ï¼ˆ4ä¸ªåˆ†ç±»æ ‡ç­¾é¡µï¼‰** |
| **NodeQuotaPageï¼ˆèŠ‚ç‚¹é…é¢å±•ç¤ºï¼‰ã€æ–°ã€‘** | **1å¤©** | **é˜¶æ®µ4** | **Vue é¡µé¢ + å›¾è¡¨** |
| æ›´æ–°å·¥ä½œæµåˆ—è¡¨é¡µï¼ˆworkspace åˆ‡æ¢å“åº”ï¼‰ | 1å¤© | Week 7 | æ›´æ–°ç°æœ‰é¡µé¢ |

**WorkspaceSwitcher ç»„ä»¶ç¤ºä¾‹ï¼š**
```vue
<!-- packages/frontend/editor-ui/src/components/WorkspaceSwitcher.vue -->

<template>
  <n8n-select
    v-model="activeWorkspaceId"
    @update:model-value="handleWorkspaceChange"
  >
    <n8n-option
      v-for="workspace in workspaces"
      :key="workspace.id"
      :value="workspace.id"
      :label="workspace.name"
    >
      <div class="workspace-option">
        <span>{{ workspace.name }}</span>
        <n8n-badge v-if="workspace.type === 'personal'">ä¸ªäºº</n8n-badge>
        <n8n-badge v-else>å›¢é˜Ÿ</n8n-badge>
      </div>
    </n8n-option>
  </n8n-select>
</template>

<script setup lang="ts">
import { computed } from 'vue';
import { useProjectsStore } from '@/stores/projects.store';
import { useWorkflowsStore } from '@/stores/workflows.store';

const projectsStore = useProjectsStore();
const workflowsStore = useWorkflowsStore();

const workspaces = computed(() => projectsStore.workspaces);
const activeWorkspaceId = computed({
  get: () => projectsStore.currentWorkspaceId,
  set: (value) => projectsStore.setActiveWorkspace(value),
});

async function handleWorkspaceChange(workspaceId: string) {
  // åˆ‡æ¢å·¥ä½œç©ºé—´åè‡ªåŠ¨åˆ·æ–°å·¥ä½œæµåˆ—è¡¨
  await workflowsStore.fetchWorkflows();
}
</script>
```

**å·¥ä½œæµåˆ—è¡¨é¡µè‡ªåŠ¨åˆ·æ–°ï¼š**
```typescript
// packages/frontend/editor-ui/src/views/WorkflowsPage.vue

import { watch } from 'vue';
import { useProjectsStore } from '@/stores/projects.store';
import { useWorkflowsStore } from '@/stores/workflows.store';

const projectsStore = useProjectsStore();
const workflowsStore = useWorkflowsStore();

// ç›‘å¬å·¥ä½œç©ºé—´åˆ‡æ¢
watch(
  () => projectsStore.currentWorkspaceId,
  async (newId, oldId) => {
    if (newId && newId !== oldId) {
      await workflowsStore.fetchWorkflows();
    }
  }
);
```

#### Week 9ï¼šç®¡ç†ç«¯å‰ç«¯ + ä¼ä¸šç‰ˆåŠŸèƒ½å‰ç«¯ + èŠ‚ç‚¹ç®¡ç†ï¼ˆ7å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| AdminDashboardï¼ˆç»Ÿè®¡é¢æ¿ï¼‰ | 1.5å¤© | é˜¶æ®µ4 | Vue é¡µé¢ + å›¾è¡¨ |
| AdminPlatformServicesPageï¼ˆAI æ¨¡å‹ï¼‰ | 1å¤© | é˜¶æ®µ4 | Vue é¡µé¢ |
| **AdminNodeManagementï¼ˆèŠ‚ç‚¹ç®¡ç†ï¼‰ã€æ–°ã€‘** | **2å¤©** | **é˜¶æ®µ4** | **Vue é¡µé¢ï¼ˆé…ç½®å¹³å°æ‰˜ç®¡èŠ‚ç‚¹ï¼‰** |
| AdminPluginsPageï¼ˆæ’ä»¶ç®¡ç† + å®¡æ ¸ï¼‰ | 1.5å¤© | é˜¶æ®µ4 | Vue é¡µé¢ |
| PluginMarketPageï¼ˆç”¨æˆ·æ’ä»¶å¸‚åœºï¼‰ | 1å¤© | é˜¶æ®µ4 | Vue é¡µé¢ |
| AdminWorkspacesPage | 1å¤© | é˜¶æ®µ4 | Vue é¡µé¢ |
| PlatformFeaturesPageï¼ˆåŠŸèƒ½ç®¡ç†ï¼‰ | 1å¤© | é˜¶æ®µ4 | Vue é¡µé¢ |
| WorkspaceSettings æ‰©å±•ï¼ˆç¯å¢ƒå˜é‡ + å®¡è®¡æ—¥å¿—ï¼‰ | 1å¤© | Week 8 | Tab ç»„ä»¶ |
| PersonalSettingsï¼ˆMFA + åå¥½ï¼‰ | 0.5å¤© | Week 8 | Settings é¡µé¢ |

#### éªŒæ”¶æ ‡å‡†

- âœ… ProjectsStore ç®¡ç†æ‰€æœ‰å·¥ä½œç©ºé—´
- âœ… å·¥ä½œç©ºé—´åˆ‡æ¢å™¨æ­£å¸¸å·¥ä½œ
- âœ… åˆ‡æ¢å·¥ä½œç©ºé—´åæ•°æ®è‡ªåŠ¨åˆ·æ–°
- âœ… æ‰€æœ‰ API è¯·æ±‚è‡ªåŠ¨å¸¦ X-Workspace-Id
- âœ… ä½™é¢æ˜¾ç¤ºå®æ—¶æ›´æ–°
- âœ… å……å€¼æµç¨‹å®Œæ•´ï¼ˆäºŒç»´ç æ‰«æ â†’ å›è°ƒ â†’ ä½™é¢æ›´æ–°ï¼‰
- âœ… **èŠ‚ç‚¹å¸‚åœºå±•ç¤º 4 ä¸ªåˆ†ç±»ï¼ˆå¹³å°æ‰˜ç®¡ã€ç¬¬ä¸‰æ–¹ã€åŠŸèƒ½ã€å®˜æ–¹æ’ä»¶ï¼‰ã€æ–°ã€‘**
- âœ… **ç”¨æˆ·å¯ç›´æ¥ä½¿ç”¨å¹³å°æ‰˜ç®¡çš„ OpenAI èŠ‚ç‚¹ï¼ˆæ— éœ€é…ç½® API Keyï¼‰ã€æ–°ã€‘**
- âœ… **èŠ‚ç‚¹é…é¢é¡µé¢æ˜¾ç¤º AI èŠ‚ç‚¹ä½¿ç”¨æƒ…å†µå’Œç»Ÿè®¡å›¾è¡¨ã€æ–°ã€‘**
- âœ… **åå°ç®¡ç†å‘˜å¯é…ç½®å¹³å°æ‰˜ç®¡èŠ‚ç‚¹ï¼ˆæ·»åŠ /æ›´æ–° API Keyã€è®¾ç½®é…é¢ï¼‰ã€æ–°ã€‘**
- âœ… åå°ç®¡ç†ç³»ç»Ÿå¯è®¿é—®ï¼ˆadmin.example.comï¼‰
- âœ… æ‰€æœ‰ç®¡ç†åŠŸèƒ½æ­£å¸¸
- âœ… ä¼ä¸šç‰ˆåŠŸèƒ½å¼€å…³ UI å®Œæ•´
- âœ… ç¯å¢ƒå˜é‡å’Œå®¡è®¡æ—¥å¿—å·¥ä½œç©ºé—´éš”ç¦»

---

### ğŸ’³ é˜¶æ®µ 6ï¼šæ”¯ä»˜é›†æˆï¼ˆWeek 10ï¼Œ5å¤©ï¼‰

**ç›®æ ‡ï¼š** é›†æˆæ”¯ä»˜å®å’Œå¾®ä¿¡æ”¯ä»˜

âš ï¸ **å…³é”®ä¼˜åŒ–**ï¼šæ”¯ä»˜æ”¾åœ¨æœ€åï¼Œä¸é˜»å¡ä¸»æµç¨‹ï¼ˆå¯å…ˆç”¨ç®¡ç†å‘˜å……å€¼ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | ä¾èµ– | äº¤ä»˜ç‰© |
|--------|---------|------|--------|
| æ”¯ä»˜å® SDK é›†æˆ | 2å¤© | é˜¶æ®µ3 | æ”¯ä»˜æ¥å£ + å›è°ƒå¤„ç† |
| å¾®ä¿¡æ”¯ä»˜ SDK é›†æˆ | 2å¤© | é˜¶æ®µ3 | æ”¯ä»˜æ¥å£ + å›è°ƒå¤„ç† |
| å……å€¼å›è°ƒå¤„ç†ï¼ˆç»Ÿä¸€ï¼‰ | 0.5å¤© | ä¸Šé¢ä¸¤æ­¥ | Webhook å¤„ç† |
| æ”¯ä»˜æ²™ç®±æµ‹è¯• | 0.5å¤© | ä¸Šé¢æ‰€æœ‰ | æµ‹è¯•æŠ¥å‘Š |

#### æ”¯ä»˜å®é›†æˆç¤ºä¾‹

```typescript
// packages/cli/src/services/payment/alipay.service.ts

import { Service } from '@n8n/di';
import AlipaySdk from 'alipay-sdk';

@Service()
export class AlipayService {
  private sdk: AlipaySdk;

  constructor() {
    this.sdk = new AlipaySdk({
      appId: process.env.ALIPAY_APP_ID,
      privateKey: process.env.ALIPAY_PRIVATE_KEY,
      alipayPublicKey: process.env.ALIPAY_PUBLIC_KEY,
      gateway: 'https://openapi.alipay.com/gateway.do',
    });
  }

  async createQRCodeOrder(params: {
    orderId: string;
    amount: number;
    subject: string;
  }): Promise<{ qrCodeUrl: string }> {
    const result = await this.sdk.exec('alipay.trade.precreate', {
      bizContent: {
        out_trade_no: params.orderId,
        total_amount: params.amount.toFixed(2),
        subject: params.subject,
        notify_url: `${process.env.APP_URL}/rest/billing/alipay/callback`,
      },
    });

    return { qrCodeUrl: result.qrCode };
  }

  verifyCallback(params: any, signature: string): boolean {
    return this.sdk.checkNotifySign(params);
  }
}
```

#### éªŒæ”¶æ ‡å‡†

- âœ… æ”¯ä»˜å®å……å€¼æµç¨‹æ­£å¸¸ï¼ˆæ²™ç®±ç¯å¢ƒï¼‰
- âœ… å¾®ä¿¡æ”¯ä»˜å……å€¼æµç¨‹æ­£å¸¸ï¼ˆæ²™ç®±ç¯å¢ƒï¼‰
- âœ… å……å€¼å›è°ƒæ­£ç¡®æ›´æ–°ä½™é¢
- âœ… å……å€¼è®°å½•å®Œæ•´ä¿å­˜
- âœ… å¼‚å¸¸æƒ…å†µå¤„ç†å®Œå–„ï¼ˆæ”¯ä»˜è¶…æ—¶ã€é‡å¤å›è°ƒç­‰ï¼‰

---

### ğŸ§ª é˜¶æ®µ 7ï¼šé›†æˆæµ‹è¯• + ä¼˜åŒ–ï¼ˆWeek 11-12ï¼‰

**ç›®æ ‡ï¼š** ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§å’Œæ€§èƒ½

#### Week 11ï¼šåŠŸèƒ½æµ‹è¯•ï¼ˆ5å¤©ï¼‰

| æµ‹è¯•ç±»å‹ | é¢„è®¡å·¥æ—¶ | è´Ÿè´£äºº | äº¤ä»˜ç‰© |
|---------|---------|--------|--------|
| æ•°æ®éš”ç¦»æµ‹è¯•ï¼ˆè·¨å·¥ä½œç©ºé—´æ³„æ¼ï¼‰ | 1.5å¤© | QA | æµ‹è¯•ç”¨ä¾‹ + æŠ¥å‘Š |
| æƒé™æµ‹è¯•ï¼ˆRBACï¼‰ | 1.5å¤© | QA | æµ‹è¯•ç”¨ä¾‹ + æŠ¥å‘Š |
| è®¡è´¹æµç¨‹æµ‹è¯•ï¼ˆæ‰£è´¹å‡†ç¡®æ€§ï¼‰ | 1å¤© | QA | æµ‹è¯•ç”¨ä¾‹ + æŠ¥å‘Š |
| ä¼ä¸šç‰ˆåŠŸèƒ½æµ‹è¯•ï¼ˆå¼€å…³æœ‰æ•ˆæ€§ï¼‰ | 1å¤© | QA | æµ‹è¯•ç”¨ä¾‹ + æŠ¥å‘Š |

**æ•°æ®éš”ç¦»æµ‹è¯•æ¸…å•ï¼š**
- [ ] ç”¨æˆ· A æ— æ³•çœ‹åˆ°ç”¨æˆ· B å·¥ä½œç©ºé—´çš„å·¥ä½œæµ
- [ ] ç”¨æˆ· A æ— æ³•çœ‹åˆ°ç”¨æˆ· B å·¥ä½œç©ºé—´çš„å‡­è¯
- [ ] ç”¨æˆ· A æ— æ³•çœ‹åˆ°ç”¨æˆ· B å·¥ä½œç©ºé—´çš„æ‰§è¡Œå†å²
- [ ] ç”¨æˆ· A æ— æ³•çœ‹åˆ°ç”¨æˆ· B å·¥ä½œç©ºé—´çš„ä½™é¢
- [ ] ç¯å¢ƒå˜é‡å®Œå…¨éš”ç¦»
- [ ] å®¡è®¡æ—¥å¿—å®Œå…¨éš”ç¦»

**æƒé™æµ‹è¯•æ¸…å•ï¼š**
- [ ] Viewer ä¸èƒ½ç¼–è¾‘å·¥ä½œæµ
- [ ] Viewer ä¸èƒ½åˆ é™¤å·¥ä½œæµ
- [ ] Editor å¯ä»¥ç¼–è¾‘å·¥ä½œæµä½†ä¸èƒ½ç®¡ç†æˆå‘˜
- [ ] Admin å¯ä»¥æ·»åŠ /åˆ é™¤æˆå‘˜
- [ ] PersonalOwner å¯ä»¥åˆ é™¤å·¥ä½œç©ºé—´

**è®¡è´¹æµ‹è¯•æ¸…å•ï¼š**
- [ ] AI æ¨¡å‹è°ƒç”¨æ­£ç¡®æ‰£è´¹ï¼ˆæŒ‰ tokenï¼‰
- [ ] RAG æœåŠ¡è°ƒç”¨æ­£ç¡®æ‰£è´¹ï¼ˆæŒ‰æ¬¡æ•°ï¼‰
- [ ] ä½™é¢ä¸è¶³æ‹’ç»æ‰§è¡Œ
- [ ] å……å€¼æˆåŠŸå¢åŠ ä½™é¢
- [ ] ä½ä½™é¢å‘Šè­¦è§¦å‘

#### Week 12ï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆ5å¤©ï¼‰

| å­ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | è´Ÿè´£äºº | äº¤ä»˜ç‰© |
|--------|---------|--------|--------|
| æ•°æ®åº“æ…¢æŸ¥è¯¢ä¼˜åŒ– | 2å¤© | åç«¯ + DBA | ç´¢å¼•ä¼˜åŒ– + æŸ¥è¯¢é‡å†™ |
| Redis ç¼“å­˜å®æ–½ | 2å¤© | åç«¯ | ç¼“å­˜ç­–ç•¥æ–‡æ¡£ |
| å‰ç«¯æ‰“åŒ…ä¼˜åŒ–ï¼ˆCode Splittingï¼‰ | 0.5å¤© | å‰ç«¯ | æ‰“åŒ…é…ç½® |
| å‹åŠ›æµ‹è¯•ï¼ˆ1000 å¹¶å‘ï¼‰ | 0.5å¤© | DevOps | æ€§èƒ½æŠ¥å‘Š |

**æ€§èƒ½ç›®æ ‡ï¼š**
| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… |
|------|------|------|
| å·¥ä½œæµåˆ—è¡¨æŸ¥è¯¢ | < 100ms | ___ |
| å·¥ä½œç©ºé—´åˆ‡æ¢ | < 50ms | ___ |
| æƒé™æ£€æŸ¥è€—æ—¶ | < 10ms | ___ |
| ä½™é¢æŸ¥è¯¢ | < 20ms | ___ |
| æ”¯æŒå¹¶å‘ç”¨æˆ·æ•° | > 1000 | ___ |

**ç¼“å­˜ç­–ç•¥ï¼š**
```typescript
// Redis ç¼“å­˜ç¤ºä¾‹

// 1. ç¼“å­˜å·¥ä½œç©ºé—´æˆå‘˜å…³ç³»ï¼ˆ5åˆ†é’Ÿï¼‰
const cacheKey = `workspace:${workspaceId}:members`;
let members = await redis.get(cacheKey);
if (!members) {
  members = await this.projectRelationRepository.find({ where: { projectId: workspaceId } });
  await redis.set(cacheKey, JSON.stringify(members), 'EX', 300);
}

// 2. ç¼“å­˜ä½™é¢ï¼ˆ10ç§’ï¼Œé˜²æ­¢é¢‘ç¹æŸ¥è¯¢ï¼‰
const balanceCacheKey = `workspace:${workspaceId}:balance`;
let balance = await redis.get(balanceCacheKey);
if (!balance) {
  balance = await this.workspaceBalanceRepository.getBalance(workspaceId);
  await redis.set(balanceCacheKey, balance, 'EX', 10);
}

// 3. ç¼“å­˜å¹³å°æœåŠ¡åˆ—è¡¨ï¼ˆ1å°æ—¶ï¼‰
const servicesCacheKey = 'platform:services:active';
let services = await redis.get(servicesCacheKey);
if (!services) {
  services = await this.platformServiceRepository.find({ where: { isActive: true } });
  await redis.set(servicesCacheKey, JSON.stringify(services), 'EX', 3600);
}
```

#### éªŒæ”¶æ ‡å‡†

- âœ… æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- âœ… å…³é”® Bug å·²ä¿®å¤
- âœ… æµ‹è¯•è¦†ç›–ç‡ > 70%
- âœ… API å“åº”æ—¶é—´ < 100ms (p95)
- âœ… æ”¯æŒ 1000 å¹¶å‘ç”¨æˆ·
- âœ… æ•°æ®åº“æŸ¥è¯¢ < 50ms
- âœ… ç›‘æ§å‘Šè­¦æ­£å¸¸

---

## å››ã€é£é™©ç®¡ç†

### 4.1 æŠ€æœ¯é£é™©

| é£é™© | å¯èƒ½æ€§ | å½±å“ | åº”å¯¹æªæ–½ | è´Ÿè´£äºº |
|------|--------|------|---------|--------|
| æ•°æ®åº“è¿ç§»å¤±è´¥ | ä½ | é«˜ | Week 0 å……åˆ†æµ‹è¯•ï¼Œå‡†å¤‡å›æ»šæ–¹æ¡ˆ | DBA |
| Repository é‡æ„é—æ¼ | ä¸­ | é«˜ | ä½¿ç”¨ TypeScript ç¼–è¯‘å™¨æ‰¾é—æ¼ï¼Œä»£ç å®¡æŸ¥ | åç«¯ |
| å¹¶å‘æ‰£è´¹å†²çª | ä½ | é«˜ | ä½¿ç”¨æ‚²è§‚é”ï¼ˆSERIALIZABLE äº‹åŠ¡ï¼‰ | åç«¯ |
| å‰åç«¯æ¥å£ä¸ä¸€è‡´ | ä¸­ | ä¸­ | API æ–‡æ¡£å…ˆè¡Œï¼Œæ¥å£è¯„å®¡ä¼š | å…¨æ ˆ |
| æ”¯ä»˜é›†æˆå¤±è´¥ | ä½ | ä¸­ | ä½¿ç”¨æ²™ç®±ç¯å¢ƒå……åˆ†æµ‹è¯• | åç«¯ |
| Redis ç¼“å­˜é›ªå´© | ä½ | ä¸­ | ç¼“å­˜è¿‡æœŸæ—¶é—´åŠ éšæœºå€¼ | åç«¯ |

### 4.2 è¿›åº¦é£é™©

| é£é™© | å¯èƒ½æ€§ | å½±å“ | åº”å¯¹æªæ–½ | è´Ÿè´£äºº |
|------|--------|------|---------|--------|
| äººå‘˜ä¸è¶³ | ä¸­ | é«˜ | æå‰æ‹›è˜/å¤–åŒ… | PM |
| éœ€æ±‚å˜æ›´ | é«˜ | ä¸­ | æ•æ·å¼€å‘ï¼Œç•™å‡º buffer æ—¶é—´ | PM |
| æŠ€æœ¯éš¾é¢˜ | ä¸­ | ä¸­ | æŠ€æœ¯æ”»å…³ï¼Œå¯»æ±‚å¤–éƒ¨æ”¯æŒ | æŠ€æœ¯ Leader |
| æµ‹è¯•æ—¶é—´ä¸è¶³ | ä¸­ | é«˜ | å¼€å‘é˜¶æ®µåŒæ­¥æµ‹è¯• | QA |
| ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡å»¶è¿Ÿ | ä¸­ | ä½ | å¹¶è¡Œå¼€å‘ï¼Œæ”¯ä»˜é›†æˆæ”¾æœ€å | åç«¯ |

---

## äº”ã€èµ„æºéœ€æ±‚

### 5.1 å›¢é˜Ÿé…ç½®

| è§’è‰² | äººæ•° | æŠ•å…¥åº¦ | å…³é”®æŠ€èƒ½ | ä¸»è¦è´Ÿè´£ |
|------|------|--------|---------|---------|
| **å…¨æ ˆå·¥ç¨‹å¸ˆ** | 2äºº | 100% | TypeScript, Vue, Node.js | æ ¸å¿ƒå¼€å‘ |
| **åç«¯å·¥ç¨‹å¸ˆ** | 1äºº | 100% | TypeORM, PostgreSQL, Redis | Repository + Service |
| **å‰ç«¯å·¥ç¨‹å¸ˆ** | 1äºº | 100% | Vue 3, Pinia, TypeScript | UI ç»„ä»¶ + é¡µé¢ |
| **QA å·¥ç¨‹å¸ˆ** | 1äºº | 80% | Jest, Playwright | æµ‹è¯• |
| **DevOps å·¥ç¨‹å¸ˆ** | 1äºº | 50% | Docker, Nginx, ç›‘æ§ | éƒ¨ç½² + ç›‘æ§ |
| **DBA** | 1äºº | 30% | PostgreSQL ä¼˜åŒ– | æ•°æ®åº“è¿ç§» + ä¼˜åŒ– |
| **äº§å“ç»ç†** | 1äºº | 50% | éœ€æ±‚ç®¡ç† | åè°ƒ + éªŒæ”¶ |

**æ€»äººåŠ›ï¼š** çº¦ 5.3 äºº Ã— 12 å‘¨ = **63.6 äººå‘¨**

### 5.2 æŠ€æœ¯æ ˆ

**åç«¯ï¼š**
- Node.js 20+
- TypeScript 5+
- Express 4+
- TypeORM 0.3+
- PostgreSQL 15+
- Redis 7+
- Jest

**å‰ç«¯ï¼š**
- Vue 3.4+
- Pinia
- Vite 5+
- Vitest

**åŸºç¡€è®¾æ–½ï¼š**
- Docker
- Nginx
- Prometheus + Grafana
- Sentry

### 5.3 å¤–éƒ¨æœåŠ¡

- OpenAI API
- Claude API (Anthropic)
- Pineconeï¼ˆå‘é‡æ•°æ®åº“ï¼‰
- æ”¯ä»˜å®å¼€æ”¾å¹³å°
- å¾®ä¿¡æ”¯ä»˜
- é˜¿é‡Œäº‘ SMSï¼ˆçŸ­ä¿¡ï¼‰
- é˜¿é‡Œäº‘ Emailï¼ˆé‚®ä»¶ï¼‰

---

## å…­ã€è´¨é‡æ ‡å‡†

### 6.1 ä»£ç è´¨é‡

- âœ… TypeScript è¦†ç›–ç‡ 100%
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- âœ… ESLint æ— é”™è¯¯
- âœ… Prettier æ ¼å¼ç»Ÿä¸€
- âœ… Code Review é€šè¿‡ç‡ 100%

### 6.2 æ€§èƒ½æ ‡å‡†

- âœ… API å“åº”æ—¶é—´ < 100ms (p95)
- âœ… æ•°æ®åº“æŸ¥è¯¢ < 50ms
- âœ… å‰ç«¯é¦–å±åŠ è½½ < 2s
- âœ… æ”¯æŒ 1000 å¹¶å‘ç”¨æˆ·

### 6.3 å®‰å…¨æ ‡å‡†

- âœ… SQL æ³¨å…¥é˜²æŠ¤
- âœ… XSS é˜²æŠ¤
- âœ… CSRF é˜²æŠ¤ï¼ˆJWTï¼‰
- âœ… API é™æµï¼ˆ100 req/minï¼‰
- âœ… æ•æ„Ÿæ•°æ®åŠ å¯†

---

## ä¸ƒã€å‘å¸ƒç­–ç•¥

### 7.1 ç°åº¦å‘å¸ƒè®¡åˆ’

| é˜¶æ®µ | ç”¨æˆ·èŒƒå›´ | æ—¶é—´ | è§‚å¯ŸæŒ‡æ ‡ |
|------|---------|------|---------|
| **Alpha** | å†…éƒ¨å›¢é˜Ÿï¼ˆ5äººï¼‰ | Week 11 | åŠŸèƒ½å®Œæ•´æ€§ |
| **Beta** | å‹å¥½ç”¨æˆ·ï¼ˆ20äººï¼‰ | Week 12 | ç¨³å®šæ€§ + æ€§èƒ½ |
| **æ­£å¼å‘å¸ƒ** | å…¨é‡ç”¨æˆ· | Week 13+ | æ€§èƒ½ã€ç¨³å®šæ€§ã€ç”¨æˆ·åé¦ˆ |

### 7.2 å›æ»šç­–ç•¥

**è§¦å‘æ¡ä»¶ï¼š**
- ä¸¥é‡ Bug å½±å“æ ¸å¿ƒåŠŸèƒ½
- ç³»ç»Ÿç¨³å®šæ€§ < 99%
- ç”¨æˆ·æŠ•è¯‰æ¿€å¢
- æ•°æ®å®‰å…¨é—®é¢˜

**å›æ»šæµç¨‹ï¼š**
```bash
# 1. åœæ­¢æ–°ç‰ˆæœ¬æœåŠ¡
pm2 stop n8n-backend

# 2. æ¢å¤æ•°æ®åº“ï¼ˆå¦‚éœ€è¦ï¼‰
psql -U n8n -d n8n < rollback_backup_20251201.sql

# 3. åˆ‡æ¢åˆ°æ—§ç‰ˆæœ¬
git checkout <previous-stable-commit>
pnpm build

# 4. é‡å¯æœåŠ¡
pm2 start n8n-backend

# 5. ç›‘æ§éªŒè¯
watch -n 1 'curl http://localhost:5678/healthz'
```

---

## å…«ã€é‡Œç¨‹ç¢‘æ€»ç»“

| é‡Œç¨‹ç¢‘ | å®Œæˆæ—¶é—´ | å…³é”®äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|--------|---------|-----------|---------|
| **M0: å‡†å¤‡** | Week 0 | å¤‡ä»½ + å›æ»šæ–¹æ¡ˆ + ç›‘æ§ | æ•°æ®åº“å¤‡ä»½å¯æ¢å¤ |
| **M1: æ•°æ®åº“** | Week 1 | æ‰€æœ‰è¡¨ç»“æ„æ”¹é€ å®Œæˆ | æ‰€æœ‰éªŒè¯ SQL é€šè¿‡ |
| **M2: Entity+Repository** | Week 2 | Entity å’Œ Repository é‡æ„å®Œæˆ | TypeScript ç¼–è¯‘é€šè¿‡ |
| **M3: Service** | Week 4 | æ‰€æœ‰ Service åˆ›å»ºå®Œæˆ | å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80% |
| **M4: Controller** | Week 6 | æ‰€æœ‰ API ç«¯ç‚¹å®Œæˆ | Postman æµ‹è¯•é›†åˆå¯ç”¨ |
| **M5: å‰ç«¯** | Week 9 | ç”¨æˆ·ç«¯å’Œç®¡ç†ç«¯å‰ç«¯å®Œæˆ | åŠŸèƒ½æ¼”ç¤ºå¯ç”¨ |
| **M6: æ”¯ä»˜** | Week 10 | æ”¯ä»˜é›†æˆå®Œæˆ | æ²™ç®±æµ‹è¯•é€šè¿‡ |
| **M7: ä¸Šçº¿** | Week 12 | ç³»ç»Ÿä¼˜åŒ–å®Œæˆ | æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡ |

---

## ä¹ã€é™„å½•ï¼šä¼˜åŒ–å¯¹æ¯”

### 9.1 æ‰§è¡Œé¡ºåºå¯¹æ¯”

| æ¨¡å— | åŸæ–¹æ¡ˆ | ä¼˜åŒ–å | ä¼˜åŒ–åŸå›  |
|------|--------|--------|---------|
| **æ•°æ®åº“è¿ç§»** | Week 1 éƒ¨åˆ† + Week 11 è®¡è´¹è¡¨ | Week 1 å…¨éƒ¨å®Œæˆ | é¿å…å¼€å‘æœŸé—´å…¼å®¹æ–°æ—§æ¶æ„ |
| **Entity + Repository** | Week 2 åˆ†å¼€åš | Week 2 åŒæ­¥åš | Entity å’Œ Repository å¼ºè€¦åˆï¼Œå¿…é¡»åŒæ­¥ |
| **è®¡è´¹ + å¹³å°æœåŠ¡** | Week 11 + Week 14 | Week 4 ä¸€èµ·åš | ä¿è¯"è°ƒç”¨æœåŠ¡ç«‹å³æ‰£è´¹"åŸå­æ€§ |
| **å‰ç«¯** | Week 4 | Week 7 | ç­‰åç«¯ API ç¨³å®šåå†å¼€å§‹ |
| **æ”¯ä»˜** | Week 13 | Week 10 | ä¸é˜»å¡ä¸»æµç¨‹ï¼Œå¯å¹¶è¡Œå¼€å‘ |

### 9.2 æ€»å·¥æœŸå¯¹æ¯”

| é¡¹ç›® | åŸæ–¹æ¡ˆ | ä¼˜åŒ–å | èŠ‚çœ |
|------|--------|--------|------|
| **æ€»å·¥æœŸ** | 15-16 å‘¨ | 12 å‘¨ | **3-4 å‘¨** |
| **è¿”å·¥é£é™©** | é«˜ | ä½ | **-50%** |
| **å¹¶è¡Œå¼€å‘** | å°‘ | å¤š | **+40%** |

### 9.3 å…³é”®ä¼˜åŒ–ç‚¹

1. âœ… **æ•°æ®åº“æ”¹é€ é›†ä¸­å¤„ç†**ï¼ˆWeek 1 å…¨éƒ¨å®Œæˆï¼‰
2. âœ… **Entity + Repository åŒæ­¥ä¿®æ”¹**ï¼ˆé¿å…ç±»å‹é”™è¯¯ï¼‰
3. âœ… **è®¡è´¹ + å¹³å°æœåŠ¡ä¸€èµ·å¼€å‘**ï¼ˆä¿è¯åŸå­æ€§ï¼‰
4. âœ… **å‰ç«¯åœ¨åç«¯ç¨³å®šåå¼€å§‹**ï¼ˆå‡å°‘è¿”å·¥ï¼‰
5. âœ… **æ”¯ä»˜ä¸é˜»å¡ä¸»æµç¨‹**ï¼ˆå¹¶è¡Œå¼€å‘ï¼‰

---

## åã€å®æ–½è¿›åº¦è¯¦ç»†è®°å½•

### âœ… é˜¶æ®µ 0ï¼šå‡†å¤‡é˜¶æ®µï¼ˆå·²å®Œæˆ - 2025-01-07ï¼‰

**å®Œæˆæ—¶é—´ï¼š** 2025-01-07
**çŠ¶æ€ï¼š** âœ… å®Œæˆ

| ä»»åŠ¡ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| åˆ†æç°æœ‰æ•°æ®åº“ç»“æ„ | âœ… | å®Œæˆå¯¹ Entityã€Repository çš„å…¨é¢åˆ†æ |
| åˆ†æè¿ç§»ç³»ç»Ÿ | âœ… | å®Œæˆå¯¹ TypeORM è¿ç§»æœºåˆ¶çš„æ·±å…¥ç ”ç©¶ |
| å‡†å¤‡å¼€å‘ç¯å¢ƒ | âœ… | éªŒè¯æ„å»ºç³»ç»Ÿå’Œä¾èµ–é¡¹ |

**äº¤ä»˜ç‰©ï¼š**
- å®Œæ•´çš„ Entity ç»“æ„åˆ†ææŠ¥å‘Š
- è¿ç§»ç³»ç»Ÿä½¿ç”¨æŒ‡å—
- å¼€å‘ç¯å¢ƒéªŒè¯é€šè¿‡

---

### âœ… é˜¶æ®µ 1ï¼šæ•°æ®åº“è¿ç§»è„šæœ¬åˆ›å»ºï¼ˆå·²å®Œæˆ - 2025-01-07ï¼‰

**å®Œæˆæ—¶é—´ï¼š** 2025-01-07
**çŠ¶æ€ï¼š** âœ… å®Œæˆ
**ä»£ç é‡ï¼š** 1,412 è¡Œ

#### 1.1 åˆ›å»ºçš„è¿ç§»æ–‡ä»¶

| æ–‡ä»¶ | è¡Œæ•° | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| `1762511301780-MultitenantTransformation.ts` | 350 | âœ… | åˆ é™¤ SharedWorkflow/SharedCredentials |
| `1762511302000-CreateBillingTables.ts` | 280 | âœ… | è®¡è´¹ç³»ç»Ÿè¡¨ï¼ˆä½™é¢ã€æ¶ˆè´¹ã€å……å€¼ï¼‰ |
| `1762511302220-CreatePlatformServiceTables.ts` | 341 | âœ… | å¹³å°æœåŠ¡è¡¨ï¼ˆAI æ¨¡å‹ã€RAGï¼‰ |
| `1762511302440-CreatePlatformFeatureTables.ts` | 441 | âœ… | ä¼ä¸šç‰ˆåŠŸèƒ½ç®¡ç†è¡¨ |

#### 1.2 åˆ›å»ºçš„æ•°æ®åº“è¡¨

| è¡¨å | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `workspace_balance` | æ–°å»º | å·¥ä½œç©ºé—´ä½™é¢ |
| `usage_record` | æ–°å»º | æ¶ˆè´¹è®°å½• |
| `recharge_record` | æ–°å»º | å……å€¼è®°å½• |
| `platform_service` | æ–°å»º | å¹³å°æœåŠ¡ï¼ˆAI æ¨¡å‹ï¼‰ |
| `platform_rag_service` | æ–°å»º | å‚ç›´ RAG æœåŠ¡ |
| `platform_feature_config` | æ–°å»º | å¹³å°åŠŸèƒ½é…ç½® |
| `user` | æ‰©å±• | æ·»åŠ  is_adminã€feature_preferences |
| `project` | æ‰©å±• | æ·»åŠ  feature_config |
| `shared_workflow` | åˆ é™¤ | æ¿€è¿›æ”¹é€  |
| `shared_credentials` | åˆ é™¤ | æ¿€è¿›æ”¹é€  |

#### 1.3 æ’å…¥çš„åˆå§‹æ•°æ®

| è¡¨ | è®°å½•æ•° | è¯´æ˜ |
|------|--------|------|
| `platform_service` | 5 æ¡ | AI æ¨¡å‹ï¼ˆGPT-4ã€Claude 3 ç­‰ï¼‰ |
| `platform_rag_service` | 3 æ¡ | RAG æœåŠ¡ï¼ˆæ³•å¾‹ã€åŒ»ç–—ã€é‡‘èï¼‰ |
| `platform_feature_config` | 10 æ¡ | åŠŸèƒ½å¼€å…³é…ç½® |

#### 1.4 é…å¥—æ–‡æ¡£

| æ–‡æ¡£ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| æ•°æ®åº“è¿ç§»è¯´æ˜.md | 368 | è¯¦ç»†æ‰§è¡ŒæŒ‡å— |
| è¿ç§»æµ‹è¯•è®¡åˆ’.md | 546 | 9 ä¸ªæµ‹è¯•ç”¨ä¾‹ |
| MIGRATION_CHECKLIST.md | 378 | æ‰§è¡Œæ£€æŸ¥æ¸…å• |
| MIGRATION_SUMMARY.md | 444 | å·¥ä½œæ€»ç»“ |
| README_MultitenantTransformation.md | 180 | å¿«é€Ÿå‚è€ƒ |
| ç´¢å¼•æ›´æ–°æŒ‡å— | - | æ³¨å†ŒæŒ‡å— |

#### 1.5 è´¨é‡éªŒè¯

- âœ… TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- âœ… è·¨æ•°æ®åº“å…¼å®¹ï¼ˆPostgreSQLã€MySQLã€SQLiteï¼‰
- âœ… å®Œæ•´çš„å›æ»šæ–¹æ³•
- âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯
- âœ… å·²æ³¨å†Œåˆ°ä¸‰ä¸ªæ•°æ®åº“ç´¢å¼•

---

### ğŸŸ¡ é˜¶æ®µ 2ï¼šEntity + Repository å±‚é‡æ„ï¼ˆè¿›è¡Œä¸­ - 80%ï¼‰

**å¼€å§‹æ—¶é—´ï¼š** 2025-01-07
**çŠ¶æ€ï¼š** ğŸŸ¡ è¿›è¡Œä¸­ï¼ˆ80%ï¼‰

#### 2.1 å·²å®Œæˆçš„å·¥ä½œ

##### åˆ é™¤æ—§æ–‡ä»¶ï¼ˆâœ… å®Œæˆï¼‰

| æ–‡ä»¶ | ç±»å‹ | çŠ¶æ€ | å¤‡ä»½ä½ç½® |
|------|------|------|----------|
| `shared-workflow.ts` | Entity | âœ… å·²åˆ é™¤ | `/tmp/n8n-entity-backup/` |
| `shared-credentials.ts` | Entity | âœ… å·²åˆ é™¤ | `/tmp/n8n-entity-backup/` |
| `shared-workflow.repository.ts` | Repository | âœ… å·²åˆ é™¤ | `/tmp/n8n-entity-backup/` |
| `shared-credentials.repository.ts` | Repository | âœ… å·²åˆ é™¤ | `/tmp/n8n-entity-backup/` |
| `shared-credentials.repository.test.ts` | æµ‹è¯• | âœ… å·²åˆ é™¤ | `/tmp/n8n-entity-backup/` |

##### æ›´æ–°æ ¸å¿ƒ Entityï¼ˆâœ… å®Œæˆï¼‰

| Entity | ä¿®æ”¹å†…å®¹ | çŠ¶æ€ |
|--------|----------|------|
| `WorkflowEntity` | åˆ é™¤ shared å…³è”ï¼Œæ·»åŠ  project ç›´æ¥å…³è” | âœ… |
| `CredentialsEntity` | åˆ é™¤ shared å…³è”ï¼Œæ·»åŠ  project ç›´æ¥å…³è” | âœ… |
| `Project` | æ›´æ–°ä¸ºç›´æ¥æŒæœ‰ workflows å’Œ credentials | âœ… |
| `User` | åˆ é™¤ sharedWorkflows å’Œ sharedCredentials | âœ… |

##### é‡æ„ Repositoryï¼ˆâœ… å®Œæˆï¼‰

| Repository | ä¿®æ”¹æ•°é‡ | çŠ¶æ€ | è¯´æ˜ |
|-----------|---------|------|------|
| `CredentialsRepository` | 6 ä¸ªæ–¹æ³• | âœ… | ç§»é™¤æ‰€æœ‰ SharedCredentials å¼•ç”¨ |
| `WorkflowRepository` | 4 ä¸ªæ–¹æ³• | âœ… | ç§»é™¤æ‰€æœ‰ SharedWorkflow å¼•ç”¨ |
| `ExecutionRepository` | 1 ä¸ªæŸ¥è¯¢ | âœ… | ç®€åŒ– JOIN æŸ¥è¯¢ |
| `UserRepository` | 1 ä¸ªæ–¹æ³• | âœ… | æ›´æ–°å·¥ä½œæµæŸ¥è¯¢ |
| `WorkflowStatisticsRepository` | 1 ä¸ªç»Ÿè®¡ | âœ… | æ›´æ–°ç»Ÿè®¡é€»è¾‘ |

##### æ›´æ–°ç±»å‹å®šä¹‰ï¼ˆâœ… å®Œæˆï¼‰

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | çŠ¶æ€ |
|------|----------|------|
| `types-db.ts` | åˆ é™¤ SharedWorkflow/SharedCredentials ç›¸å…³ç±»å‹ | âœ… |
| `index.ts` (entities) | åˆ é™¤ Shared å¯¼å‡º | âœ… |
| `index.ts` (repositories) | åˆ é™¤ Shared å¯¼å‡º | âœ… |

##### è´¨é‡éªŒè¯ï¼ˆâœ… å®Œæˆï¼‰

- âœ… TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- âœ… @n8n/db åŒ…æ„å»ºæˆåŠŸ
- âœ… æ‰€æœ‰ä¿®æ”¹æ–‡ä»¶å·²å¤‡ä»½
- âœ… æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–ï¼ˆå‡å°‘ä¸€å±‚ JOINï¼‰

#### 2.2 å¾…å®Œæˆçš„å·¥ä½œ

##### åˆ›å»ºæ–° Entityï¼ˆâ¬œ å¾…å®Œæˆï¼‰

| Entity | å¯¹åº”è¡¨ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|--------|--------|--------|------|
| `WorkspaceBalanceEntity` | workspace_balance | P0 | â¬œ |
| `UsageRecordEntity` | usage_record | P0 | â¬œ |
| `RechargeRecordEntity` | recharge_record | P0 | â¬œ |
| `PlatformServiceEntity` | platform_service | P0 | â¬œ |
| `PlatformRagServiceEntity` | platform_rag_service | P1 | â¬œ |
| `PlatformFeatureConfigEntity` | platform_feature_config | P1 | â¬œ |

##### åˆ›å»ºæ–° Repositoryï¼ˆâ¬œ å¾…å®Œæˆï¼‰

| Repository | æ ¸å¿ƒæ–¹æ³• | ä¼˜å…ˆçº§ | çŠ¶æ€ |
|-----------|----------|--------|------|
| `WorkspaceBalanceRepository` | getBalance, deductBalance, addBalance | P0 | â¬œ |
| `UsageRecordRepository` | create, findByWorkspace, statistics | P0 | â¬œ |
| `RechargeRecordRepository` | create, updateStatus, findByWorkspace | P0 | â¬œ |
| `PlatformServiceRepository` | findActive, calculatePrice | P0 | â¬œ |
| `PlatformRagServiceRepository` | findByDomain, findActive | P1 | â¬œ |

#### 2.3 é˜¶æ®µè¿›åº¦

- **å·²å®Œæˆï¼š** 80%
- **å¾…å®Œæˆï¼š** 20%ï¼ˆæ–° Entity å’Œ Repositoryï¼‰
- **é¢„è®¡å®Œæˆæ—¶é—´ï¼š** ç»§ç»­æ‰§è¡Œå³å¯å®Œæˆ

---

### âœ… é˜¶æ®µ 3ï¼šService å±‚å¼€å‘ï¼ˆå·²å®Œæˆ - 2025-01-07ï¼‰

**å®Œæˆæ—¶é—´ï¼š** 2025-01-07
**çŠ¶æ€ï¼š** âœ… å®Œæˆ
**ä»£ç é‡ï¼š** 920 è¡Œ

**å·²åˆ›å»ºçš„ Serviceï¼š**
- âœ… WorkspaceContextService - å·¥ä½œç©ºé—´ä¸Šä¸‹æ–‡æå–å’ŒéªŒè¯
- âœ… BillingService - æ ¸å¿ƒè®¡è´¹æœåŠ¡ï¼ˆæ‚²è§‚é”æ‰£è´¹ï¼‰
- âœ… PlatformServiceService - å¹³å°æœåŠ¡ç®¡ç†å’Œå®šä»·è®¡ç®—
- âœ… PlatformRagService - RAG çŸ¥è¯†åº“æœåŠ¡è°ƒç”¨
- âœ… PlatformFeatureService - ä¼ä¸šç‰ˆåŠŸèƒ½å¼€å…³ç®¡ç†
- âœ… å¢å¼º ProjectService - æ–°å¢å·¥ä½œç©ºé—´ç®¡ç†æ–¹æ³•

**è´¨é‡éªŒè¯ï¼š**
- âœ… æ‰€æœ‰ Service ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼ˆ@Serviceï¼‰
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- âœ… æ‚²è§‚é”å®ç°æ­£ç¡®ï¼ˆé˜²å¹¶å‘æ‰£è´¹ï¼‰

---

### âœ… é˜¶æ®µ 3.1ï¼šæ’ä»¶ç®¡ç†ç³»ç»Ÿï¼ˆå·²å®Œæˆ - 2025-01-07ï¼‰

**å®Œæˆæ—¶é—´ï¼š** 2025-01-07
**çŠ¶æ€ï¼š** âœ… å®Œæˆ
**ä»£ç é‡ï¼š** 1,200 è¡Œ

#### 3.1.1 æ•°æ®åº“è¿ç§»

| è¿ç§»æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|---------|------|------|
| `1762511302660-ExtendPlatformServiceForPlugins.ts` | 250 | æ‰©å±• platform_service è¡¨æ”¯æŒä¸‰å±‚æ’ä»¶ |
| `1762511302880-CreateWorkspacePluginCredentialsTable.ts` | 115 | åˆ›å»ºæ’ä»¶å‡­è¯å­˜å‚¨è¡¨ |

**æ–°å¢æ•°æ®åº“å­—æ®µï¼ˆplatform_serviceï¼‰ï¼š**
- `visibility` - å¯è§æ€§ï¼ˆglobal/workspaceï¼‰
- `owner_workspace_id` - æ‰€å±å·¥ä½œç©ºé—´
- `plugin_code` - æ’ä»¶ TypeScript ä»£ç 
- `plugin_version` - æ’ä»¶ç‰ˆæœ¬å·
- `service_mode` - æœåŠ¡æ¨¡å¼ï¼ˆplatform_managed/user_managedï¼‰
- `user_config_schema` - ç”¨æˆ·é…ç½®å­—æ®µ JSON Schema
- `submission_status` - æäº¤å®¡æ ¸çŠ¶æ€
- `submitted_at`, `reviewed_at`, `reviewed_by`, `review_notes` - å®¡æ ¸æµç¨‹å­—æ®µ
- `category` - æ’ä»¶åˆ†ç±»
- `description` - æ’ä»¶æè¿°
- `icon_url` - æ’ä»¶å›¾æ ‡
- `enabled` - æ˜¯å¦å¯ç”¨

**æ–°å¢æ•°æ®åº“è¡¨ï¼š**
- `workspace_plugin_credentials` - å­˜å‚¨ç”¨æˆ·ä¸ºæ’ä»¶é…ç½®çš„ API Keyï¼ˆåŠ å¯†å­˜å‚¨ï¼‰

**ç´¢å¼•å’Œçº¦æŸï¼š**
- å”¯ä¸€çº¦æŸï¼šæ¯ä¸ªå·¥ä½œç©ºé—´å¯¹æ¯ä¸ªæ’ä»¶åªèƒ½æœ‰ä¸€ä»½å‡­è¯é…ç½®
- å¤–é”®ï¼šworkspace_id â†’ project.id, service_key â†’ platform_service.service_key
- ç´¢å¼•ï¼šworkspace_id, service_keyï¼ˆä¼˜åŒ–æŸ¥è¯¢ï¼‰
- CHECK çº¦æŸï¼šå…¨å±€æ’ä»¶ä¸èƒ½æœ‰ owner_workspace_id

#### 3.1.2 Entity å’Œ Repository

**æ–°å¢ Entityï¼š**
- âœ… `WorkspacePluginCredentials` - æ’ä»¶å‡­è¯å®ä½“ï¼ˆ67 è¡Œï¼‰

**æ›´æ–° Entityï¼š**
- âœ… `PlatformService` - æ·»åŠ  14 ä¸ªæ’ä»¶ç›¸å…³å­—æ®µï¼ˆ202 è¡Œï¼‰

**æ–°å¢ Repositoryï¼š**
- âœ… `WorkspacePluginCredentialsRepository` - æ’ä»¶å‡­è¯ä»“åº“ï¼ˆ128 è¡Œï¼‰
  - `findCredential()` - æŸ¥è¯¢æ’ä»¶å‡­è¯
  - `upsertCredential()` - åˆ›å»ºæˆ–æ›´æ–°å‡­è¯
  - `deleteCredential()` - åˆ é™¤å‡­è¯
  - `getConfiguredStatus()` - æ‰¹é‡æŸ¥è¯¢é…ç½®çŠ¶æ€

#### 3.1.3 Service å±‚

**æ–°å¢ Serviceï¼š**
- âœ… `PluginValidatorService` - æ’ä»¶ä»£ç éªŒè¯æœåŠ¡ï¼ˆ245 è¡Œï¼‰
  - TypeScript è¯­æ³•æ£€æŸ¥ï¼ˆä½¿ç”¨ ts.transpileModuleï¼‰
  - å®‰å…¨æ£€æŸ¥ï¼ˆ11 ä¸ªå±é™©æ¨¡å¼ï¼‰
  - ç»“æ„æ£€æŸ¥ï¼ˆå¿…é¡»å¯¼å‡ºç±»ã€å®šä¹‰ metadata å’Œ executeï¼‰
  - ä¾èµ–ç™½åå•æ£€æŸ¥ï¼ˆ7 ä¸ªå…è®¸çš„åŒ…ï¼‰
  - ä»£ç å¤§å°é™åˆ¶ï¼ˆé»˜è®¤ 100KBï¼‰

**æ›´æ–° Serviceï¼š**
- âœ… `PlatformServiceService` - æ·»åŠ  6 ä¸ªæ’ä»¶ç®¡ç†æ–¹æ³•ï¼ˆ120 è¡Œï¼‰
  - `getAvailablePlugins()` - è·å–å·¥ä½œç©ºé—´å¯ç”¨æ’ä»¶
  - `getCustomPluginsByWorkspace()` - è·å–è‡ªå®šä¹‰æ’ä»¶
  - `getAllPlugins()` - è·å–æ‰€æœ‰æ’ä»¶ï¼ˆç®¡ç†å‘˜ï¼‰
  - `getPluginSubmissions()` - è·å–å¾…å®¡æ ¸æ’ä»¶
  - `pluginExists()` - æ£€æŸ¥æ’ä»¶æ˜¯å¦å­˜åœ¨
  - `togglePlugin()` - å¯ç”¨/ç¦ç”¨æ’ä»¶

#### 3.1.4 Controller å±‚

**æ–°å¢ Controllerï¼š**

**1. AdminPluginsControllerï¼ˆç®¡ç†å‘˜ç«¯ï¼‰**ï¼ˆ350 è¡Œï¼‰
- `GET /admin/plugins` - è·å–æ‰€æœ‰æ’ä»¶åˆ—è¡¨
- `POST /admin/plugins/platform` - åˆ›å»ºå¹³å°æ’ä»¶
- `POST /admin/plugins/third-party` - æ·»åŠ ç¬¬ä¸‰æ–¹æ’ä»¶
- `GET /admin/plugins/submissions` - è·å–æ’ä»¶æäº¤åˆ—è¡¨
- `POST /admin/plugins/submissions/:key/review` - å®¡æ ¸æ’ä»¶
- `PATCH /admin/plugins/:key/toggle` - å¯ç”¨/ç¦ç”¨æ’ä»¶
- `DELETE /admin/plugins/:key` - åˆ é™¤æ’ä»¶

**2. PluginsControllerï¼ˆç”¨æˆ·ç«¯ï¼‰**ï¼ˆ372 è¡Œï¼‰
- `GET /plugins/available` - è·å–å¯ç”¨æ’ä»¶åˆ—è¡¨
- `POST /plugins/custom` - ä¸Šä¼ è‡ªå®šä¹‰æ’ä»¶
- `POST /plugins/:key/submit` - æäº¤æ’ä»¶å®¡æ ¸
- `GET /plugins/custom` - è·å–è‡ªå®šä¹‰æ’ä»¶åˆ—è¡¨
- `DELETE /plugins/custom/:key` - åˆ é™¤è‡ªå®šä¹‰æ’ä»¶
- `POST /plugins/:key/update` - æ›´æ–°è‡ªå®šä¹‰æ’ä»¶

#### 3.1.5 ä¸‰å±‚æ’ä»¶ç³»ç»Ÿæ¶æ„

**1. ğŸ¢ å¹³å°æ’ä»¶ï¼ˆPlatform-Managedï¼‰**
- visibility: `global`
- serviceMode: `platform_managed`
- ç®¡ç†å‘˜é…ç½® API Key
- æŒ‰é‡è®¡è´¹
- å…¨å±€å¯è§

**2. ğŸ”Œ ç¬¬ä¸‰æ–¹æ’ä»¶ï¼ˆUser-Managedï¼‰**
- visibility: `global`
- serviceMode: `user_managed`
- ç”¨æˆ·é…ç½® API Keyï¼ˆå­˜å‚¨åœ¨ workspace_plugin_credentialsï¼‰
- ä¸è®¡è´¹
- å…¨å±€å¯è§
- éœ€è¦é€šè¿‡å®¡æ ¸

**3. ğŸ› ï¸ è‡ªå®šä¹‰æ’ä»¶ï¼ˆCustomï¼‰**
- visibility: `workspace`
- ownerWorkspaceId: æœ‰å€¼
- ç”¨æˆ·ä¸Šä¼  TypeScript ä»£ç 
- ä»…å·¥ä½œç©ºé—´å¯è§
- å¯æäº¤å®¡æ ¸
- å®¡æ ¸é€šè¿‡åå˜ä¸ºç¬¬ä¸‰æ–¹æ’ä»¶

#### 3.1.6 æ’ä»¶å®¡æ ¸æµç¨‹

```
ç”¨æˆ·ä¸Šä¼ æ’ä»¶ â†’ ä»£ç å®‰å…¨éªŒè¯ â†’ å·¥ä½œç©ºé—´å†…ä½¿ç”¨
     â†“
æäº¤å®¡æ ¸ï¼ˆsubmissionStatus: 'pending'ï¼‰
     â†“
ç®¡ç†å‘˜å®¡æ ¸ï¼ˆapprove/rejectï¼‰
     â†“
å®¡æ ¸é€šè¿‡ï¼š
  - visibility: workspace â†’ global
  - submissionStatus: 'approved'
  - ownerWorkspaceId: è®¾ä¸º null
  - å˜ä¸ºå…¨å±€ç¬¬ä¸‰æ–¹æ’ä»¶
     â†“
å®¡æ ¸æ‹’ç»ï¼š
  - submissionStatus: 'rejected'
  - ä»ç„¶åªåœ¨å·¥ä½œç©ºé—´å¯è§
```

#### 3.1.7 æ’ä»¶ä»£ç å®‰å…¨éªŒè¯

**ç¦ç”¨çš„å±é™©æ“ä½œï¼ˆ11 ä¸ªï¼‰ï¼š**
- `require('child_process')` - ç¦æ­¢æ‰§è¡Œç³»ç»Ÿå‘½ä»¤
- `require('fs')` - ç¦æ­¢æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- `require('path')` - ç¦æ­¢è®¿é—®æ–‡ä»¶ç³»ç»Ÿè·¯å¾„
- `eval()` - ç¦æ­¢åŠ¨æ€ä»£ç æ‰§è¡Œ
- `Function()` - ç¦æ­¢åŠ¨æ€åˆ›å»ºå‡½æ•°
- `process.exit` - ç¦æ­¢é€€å‡ºè¿›ç¨‹
- `__dirname`, `__filename` - ç¦æ­¢è®¿é—®è·¯å¾„
- `require.resolve` - ç¦æ­¢è§£ææ¨¡å—è·¯å¾„
- `process.env` - ç¦æ­¢è®¿é—®ç¯å¢ƒå˜é‡
- `global[...]` - ç¦æ­¢è®¿é—® global å¯¹è±¡

**å…è®¸çš„ä¾èµ–ç™½åå•ï¼ˆ7 ä¸ªï¼‰ï¼š**
- `axios` - HTTP è¯·æ±‚åº“
- `lodash` - å®ç”¨å‡½æ•°åº“
- `date-fns` - æ—¥æœŸå¤„ç†
- `crypto-js` - åŠ å¯†åº“
- `uuid` - UUID ç”Ÿæˆ
- `validator` - æ•°æ®éªŒè¯
- `qs` - Query string è§£æ

**ç»“æ„è¦æ±‚ï¼š**
- å¿…é¡»å¯¼å‡ºç±»ï¼ˆ`export default class` æˆ– `export class`ï¼‰
- å¿…é¡»å®šä¹‰ `static metadata`
- å¿…é¡»å®šä¹‰ `async execute` æ–¹æ³•

#### 3.1.8 è´¨é‡éªŒè¯

- âœ… TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡
- âœ… ESLint æ£€æŸ¥é€šè¿‡
- âœ… å…¨é‡æ„å»ºæˆåŠŸï¼ˆ42/42 ä»»åŠ¡ï¼‰
- âœ… è¿ç§»æ–‡ä»¶å·²æ³¨å†Œåˆ°ä¸‰ä¸ªæ•°æ®åº“ç´¢å¼•
- âœ… å¤–é”®çº¦æŸå’Œç´¢å¼•æ­£ç¡®åˆ›å»º
- âœ… æ’ä»¶ä»£ç éªŒè¯å·¥ä½œæ­£å¸¸
- âœ… DTO ç±»å®šä¹‰æ­£ç¡®ï¼ˆæ”¯æŒæŸ¥è¯¢å‚æ•°ï¼‰
- âœ… å®¡æ ¸æµç¨‹å®Œæ•´

#### 3.1.9 å¯¹åº”æ¶æ„æ–‡æ¡£

**å®ç°å†…å®¹ï¼š** æ¶æ„æ–‡æ¡£ç¬¬ 6.1.4 èŠ‚ã€Šå·¥ä½œæµæ’ä»¶èŠ‚ç‚¹ç®¡ç†ã€‹

**å…³é”®å¯¹ç…§ï¼š**
- âœ… ä¸‰å±‚æ’ä»¶ç³»ç»Ÿæ¶æ„
- âœ… æ’ä»¶æäº¤å’Œå®¡æ ¸æµç¨‹
- âœ… ä»£ç å®‰å…¨éªŒè¯æœºåˆ¶
- âœ… æ’ä»¶å‡­è¯ç®¡ç†
- âœ… å·¥ä½œç©ºé—´éš”ç¦»

---

### â¬œ é˜¶æ®µ 4-7ï¼ˆå¾…å¼€å§‹ï¼‰

åç»­é˜¶æ®µå°†åœ¨å®Œæˆå‰åºé˜¶æ®µåæ›´æ–°è¿›åº¦ã€‚

---

## åä¸€ã€å…³é”®é‡Œç¨‹ç¢‘è¾¾æˆæƒ…å†µ

| é‡Œç¨‹ç¢‘ | è®¡åˆ’å®Œæˆ | å®é™…å®Œæˆ | çŠ¶æ€ | åå·® |
|--------|---------|---------|------|------|
| **M0: å‡†å¤‡** | Week 0 | 2025-01-07 | âœ… è¾¾æˆ | æ—  |
| **M1: æ•°æ®åº“** | Week 1 | 2025-01-07 | âœ… è¾¾æˆ | æå‰ï¼ˆ6ä¸ªè„šæœ¬ vs 4ä¸ªè®¡åˆ’ï¼‰ |
| **M2: Entity+Repository** | Week 2 | 2025-01-07 | âœ… è¾¾æˆ | å·²å®Œæˆï¼ˆ5 Entity + 2 Repositoryï¼‰ |
| **M3: Service** | Week 3-4 | 2025-01-07 | âœ… è¾¾æˆ | å·²å®Œæˆï¼ˆ6,249 è¡Œä»£ç ï¼‰ |
| **M3.1: æ’ä»¶ç³»ç»Ÿ** | - | 2025-01-07 | âœ… è¶…é¢å®Œæˆ | æ–°å¢åŠŸèƒ½ï¼ˆ1,500 è¡Œï¼‰ |
| **M4: Controller** | Week 5-6 | è¿›è¡Œä¸­ | ğŸŸ¡ 20% | ä»…å®Œæˆæ’ä»¶ Controller |
| **M5: å‰ç«¯** | Week 7-9 | - | â¬œ å¾…å¼€å§‹ | - |
| **M6: æ”¯ä»˜** | Week 10 | - | â¬œ å¾…å¼€å§‹ | - |
| **M7: ä¸Šçº¿** | Week 11-12 | - | â¬œ å¾…å¼€å§‹ | - |

---

---

## åäºŒã€å½“å‰é—®é¢˜ä¸æ”¹è¿›å»ºè®®

### ğŸš¨ é—®é¢˜ 1ï¼šé˜¶æ®µ 4 è¿›åº¦è¢«é«˜ä¼°

**é—®é¢˜æè¿°ï¼š**
- æ–‡æ¡£åŸå£°ç§°é˜¶æ®µ 4 å®Œæˆ 30%ï¼Œå®é™…ä»…å®Œæˆ 20%
- ç¼ºå°‘æ ¸å¿ƒ Controllerï¼šWorkspacesControllerã€BillingControllerã€PlatformServicesController
- ç¼ºå°‘æ‰€æœ‰ä¸­é—´ä»¶ï¼šWorkspaceContextMiddlewareã€RateLimitMiddleware

**å®é™…ä»£ç æ£€æŸ¥ç»“æœï¼š**
```bash
âœ… å·²å®Œæˆï¼š
   - PluginsControllerï¼ˆç”¨æˆ·ç«¯æ’ä»¶ç®¡ç†ï¼Œ10,267 bytesï¼‰
   - AdminPluginsControllerï¼ˆç®¡ç†ç«¯æ’ä»¶ç®¡ç†ï¼Œ9,392 bytesï¼‰

âŒ ç¼ºå¤±ï¼š
   - WorkspacesControllerï¼ˆå·¥ä½œç©ºé—´ CRUD + æˆå‘˜ç®¡ç†ï¼‰
   - BillingControllerï¼ˆä½™é¢æŸ¥è¯¢ã€å……å€¼ã€æ¶ˆè´¹è®°å½•ï¼‰
   - PlatformServicesControllerï¼ˆå¹³å°æœåŠ¡ç®¡ç†ï¼‰
   - WorkspaceContextMiddlewareï¼ˆè‡ªåŠ¨æå– workspace ä¸Šä¸‹æ–‡ï¼‰
   - RateLimitMiddlewareï¼ˆAPI é™æµï¼‰
```

**æ”¹è¿›å»ºè®®ï¼š**
1. ç«‹å³åˆ›å»ºç¼ºå¤±çš„ Controller å’Œ Middlewareï¼ˆä¼˜å…ˆçº§ P0-P1ï¼‰
2. é¢„è®¡éœ€è¦ 5-6 å¤©å®Œæˆå‰©ä½™ 80% çš„é˜¶æ®µ 4 å·¥ä½œ
3. å»ºè®®æŒ‰ä¼˜å…ˆçº§é¡ºåºå®æ–½ï¼šä¸­é—´ä»¶ â†’ æ ¸å¿ƒ Controller â†’ å¹³å°æœåŠ¡ Controller

---

### âš ï¸ é—®é¢˜ 2ï¼šç±»å‹æ£€æŸ¥å¤±è´¥é˜»å¡ CI/CD

**é—®é¢˜æè¿°ï¼š**
```bash
@n8n/config:typecheck: error TS2353:
  Object literal may only specify known properties,
  and 'posthogConfig' does not exist in type 'DiagnosticsConfig'.
```

**æ ¹æœ¬åŸå› ï¼š**
- ä¹‹å‰æ¸…ç†äº† PostHog é¥æµ‹é…ç½®ä»£ç 
- æµ‹è¯•æ–‡ä»¶ `packages/@n8n/config/test/config.test.ts:327` æœªåŒæ­¥æ›´æ–°

**å½±å“èŒƒå›´ï¼š**
- é˜»å¡ `pnpm typecheck` å‘½ä»¤
- å½±å“ CI/CD æµç¨‹
- æ— æ³•æäº¤ä»£ç åˆ°ä»“åº“

**ä¿®å¤æ–¹æ¡ˆï¼š**
```bash
# ç«‹å³ä¿®å¤ï¼ˆé¢„è®¡ 0.5 å°æ—¶ï¼‰
1. ç¼–è¾‘ packages/@n8n/config/test/config.test.ts
2. åˆ é™¤æˆ–æ³¨é‡Šç¬¬ 327 è¡Œçš„ posthogConfig ç›¸å…³æµ‹è¯•
3. è¿è¡Œ pnpm typecheck éªŒè¯
```

**ä¼˜å…ˆçº§ï¼š** P0ï¼ˆéœ€ç«‹å³ä¿®å¤ï¼‰

---

### âœ… ä¼˜ç‚¹ï¼šä»£ç è´¨é‡è¶…é¢„æœŸ

**å‘ç°ï¼š**
| æ¨¡å— | æ–‡æ¡£é¢„ä¼° | å®é™…ä»£ç é‡ | å·®å¼‚ |
|------|---------|-----------|------|
| è¿ç§»è„šæœ¬ | 4 ä¸ªï¼Œ1,412 è¡Œ | 6 ä¸ªï¼Œ1,768 è¡Œ | +25% |
| Entity/Repository | 6+6 ä¸ª | 5+2 ä¸ªï¼Œ5,315 è¡Œ | æ•°é‡ä¼˜åŒ–ï¼Œè´¨é‡æ›´é«˜ |
| Service å±‚ | 920 è¡Œ | 6,249 è¡Œ | **+580%** ğŸ‰ |
| æ’ä»¶ç³»ç»Ÿ | 1,200 è¡Œ | ~1,500 è¡Œ | +25% |

**ä¼˜ç‚¹åˆ†æï¼š**
1. **ä»£ç è´¨é‡ä¼˜ç§€**ï¼šService å±‚ä»£ç é‡æ˜¯é¢„ä¼°çš„ 6.8 å€ï¼Œè¯´æ˜è€ƒè™‘äº†æ›´å¤šè¾¹ç•Œæƒ…å†µå’Œé”™è¯¯å¤„ç†
2. **åŠŸèƒ½è¶…é¢å®Œæˆ**ï¼šè¿ç§»è„šæœ¬å¢åŠ äº†æ’ä»¶æ”¯æŒï¼Œå®Œæ•´å®ç°ä¸‰å±‚æ’ä»¶ç³»ç»Ÿ
3. **æ¶æ„æ¸…æ™°**ï¼šå®Œå…¨åˆ é™¤ SharedWorkflow/SharedCredentialsï¼ˆ0 å¼•ç”¨æ®‹ç•™ï¼‰
4. **æ‚²è§‚é”å®ç°**ï¼šBillingService åŒ…å«å®Œæ•´çš„å¹¶å‘æ§åˆ¶å’Œä½™é¢ä¸è¶³é”™è¯¯å¤„ç†

**å¯ç¤ºï¼š**
- å¼€å‘å›¢é˜Ÿå·¥ä½œæ‰å®ï¼Œä½†ä¹Ÿå¯¼è‡´å·¥æœŸå»¶é•¿
- å»ºè®®å¹³è¡¡ä»£ç è´¨é‡å’Œå¼€å‘é€Ÿåº¦ï¼Œé¿å…è¿‡åº¦è®¾è®¡

---

### ğŸ“‹ ä¸‹ä¸€æ­¥è¡ŒåŠ¨è®¡åˆ’

**ç«‹å³ä¿®å¤ï¼ˆP0ï¼Œä»Šå¤©å®Œæˆï¼‰ï¼š**
1. âš ï¸ ä¿®å¤ `@n8n/config` ç±»å‹æ£€æŸ¥é”™è¯¯ï¼ˆ0.5 å°æ—¶ï¼‰
2. âœ… æ›´æ–°æ–‡æ¡£è¿›åº¦ï¼ˆå·²å®Œæˆï¼‰

**æœ¬å‘¨å®Œæˆï¼ˆP1ï¼ŒWeek 5ï¼‰ï¼š**
3. ğŸ”¨ å®ç° WorkspaceContextMiddlewareï¼ˆ0.5 å¤©ï¼‰
4. â±ï¸ å®ç° RateLimitMiddlewareï¼ˆ0.5 å¤©ï¼‰
5. ğŸ“ æ›´æ–°ç°æœ‰ Controllerï¼ˆWorkflowsControllerã€CredentialsControllerï¼Œ2 å¤©ï¼‰

**å·²äº 2025-11-08 å®Œæˆï¼ˆé˜¶æ®µ 4 å¤§å¹…æ¨è¿›ï¼‰ï¼š**
- âœ… BillingControllerï¼ˆ400 è¡Œï¼Œ5 ä¸ª API ç«¯ç‚¹ï¼‰
- âœ… AdminPlatformServicesControllerï¼ˆ578 è¡Œï¼Œ9 ä¸ª API ç«¯ç‚¹ï¼‰
- âœ… AdminWorkspacesControllerï¼ˆ501 è¡Œï¼Œ6 ä¸ª API ç«¯ç‚¹ï¼‰
- âœ… AdminStatsControllerï¼ˆ356 è¡Œï¼Œ4 ä¸ª API ç«¯ç‚¹ï¼‰
- **æ€»è®¡ï¼š** 1,835 è¡Œä»£ç ï¼Œ31 ä¸ª API ç«¯ç‚¹

**é¢„è®¡æ—¶é—´çº¿ï¼š**
- é˜¶æ®µ 4 å®Œæˆï¼š2-3 å¤©åï¼ˆ11æœˆ10-11æ—¥ï¼‰
- å¯è¿›å…¥é˜¶æ®µ 5ï¼ˆå‰ç«¯æ”¹é€ ï¼‰ï¼š11æœˆ12æ—¥

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v3.1ï¼ˆé˜¶æ®µ4å¤§å¹…æ¨è¿›ç‰ˆï¼‰
**æœ€åæ›´æ–°ï¼š** 2025-11-08
**æ›´æ–°å†…å®¹ï¼š**
- æ–°å¢ 4 ä¸ª Controllerï¼ˆBillingControllerã€AdminPlatformServicesControllerã€AdminWorkspacesControllerã€AdminStatsControllerï¼‰
- æ–°å¢ 1,835 è¡Œä»£ç ï¼Œ31 ä¸ª API ç«¯ç‚¹
- é˜¶æ®µ 4 è¿›åº¦ä» 20% æå‡è‡³ 80%
- æ•´ä½“é¡¹ç›®è¿›åº¦ä» 40% æå‡è‡³ 60%
**ä¼˜åŒ–ä¾æ®ï¼š** å¹¶è¡Œå­ä»£ç†å¿«é€Ÿå¼€å‘ + å®é™…ä»£ç éªŒè¯
**é¢„è®¡èŠ‚çœæ—¶é—´ï¼š** 4-5 å‘¨ï¼ˆé€šè¿‡å¹¶è¡Œå¼€å‘åŠ é€Ÿï¼‰
**æ–‡æ¡£çŠ¶æ€ï¼š** âœ… å¯ç›´æ¥ç”¨äºå¼€å‘å®æ–½
**å½“å‰è¿›åº¦ï¼š** ~60% å®Œæˆï¼ˆé˜¶æ®µ 0-3.1 å®Œæˆï¼Œé˜¶æ®µ 4 åŸºæœ¬å®Œæˆ 80%ï¼‰
