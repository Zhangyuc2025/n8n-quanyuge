# n8n èŠ‚ç‚¹ç§»åŠ¨å’Œä¸­æ–‡åŒ–æ”¹é€ æ–¹æ¡ˆ

> **æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
> **åˆ›å»ºæ—¥æœŸï¼š** 2025-11-09
> **ç›®æ ‡ï¼š** ç§»åŠ¨éœ€è¦å‡­è¯çš„èŠ‚ç‚¹åˆ°å¤‡ä»½ï¼Œä¿ç•™æ ¸å¿ƒèŠ‚ç‚¹å¹¶è¿›è¡Œä¸­æ–‡åŒ–æ”¹é€ 
> **é¢„è®¡å·¥æœŸï¼š** çº¦ 3-4 å‘¨

---

## ğŸ“‹ ç›®å½•

1. [æ”¹é€ ç›®æ ‡](#æ”¹é€ ç›®æ ‡)
2. [é˜¶æ®µåˆ’åˆ†](#é˜¶æ®µåˆ’åˆ†)
3. [é˜¶æ®µ 1ï¼šèŠ‚ç‚¹å¤‡ä»½ç§»åŠ¨](#é˜¶æ®µ-1èŠ‚ç‚¹å¤‡ä»½ç§»åŠ¨)
4. [é˜¶æ®µ 2ï¼šæ ¸å¿ƒèŠ‚ç‚¹ä¸­æ–‡åŒ–](#é˜¶æ®µ-2æ ¸å¿ƒèŠ‚ç‚¹ä¸­æ–‡åŒ–)
5. [é˜¶æ®µ 3ï¼šåå°ç®¡ç†ç³»ç»Ÿ - èŠ‚ç‚¹ç®¡ç†](#é˜¶æ®µ-3åå°ç®¡ç†ç³»ç»Ÿ---èŠ‚ç‚¹ç®¡ç†)
6. [é˜¶æ®µ 4ï¼šç”¨æˆ·ç«¯ - èŠ‚ç‚¹ä¸­å¿ƒ](#é˜¶æ®µ-4ç”¨æˆ·ç«¯---èŠ‚ç‚¹ä¸­å¿ƒ)
7. [æŠ€æœ¯å®ç°ç»†èŠ‚](#æŠ€æœ¯å®ç°ç»†èŠ‚)
8. [éªŒæ”¶æ ‡å‡†](#éªŒæ”¶æ ‡å‡†)

---

## ğŸ¯ æ”¹é€ ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡
1. **ç§»åŠ¨éœ€è¦å‡­è¯çš„èŠ‚ç‚¹**ï¼šå°† 388 ä¸ªéœ€è¦å‡­è¯çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°å¤‡ä»½æ–‡ä»¶å¤¹
2. **ä¿ç•™æ ¸å¿ƒæ— å‡­è¯èŠ‚ç‚¹**ï¼šçº¦ 142 ä¸ªä¸éœ€è¦å‡­è¯çš„èŠ‚ç‚¹ä¿ç•™åœ¨é¡¹ç›®ä¸­
3. **æ ¸å¿ƒèŠ‚ç‚¹ä¸­æ–‡åŒ–**ï¼šå°†ä¿ç•™çš„èŠ‚ç‚¹æ”¹é€ ä¸ºçº¯ä¸­æ–‡äº¤äº’ç•Œé¢
4. **åå°èŠ‚ç‚¹ç®¡ç†**ï¼šç®¡ç†å‘˜å¯ä»¥ä¸Šä¼ ã€å®¡æ ¸ã€ç®¡ç†èŠ‚ç‚¹
5. **ç”¨æˆ·èŠ‚ç‚¹ä¸­å¿ƒ**ï¼šç”¨æˆ·å¯ä»¥æµè§ˆã€å®‰è£…ã€é…ç½®èŠ‚ç‚¹

### æ”¹é€ åŸåˆ™
- âœ… åŸºäºå‡­è¯æ–‡ä»¶ç²¾ç¡®è¯†åˆ«éœ€è¦ç§»åŠ¨çš„èŠ‚ç‚¹
- âœ… ä¿ç•™å®Œæ•´çš„ç›®å½•ç»“æ„ï¼ˆä¾¿äºåç»­æ”¹é€ ï¼‰
- âœ… ä¸­æ–‡åŒ–é‡‡ç”¨ i18n æœºåˆ¶ï¼Œä¸ç ´ååŸæœ‰æ¶æ„
- âœ… èŠ‚ç‚¹ç®¡ç†åŸºäºç°æœ‰çš„ `custom_node` è¡¨
- âœ… ç”¨æˆ·èŠ‚ç‚¹é…ç½®åŸºäº `user_node_config` è¡¨

---

## ğŸ“… é˜¶æ®µåˆ’åˆ†

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡å·¥æ—¶ | è¾“å‡ºç‰© |
|------|------|---------|--------|
| **é˜¶æ®µ 1** | èŠ‚ç‚¹å¤‡ä»½ç§»åŠ¨ | 0.5 å¤© | å¤‡ä»½ç›®å½• + ç§»åŠ¨æŠ¥å‘Š |
| **é˜¶æ®µ 2** | æ ¸å¿ƒèŠ‚ç‚¹ä¸­æ–‡åŒ– | 1-2 å‘¨ | ä¸­æ–‡åŒ–çš„èŠ‚ç‚¹ + i18n æ–‡ä»¶ |
| **é˜¶æ®µ 3** | åå°èŠ‚ç‚¹ç®¡ç† | 1 å‘¨ | ç®¡ç†å‘˜èŠ‚ç‚¹ç®¡ç†ç•Œé¢ |
| **é˜¶æ®µ 4** | ç”¨æˆ·èŠ‚ç‚¹ä¸­å¿ƒ | 1 å‘¨ | ç”¨æˆ·èŠ‚ç‚¹ä¸­å¿ƒç•Œé¢ |
| **æ€»è®¡** | - | 3-4 å‘¨ | å®Œæ•´çš„èŠ‚ç‚¹ç®¡ç†ç³»ç»Ÿ |

---

## ğŸ”„ é˜¶æ®µ 1ï¼šèŠ‚ç‚¹å¤‡ä»½ç§»åŠ¨

### 1.1 ç§»åŠ¨ç­–ç•¥

**è¯†åˆ«é€»è¾‘ï¼š**
```bash
# 1. åˆ—å‡ºæ‰€æœ‰å‡­è¯æ–‡ä»¶ï¼ˆ388 ä¸ªï¼‰
find packages/nodes-base/credentials -name "*.credentials.ts"

# 2. æå–å‡­è¯åç§°ï¼ŒåŒ¹é…å¯¹åº”çš„èŠ‚ç‚¹ç›®å½•
# ä¾‹å¦‚ï¼šGitHubApi.credentials.ts â†’ å¯¹åº” GitHub èŠ‚ç‚¹ç›®å½•

# 3. ç§»åŠ¨èŠ‚ç‚¹ç›®å½•å’Œå‡­è¯æ–‡ä»¶åˆ°å¤‡ä»½ä½ç½®
```

**å¤‡ä»½ç›®å½•ç»“æ„ï¼š**
```
packages/nodes-base-backup/
â”œâ”€â”€ nodes/              # 388 ä¸ªéœ€è¦å‡­è¯çš„èŠ‚ç‚¹
â”‚   â”œâ”€â”€ GitHub/
â”‚   â”œâ”€â”€ Slack/
â”‚   â”œâ”€â”€ Notion/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ credentials/        # å¯¹åº”çš„ 388 ä¸ªå‡­è¯æ–‡ä»¶
â”‚   â”œâ”€â”€ GitHubApi.credentials.ts
â”‚   â”œâ”€â”€ SlackApi.credentials.ts
â”‚   â””â”€â”€ ...
â””â”€â”€ BACKUP_REPORT.md    # ç§»åŠ¨æŠ¥å‘Š
```

### 1.2 ä¿ç•™çš„æ ¸å¿ƒèŠ‚ç‚¹ï¼ˆçº¦ 142 ä¸ªï¼‰

**åˆ†ç±»ç»Ÿè®¡ï¼š**

| ç±»åˆ« | æ•°é‡ | ç¤ºä¾‹èŠ‚ç‚¹ |
|------|------|---------|
| **æ•°æ®å¤„ç†** | ~30 | Code, Function, Set, Aggregate, Filter |
| **æµç¨‹æ§åˆ¶** | ~15 | If, Switch, Merge, Wait, Loop |
| **æ•°æ®è½¬æ¢** | ~20 | DateTime, Crypto, Html, Xml, Json |
| **æ–‡ä»¶æ“ä½œ** | ~10 | ReadBinaryFile, WriteBinaryFile, SpreadsheetFile |
| **å·¥ä½œæµæ§åˆ¶** | ~5 | Start, ExecuteWorkflow, StickyNote, NoOp |
| **é€šç”¨å·¥å…·** | ~10 | Webhook, HttpRequest, Email, Markdown |
| **å…¶ä»–å†…ç½®** | ~52 | å„ç§ä¸éœ€è¦å¤–éƒ¨ API çš„å·¥å…·èŠ‚ç‚¹ |

**å…³é”®ä¿ç•™èŠ‚ç‚¹ï¼š**
- `HttpRequest` - é€šç”¨ HTTP è¯·æ±‚ï¼ˆå¯æ›¿ä»£å¾ˆå¤š API èŠ‚ç‚¹ï¼‰
- `Code` - JavaScript ä»£ç æ‰§è¡Œ
- `Function` / `FunctionItem` - å‡½æ•°èŠ‚ç‚¹
- `Set` - å­—æ®µè®¾ç½®
- `If` / `Switch` - æ¡ä»¶åˆ†æ”¯
- `Merge` - æ•°æ®åˆå¹¶
- `Filter` - æ•°æ®è¿‡æ»¤
- `Aggregate` - æ•°æ®èšåˆ
- `DateTime` - æ—¥æœŸæ—¶é—´å¤„ç†
- `Crypto` - åŠ å¯†è§£å¯†
- `Webhook` - Webhook æ¥æ”¶
- `ExecuteWorkflow` - å·¥ä½œæµè°ƒç”¨

### 1.3 ç§»åŠ¨è„šæœ¬å®ç°

**æ ¸å¿ƒè„šæœ¬ï¼š** `scripts/backup-credential-nodes.sh`

```bash
#!/bin/bash

# ç§»åŠ¨éœ€è¦å‡­è¯çš„èŠ‚ç‚¹åˆ°å¤‡ä»½ç›®å½•
# ç”¨æ³•: bash scripts/backup-credential-nodes.sh

set -e

BACKUP_DIR="packages/nodes-base-backup"
NODES_DIR="packages/nodes-base/nodes"
CREDS_DIR="packages/nodes-base/credentials"

echo "=== n8n èŠ‚ç‚¹å¤‡ä»½å·¥å…· ==="
echo ""
echo "ğŸ“Š ç»Ÿè®¡ä¿¡æ¯ï¼š"
echo "  å‡­è¯æ–‡ä»¶æ€»æ•°: $(find $CREDS_DIR -name "*.credentials.ts" 2>/dev/null | wc -l)"
echo "  èŠ‚ç‚¹ç›®å½•æ€»æ•°: $(find $NODES_DIR -maxdepth 1 -type d 2>/dev/null | wc -l)"
echo ""

# 1. åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p "$BACKUP_DIR/nodes"
mkdir -p "$BACKUP_DIR/credentials"

# 2. åˆå§‹åŒ–ç»Ÿè®¡
moved_nodes=0
moved_creds=0
not_found_nodes=0

# 3. éå†æ‰€æœ‰å‡­è¯æ–‡ä»¶
echo "ğŸ”„ å¼€å§‹ç§»åŠ¨èŠ‚ç‚¹..."
echo "" > "$BACKUP_DIR/BACKUP_REPORT.md"
echo "# èŠ‚ç‚¹å¤‡ä»½æŠ¥å‘Š" >> "$BACKUP_DIR/BACKUP_REPORT.md"
echo "" >> "$BACKUP_DIR/BACKUP_REPORT.md"
echo "**ç”Ÿæˆæ—¶é—´ï¼š** $(date '+%Y-%m-%d %H:%M:%S')" >> "$BACKUP_DIR/BACKUP_REPORT.md"
echo "" >> "$BACKUP_DIR/BACKUP_REPORT.md"
echo "## ç§»åŠ¨ç»Ÿè®¡" >> "$BACKUP_DIR/BACKUP_REPORT.md"
echo "" >> "$BACKUP_DIR/BACKUP_REPORT.md"

for cred_file in $(find $CREDS_DIR -name "*.credentials.ts"); do
  # æå–å‡­è¯åç§°ï¼ˆå»æ‰è·¯å¾„å’Œåç¼€ï¼‰
  cred_name=$(basename "$cred_file" .credentials.ts)

  # å°è¯•æŸ¥æ‰¾å¯¹åº”çš„èŠ‚ç‚¹ç›®å½•ï¼ˆå¸¸è§åŒ¹é…æ¨¡å¼ï¼‰
  # ä¾‹å¦‚ï¼šGitHubApi â†’ GitHub, SlackApi â†’ Slack
  node_name=${cred_name//Api/}
  node_name=${cred_name//OAuth2Api/}

  # æŸ¥æ‰¾èŠ‚ç‚¹ç›®å½•
  node_dir=$(find $NODES_DIR -maxdepth 1 -type d -iname "$node_name" 2>/dev/null | head -1)

  if [ -z "$node_dir" ]; then
    # å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°è¯•æ¨¡ç³ŠåŒ¹é…
    node_dir=$(find $NODES_DIR -maxdepth 1 -type d -iname "*${node_name}*" 2>/dev/null | head -1)
  fi

  # ç§»åŠ¨å‡­è¯æ–‡ä»¶
  echo "  ç§»åŠ¨å‡­è¯: $cred_name"
  mv "$cred_file" "$BACKUP_DIR/credentials/"
  moved_creds=$((moved_creds + 1))

  # ç§»åŠ¨èŠ‚ç‚¹ç›®å½•ï¼ˆå¦‚æœæ‰¾åˆ°ï¼‰
  if [ -n "$node_dir" ]; then
    node_basename=$(basename "$node_dir")
    echo "    â†’ ç§»åŠ¨èŠ‚ç‚¹: $node_basename"
    mv "$node_dir" "$BACKUP_DIR/nodes/"
    moved_nodes=$((moved_nodes + 1))
    echo "- âœ… $cred_name â†’ $node_basename" >> "$BACKUP_DIR/BACKUP_REPORT.md"
  else
    echo "    âš ï¸  æœªæ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹ç›®å½•"
    not_found_nodes=$((not_found_nodes + 1))
    echo "- âš ï¸ $cred_name â†’ (èŠ‚ç‚¹æœªæ‰¾åˆ°)" >> "$BACKUP_DIR/BACKUP_REPORT.md"
  fi
done

# 4. è¾“å‡ºç»Ÿè®¡
echo ""
echo "âœ… ç§»åŠ¨å®Œæˆï¼"
echo ""
echo "ğŸ“Š æœ€ç»ˆç»Ÿè®¡ï¼š"
echo "  ç§»åŠ¨çš„å‡­è¯æ–‡ä»¶: $moved_creds"
echo "  ç§»åŠ¨çš„èŠ‚ç‚¹ç›®å½•: $moved_nodes"
echo "  æœªæ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹: $not_found_nodes"
echo "  ä¿ç•™çš„èŠ‚ç‚¹: $(find $NODES_DIR -maxdepth 1 -type d 2>/dev/null | wc -l)"
echo ""
echo "ğŸ“„ è¯¦ç»†æŠ¥å‘Š: $BACKUP_DIR/BACKUP_REPORT.md"

# 5. å†™å…¥ç»Ÿè®¡åˆ°æŠ¥å‘Š
cat >> "$BACKUP_DIR/BACKUP_REPORT.md" << EOF

## ç»Ÿè®¡æ±‡æ€»

| é¡¹ç›® | æ•°é‡ |
|------|------|
| ç§»åŠ¨çš„å‡­è¯æ–‡ä»¶ | $moved_creds |
| ç§»åŠ¨çš„èŠ‚ç‚¹ç›®å½• | $moved_nodes |
| æœªæ‰¾åˆ°å¯¹åº”èŠ‚ç‚¹ | $not_found_nodes |
| ä¿ç•™çš„èŠ‚ç‚¹ | $(find $NODES_DIR -maxdepth 1 -type d 2>/dev/null | wc -l) |

## ä¿ç•™çš„æ ¸å¿ƒèŠ‚ç‚¹

$(find $NODES_DIR -maxdepth 1 -type d -not -path $NODES_DIR | while read dir; do
  echo "- $(basename $dir)"
done)
EOF
```

### 1.4 æ‰§è¡Œæ­¥éª¤

```bash
# 1. åˆ›å»ºè„šæœ¬
vim scripts/backup-credential-nodes.sh
chmod +x scripts/backup-credential-nodes.sh

# 2. æ‰§è¡Œå¤‡ä»½ï¼ˆå»ºè®®å…ˆåœ¨ git åˆ†æ”¯ä¸­æµ‹è¯•ï¼‰
git checkout -b backup-credential-nodes
bash scripts/backup-credential-nodes.sh

# 3. æŸ¥çœ‹æŠ¥å‘Š
cat packages/nodes-base-backup/BACKUP_REPORT.md

# 4. éªŒè¯ä¿ç•™çš„èŠ‚ç‚¹
ls packages/nodes-base/nodes/

# 5. æäº¤
git add .
git commit -m "chore: å¤‡ä»½éœ€è¦å‡­è¯çš„èŠ‚ç‚¹åˆ° packages/nodes-base-backup"
```

### 1.5 éªŒæ”¶æ ‡å‡†

- [ ] å¤‡ä»½ç›®å½•åˆ›å»ºæˆåŠŸ
- [ ] 388 ä¸ªå‡­è¯æ–‡ä»¶å…¨éƒ¨ç§»åŠ¨åˆ° `packages/nodes-base-backup/credentials/`
- [ ] å¯¹åº”çš„èŠ‚ç‚¹ç›®å½•ç§»åŠ¨åˆ° `packages/nodes-base-backup/nodes/`
- [ ] ä¿ç•™çš„èŠ‚ç‚¹çº¦ 142 ä¸ª
- [ ] ç§»åŠ¨æŠ¥å‘Šç”Ÿæˆå®Œæ•´
- [ ] é¡¹ç›®å¯ä»¥æ­£å¸¸æ„å»ºï¼ˆ`pnpm build`ï¼‰

---

## ğŸŒ é˜¶æ®µ 2ï¼šæ ¸å¿ƒèŠ‚ç‚¹ä¸­æ–‡åŒ–

### 2.1 ä¸­æ–‡åŒ–èŒƒå›´

**éœ€è¦ä¸­æ–‡åŒ–çš„å…ƒç´ ï¼š**
1. **èŠ‚ç‚¹åç§°** - displayName
2. **èŠ‚ç‚¹æè¿°** - description
3. **å‚æ•°æ ‡ç­¾** - properties[].displayName
4. **å‚æ•°æè¿°** - properties[].description
5. **é€‰é¡¹å€¼** - options[].name
6. **æç¤ºæ–‡æœ¬** - placeholder, hint
7. **é”™è¯¯ä¿¡æ¯** - æ‰§è¡Œæ—¶çš„é”™è¯¯æç¤º

**ä¸­æ–‡åŒ–æ–¹å¼ï¼š**
- âœ… ä½¿ç”¨ n8n çš„ i18n æœºåˆ¶
- âœ… ç¿»è¯‘æ–‡ä»¶æ”¾åœ¨ `packages/@n8n/i18n/src/locales/zh-CN/nodes.json`
- âŒ ä¸ç›´æ¥ä¿®æ”¹èŠ‚ç‚¹æºç 

### 2.2 i18n é…ç½®ç»“æ„

**ç¤ºä¾‹ï¼šSet èŠ‚ç‚¹çš„ä¸­æ–‡ç¿»è¯‘**

```json
// packages/@n8n/i18n/src/locales/zh-CN/nodes.json
{
  "n8n-nodes-base.set": {
    "displayName": "è®¾ç½®å­—æ®µ",
    "description": "åœ¨è¾“å…¥é¡¹ä¸Šæ·»åŠ æˆ–ç¼–è¾‘å­—æ®µï¼Œå¯é€‰æ‹©æ€§ç§»é™¤å…¶ä»–å­—æ®µ",
    "properties": {
      "mode": {
        "displayName": "æ¨¡å¼",
        "description": "é€‰æ‹©å¦‚ä½•è®¾ç½®å€¼",
        "options": {
          "manual": "æ‰‹åŠ¨æ˜ å°„",
          "json": "ä½¿ç”¨ JSON"
        }
      },
      "assignments": {
        "displayName": "å­—æ®µèµ‹å€¼",
        "description": "è¦è®¾ç½®çš„å­—æ®µåˆ—è¡¨"
      },
      "assignment": {
        "name": {
          "displayName": "å­—æ®µå",
          "description": "è¦è®¾ç½®çš„å­—æ®µåç§°"
        },
        "value": {
          "displayName": "å­—æ®µå€¼",
          "description": "è¦è®¾ç½®çš„å­—æ®µå€¼"
        },
        "type": {
          "displayName": "å­—æ®µç±»å‹",
          "options": {
            "string": "æ–‡æœ¬",
            "number": "æ•°å­—",
            "boolean": "å¸ƒå°”å€¼",
            "array": "æ•°ç»„",
            "object": "å¯¹è±¡"
          }
        }
      },
      "includeOtherFields": {
        "displayName": "ä¿ç•™å…¶ä»–å­—æ®µ",
        "description": "æ˜¯å¦ä¿ç•™æœªåœ¨èµ‹å€¼åˆ—è¡¨ä¸­çš„å­—æ®µ"
      }
    }
  }
}
```

### 2.3 æ ¸å¿ƒèŠ‚ç‚¹ä¸­æ–‡åŒ–æ¸…å•

**ä¼˜å…ˆçº§ P0ï¼ˆæ ¸å¿ƒæµç¨‹æ§åˆ¶ï¼‰ï¼š**
- [ ] Set - è®¾ç½®å­—æ®µ
- [ ] If - æ¡ä»¶åˆ¤æ–­
- [ ] Switch - å¤šè·¯åˆ†æ”¯
- [ ] Merge - æ•°æ®åˆå¹¶
- [ ] Filter - æ•°æ®è¿‡æ»¤
- [ ] Code - ä»£ç æ‰§è¡Œ
- [ ] Function - å‡½æ•°èŠ‚ç‚¹

**ä¼˜å…ˆçº§ P1ï¼ˆæ•°æ®å¤„ç†ï¼‰ï¼š**
- [ ] Aggregate - æ•°æ®èšåˆ
- [ ] DateTime - æ—¥æœŸæ—¶é—´
- [ ] Crypto - åŠ å¯†è§£å¯†
- [ ] Html - HTML å¤„ç†
- [ ] Json - JSON å¤„ç†
- [ ] Xml - XML å¤„ç†
- [ ] SpreadsheetFile - ç”µå­è¡¨æ ¼

**ä¼˜å…ˆçº§ P2ï¼ˆé€šç”¨å·¥å…·ï¼‰ï¼š**
- [ ] HttpRequest - HTTP è¯·æ±‚
- [ ] Webhook - Webhook æ¥æ”¶
- [ ] ExecuteWorkflow - æ‰§è¡Œå·¥ä½œæµ
- [ ] Wait - ç­‰å¾…
- [ ] Start - å¼€å§‹èŠ‚ç‚¹
- [ ] NoOp - æ— æ“ä½œ

### 2.4 ä¸­æ–‡åŒ–å®æ–½æ–¹æ³•

**æ–¹æ³• 1ï¼šæ‰‹å·¥ç¿»è¯‘ï¼ˆæ¨èç”¨äºæ ¸å¿ƒèŠ‚ç‚¹ï¼‰**

```bash
# 1. è¯»å–èŠ‚ç‚¹å®šä¹‰
cat packages/nodes-base/nodes/Set/v2/SetV2.node.ts

# 2. æå–æ‰€æœ‰éœ€è¦ç¿»è¯‘çš„æ–‡æœ¬
# 3. åœ¨ i18n æ–‡ä»¶ä¸­æ·»åŠ ç¿»è¯‘
vim packages/@n8n/i18n/src/locales/zh-CN/nodes.json

# 4. æµ‹è¯•éªŒè¯
pnpm dev
```

**æ–¹æ³• 2ï¼šAI è¾…åŠ©ç¿»è¯‘ï¼ˆç”¨äºæ‰¹é‡èŠ‚ç‚¹ï¼‰**

```typescript
// scripts/generate-i18n-translations.ts
// è‡ªåŠ¨æ‰«æèŠ‚ç‚¹å®šä¹‰ï¼Œç”Ÿæˆç¿»è¯‘æ¨¡æ¿
import { readFileSync, writeFileSync } from 'fs';
import { glob } from 'glob';

const nodeFiles = glob.sync('packages/nodes-base/nodes/**/*.node.ts');
const translations = {};

for (const file of nodeFiles) {
  const content = readFileSync(file, 'utf-8');
  // æå– displayName, description, properties
  // ä½¿ç”¨ AI API ç¿»è¯‘
  // ç”Ÿæˆ translations å¯¹è±¡
}

writeFileSync(
  'packages/@n8n/i18n/src/locales/zh-CN/nodes-generated.json',
  JSON.stringify(translations, null, 2)
);
```

### 2.5 éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰ P0 èŠ‚ç‚¹å®Œæˆä¸­æ–‡åŒ–
- [ ] èŠ‚ç‚¹åç§°ã€æè¿°ã€å‚æ•°å…¨éƒ¨ä¸ºä¸­æ–‡
- [ ] i18n æ–‡ä»¶ç»“æ„æ­£ç¡®
- [ ] åˆ‡æ¢åˆ°ä¸­æ–‡è¯­è¨€ç¯å¢ƒåç•Œé¢æ˜¾ç¤ºæ­£ç¡®
- [ ] ä¸å½±å“è‹±æ–‡ç¯å¢ƒçš„ä½¿ç”¨

---

## ğŸ”§ é˜¶æ®µ 3ï¼šåå°ç®¡ç†ç³»ç»Ÿ - èŠ‚ç‚¹ç®¡ç†

### 3.1 åŠŸèƒ½éœ€æ±‚

**ç®¡ç†å‘˜å¯ä»¥ï¼š**
1. **ä¸Šä¼ èŠ‚ç‚¹** - ä¸Šä¼  TypeScript èŠ‚ç‚¹ä»£ç ï¼ˆåŸºäº `custom_node` è¡¨ï¼‰
2. **å®¡æ ¸èŠ‚ç‚¹** - å®¡æ ¸ç”¨æˆ·æäº¤çš„èŠ‚ç‚¹
3. **ç®¡ç†èŠ‚ç‚¹** - å¯ç”¨/ç¦ç”¨/åˆ é™¤èŠ‚ç‚¹
4. **æŸ¥çœ‹ç»Ÿè®¡** - èŠ‚ç‚¹ä½¿ç”¨ç»Ÿè®¡ã€ä¸‹è½½é‡
5. **é…ç½®å®šä»·** - ä¸ºä»˜è´¹èŠ‚ç‚¹è®¾ç½®ä»·æ ¼ï¼ˆå¯é€‰ï¼‰

### 3.2 æ•°æ®åº“è®¾è®¡ï¼ˆå·²æœ‰ï¼‰

**ä½¿ç”¨ç°æœ‰çš„ `custom_node` è¡¨ï¼š**

```sql
-- è¡¨å·²åœ¨é˜¶æ®µ 5.1 åˆ›å»º
CREATE TABLE custom_node (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  node_key VARCHAR(100) NOT NULL,               -- èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†
  node_name VARCHAR(200) NOT NULL,              -- èŠ‚ç‚¹åç§°

  workspace_id UUID NOT NULL,                   -- æ‰€å±å·¥ä½œç©ºé—´

  node_definition JSONB NOT NULL,               -- INodeTypeDescription
  node_code TEXT NOT NULL,                      -- TypeScript ä»£ç 

  config_mode VARCHAR(20) DEFAULT 'personal',   -- 'personal' | 'shared'
  shared_config_data TEXT,                      -- å›¢é˜Ÿå…±äº«é…ç½®
  config_schema JSONB,                          -- é…ç½®å­—æ®µå®šä¹‰

  category VARCHAR(100),                        -- åˆ†ç±»
  description TEXT,
  icon_url VARCHAR(500),
  version VARCHAR(50) NOT NULL DEFAULT '1.0.0',

  -- âœ… æ–°å¢ï¼šç®¡ç†å‘˜å®¡æ ¸å­—æ®µ
  submission_status VARCHAR(50),                -- 'draft' | 'pending' | 'approved' | 'rejected'
  submitted_at TIMESTAMP,
  reviewed_by UUID,
  reviewed_at TIMESTAMP,
  review_notes TEXT,

  -- âœ… æ–°å¢ï¼šèŠ‚ç‚¹ç±»å‹ï¼ˆå¹³å°/ç¬¬ä¸‰æ–¹/è‡ªå®šä¹‰ï¼‰
  node_type VARCHAR(50) DEFAULT 'custom',       -- 'platform' | 'third_party' | 'custom'

  -- âœ… æ–°å¢ï¼šä½¿ç”¨ç»Ÿè®¡
  download_count INT DEFAULT 0,
  usage_count INT DEFAULT 0,

  is_active BOOLEAN NOT NULL DEFAULT true,

  created_by UUID NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

  FOREIGN KEY (workspace_id) REFERENCES project(id) ON DELETE CASCADE,
  UNIQUE(workspace_id, node_key)
);
```

**éœ€è¦æ–°å¢çš„è¿ç§»ï¼š**

```typescript
// packages/@n8n/db/src/migrations/common/1762511304000-ExtendCustomNodeForAdmin.ts
export class ExtendCustomNodeForAdmin1762511304000 implements MigrationInterface {
  async up(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.query(`
      ALTER TABLE custom_node
      ADD COLUMN node_type VARCHAR(50) DEFAULT 'custom',
      ADD COLUMN download_count INT DEFAULT 0,
      ADD COLUMN usage_count INT DEFAULT 0
    `);

    // åˆ›å»ºç´¢å¼•
    await queryRunner.query(`
      CREATE INDEX idx_custom_node_type ON custom_node(node_type);
      CREATE INDEX idx_custom_node_download ON custom_node(download_count DESC);
    `);
  }

  async down(queryRunner: QueryRunner): Promise<void> {
    // Rollback logic
  }
}
```

### 3.3 åç«¯å®ç°

**Controller: `packages/cli/src/controllers/admin/admin-custom-nodes.controller.ts`**

```typescript
import { RestController, Get, Post, Put, Delete } from '@/decorators';
import { AuthenticatedRequest } from '@/requests';
import { CustomNodeService } from '@/services/custom-node.service';
import { Authorized } from '@/decorators/authorized';

@RestController('/admin/custom-nodes')
export class AdminCustomNodesController {
  constructor(private readonly customNodeService: CustomNodeService) {}

  /**
   * è·å–æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå«å¾…å®¡æ ¸ï¼‰
   */
  @Get('/')
  @Authorized(['global:admin'])
  async getAllNodes(req: AuthenticatedRequest) {
    return await this.customNodeService.getAllNodesForAdmin();
  }

  /**
   * å®¡æ ¸èŠ‚ç‚¹
   */
  @Post('/:nodeId/review')
  @Authorized(['global:admin'])
  async reviewNode(
    req: AuthenticatedRequest,
    @Param('nodeId') nodeId: string,
    @Body() body: { status: 'approved' | 'rejected'; notes?: string }
  ) {
    return await this.customNodeService.reviewNode(
      nodeId,
      body.status,
      req.user.id,
      body.notes
    );
  }

  /**
   * ä¸Šä¼ å¹³å°èŠ‚ç‚¹ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰
   */
  @Post('/platform')
  @Authorized(['global:admin'])
  async uploadPlatformNode(
    req: AuthenticatedRequest,
    @Body() body: {
      nodeKey: string;
      nodeName: string;
      nodeDefinition: any;
      nodeCode: string;
      category?: string;
      description?: string;
    }
  ) {
    return await this.customNodeService.createPlatformNode(body);
  }

  /**
   * æ›´æ–°èŠ‚ç‚¹ç»Ÿè®¡
   */
  @Post('/:nodeId/increment-download')
  async incrementDownload(@Param('nodeId') nodeId: string) {
    return await this.customNodeService.incrementDownload(nodeId);
  }

  /**
   * åˆ é™¤èŠ‚ç‚¹
   */
  @Delete('/:nodeId')
  @Authorized(['global:admin'])
  async deleteNode(@Param('nodeId') nodeId: string) {
    return await this.customNodeService.deleteNode(nodeId);
  }
}
```

**Service æ‰©å±•ï¼š** `packages/cli/src/services/custom-node.service.ts`

```typescript
@Service()
export class CustomNodeService {
  constructor(
    private readonly customNodeRepository: CustomNodeRepository,
  ) {}

  /**
   * è·å–æ‰€æœ‰èŠ‚ç‚¹ï¼ˆç®¡ç†å‘˜è§†å›¾ï¼‰
   */
  async getAllNodesForAdmin() {
    return await this.customNodeRepository.find({
      order: { createdAt: 'DESC' },
      relations: ['createdBy', 'reviewedBy'],
    });
  }

  /**
   * å®¡æ ¸èŠ‚ç‚¹
   */
  async reviewNode(
    nodeId: string,
    status: 'approved' | 'rejected',
    reviewerId: string,
    notes?: string
  ) {
    const node = await this.customNodeRepository.findOneOrFail({
      where: { id: nodeId },
    });

    node.submissionStatus = status;
    node.reviewedBy = reviewerId;
    node.reviewedAt = new Date();
    node.reviewNotes = notes;

    if (status === 'approved') {
      node.nodeType = 'third_party'; // å®¡æ ¸é€šè¿‡åå˜ä¸ºç¬¬ä¸‰æ–¹èŠ‚ç‚¹
    }

    return await this.customNodeRepository.save(node);
  }

  /**
   * åˆ›å»ºå¹³å°èŠ‚ç‚¹ï¼ˆç®¡ç†å‘˜ï¼‰
   */
  async createPlatformNode(data: {
    nodeKey: string;
    nodeName: string;
    nodeDefinition: any;
    nodeCode: string;
    category?: string;
    description?: string;
  }) {
    const node = this.customNodeRepository.create({
      ...data,
      nodeType: 'platform',
      workspaceId: null, // å¹³å°èŠ‚ç‚¹ä¸å±äºä»»ä½•å·¥ä½œç©ºé—´
      submissionStatus: 'approved',
      isActive: true,
    });

    return await this.customNodeRepository.save(node);
  }

  /**
   * å¢åŠ ä¸‹è½½è®¡æ•°
   */
  async incrementDownload(nodeId: string) {
    await this.customNodeRepository.increment(
      { id: nodeId },
      'downloadCount',
      1
    );
  }

  /**
   * åˆ é™¤èŠ‚ç‚¹
   */
  async deleteNode(nodeId: string) {
    return await this.customNodeRepository.delete({ id: nodeId });
  }
}
```

### 3.4 å‰ç«¯å®ç°

**é¡µé¢ï¼š** `packages/editor-ui/src/views/admin/AdminNodeManagement.vue`

```vue
<template>
  <div class="admin-node-management">
    <PageHeader title="èŠ‚ç‚¹ç®¡ç†">
      <template #actions>
        <n8n-button @click="showUploadDialog = true" type="primary">
          ä¸Šä¼ å¹³å°èŠ‚ç‚¹
        </n8n-button>
      </template>
    </PageHeader>

    <!-- ç­›é€‰å™¨ -->
    <div class="filters">
      <n8n-select v-model="filterType" placeholder="èŠ‚ç‚¹ç±»å‹">
        <n8n-option value="all">å…¨éƒ¨</n8n-option>
        <n8n-option value="platform">å¹³å°èŠ‚ç‚¹</n8n-option>
        <n8n-option value="third_party">ç¬¬ä¸‰æ–¹èŠ‚ç‚¹</n8n-option>
        <n8n-option value="custom">è‡ªå®šä¹‰èŠ‚ç‚¹</n8n-option>
      </n8n-select>

      <n8n-select v-model="filterStatus" placeholder="å®¡æ ¸çŠ¶æ€">
        <n8n-option value="all">å…¨éƒ¨</n8n-option>
        <n8n-option value="pending">å¾…å®¡æ ¸</n8n-option>
        <n8n-option value="approved">å·²é€šè¿‡</n8n-option>
        <n8n-option value="rejected">å·²æ‹’ç»</n8n-option>
      </n8n-select>
    </div>

    <!-- èŠ‚ç‚¹åˆ—è¡¨ -->
    <n8n-table :data="filteredNodes">
      <n8n-table-column prop="nodeName" label="èŠ‚ç‚¹åç§°" />
      <n8n-table-column prop="nodeType" label="ç±»å‹">
        <template #default="{ row }">
          <n8n-tag v-if="row.nodeType === 'platform'" type="success">
            å¹³å°èŠ‚ç‚¹
          </n8n-tag>
          <n8n-tag v-else-if="row.nodeType === 'third_party'" type="info">
            ç¬¬ä¸‰æ–¹èŠ‚ç‚¹
          </n8n-tag>
          <n8n-tag v-else type="default">è‡ªå®šä¹‰èŠ‚ç‚¹</n8n-tag>
        </template>
      </n8n-table-column>
      <n8n-table-column prop="submissionStatus" label="çŠ¶æ€">
        <template #default="{ row }">
          <n8n-tag
            v-if="row.submissionStatus === 'approved'"
            type="success"
          >
            å·²é€šè¿‡
          </n8n-tag>
          <n8n-tag
            v-else-if="row.submissionStatus === 'pending'"
            type="warning"
          >
            å¾…å®¡æ ¸
          </n8n-tag>
          <n8n-tag
            v-else-if="row.submissionStatus === 'rejected'"
            type="danger"
          >
            å·²æ‹’ç»
          </n8n-tag>
        </template>
      </n8n-table-column>
      <n8n-table-column prop="downloadCount" label="ä¸‹è½½é‡" />
      <n8n-table-column prop="usageCount" label="ä½¿ç”¨é‡" />
      <n8n-table-column label="æ“ä½œ" width="200">
        <template #default="{ row }">
          <n8n-button
            v-if="row.submissionStatus === 'pending'"
            @click="reviewNode(row, 'approved')"
            size="small"
            type="success"
          >
            é€šè¿‡
          </n8n-button>
          <n8n-button
            v-if="row.submissionStatus === 'pending'"
            @click="reviewNode(row, 'rejected')"
            size="small"
            type="danger"
          >
            æ‹’ç»
          </n8n-button>
          <n8n-button
            @click="viewNodeDetails(row)"
            size="small"
          >
            æŸ¥çœ‹
          </n8n-button>
          <n8n-button
            @click="deleteNode(row)"
            size="small"
            type="text"
          >
            åˆ é™¤
          </n8n-button>
        </template>
      </n8n-table-column>
    </n8n-table>

    <!-- ä¸Šä¼ å¯¹è¯æ¡† -->
    <NodeUploadDialog
      v-if="showUploadDialog"
      :is-admin="true"
      @close="showUploadDialog = false"
      @uploaded="handleNodeUploaded"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue';
import { useCustomNodesStore } from '@/stores/customNodes.store';

const customNodesStore = useCustomNodesStore();

const filterType = ref('all');
const filterStatus = ref('all');
const showUploadDialog = ref(false);

const nodes = computed(() => customNodesStore.adminNodes);

const filteredNodes = computed(() => {
  return nodes.value.filter(node => {
    if (filterType.value !== 'all' && node.nodeType !== filterType.value) {
      return false;
    }
    if (filterStatus.value !== 'all' && node.submissionStatus !== filterStatus.value) {
      return false;
    }
    return true;
  });
});

onMounted(async () => {
  await customNodesStore.fetchAdminNodes();
});

async function reviewNode(node: any, status: 'approved' | 'rejected') {
  const notes = await prompt(`å®¡æ ¸å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰ï¼š`);
  await customNodesStore.reviewNode(node.id, status, notes);
  showToast(`èŠ‚ç‚¹å·²${status === 'approved' ? 'é€šè¿‡' : 'æ‹’ç»'}`, 'success');
}

async function deleteNode(node: any) {
  if (await confirm(`ç¡®å®šåˆ é™¤èŠ‚ç‚¹"${node.nodeName}"ï¼Ÿ`)) {
    await customNodesStore.deleteNode(node.id);
    showToast('èŠ‚ç‚¹å·²åˆ é™¤', 'success');
  }
}
</script>
```

### 3.5 éªŒæ”¶æ ‡å‡†

- [ ] ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹
- [ ] ç®¡ç†å‘˜å¯ä»¥å®¡æ ¸å¾…å®¡æ ¸èŠ‚ç‚¹
- [ ] ç®¡ç†å‘˜å¯ä»¥ä¸Šä¼ å¹³å°èŠ‚ç‚¹
- [ ] ç®¡ç†å‘˜å¯ä»¥åˆ é™¤èŠ‚ç‚¹
- [ ] æ˜¾ç¤ºèŠ‚ç‚¹ç»Ÿè®¡ï¼ˆä¸‹è½½é‡ã€ä½¿ç”¨é‡ï¼‰
- [ ] ç­›é€‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

---

## ğŸª é˜¶æ®µ 4ï¼šç”¨æˆ·ç«¯ - èŠ‚ç‚¹ä¸­å¿ƒ

### 4.1 åŠŸèƒ½éœ€æ±‚

**ç”¨æˆ·å¯ä»¥ï¼š**
1. **æµè§ˆèŠ‚ç‚¹** - æŸ¥çœ‹å¹³å°èŠ‚ç‚¹ã€ç¬¬ä¸‰æ–¹èŠ‚ç‚¹
2. **æœç´¢èŠ‚ç‚¹** - æŒ‰åç§°ã€åˆ†ç±»ã€æ ‡ç­¾æœç´¢
3. **å®‰è£…èŠ‚ç‚¹** - ä¸€é”®å®‰è£…èŠ‚ç‚¹åˆ°å·¥ä½œç©ºé—´
4. **é…ç½®èŠ‚ç‚¹** - ä¸ºèŠ‚ç‚¹é…ç½®æˆæƒä¿¡æ¯
5. **ä¸Šä¼ èŠ‚ç‚¹** - æäº¤è‡ªå®šä¹‰èŠ‚ç‚¹å®¡æ ¸
6. **æˆ‘çš„èŠ‚ç‚¹** - ç®¡ç†å·²å®‰è£…çš„èŠ‚ç‚¹

### 4.2 åç«¯å®ç°

**Controller: `packages/cli/src/controllers/node-center.controller.ts`**

```typescript
@RestController('/node-center')
export class NodeCenterController {
  constructor(
    private readonly customNodeService: CustomNodeService,
  ) {}

  /**
   * è·å–èŠ‚ç‚¹å¸‚åœºï¼ˆä»…æ˜¾ç¤ºå·²å®¡æ ¸é€šè¿‡çš„ï¼‰
   */
  @Get('/marketplace')
  async getMarketplace(@Query('category') category?: string) {
    return await this.customNodeService.getMarketplaceNodes(category);
  }

  /**
   * æœç´¢èŠ‚ç‚¹
   */
  @Get('/search')
  async searchNodes(@Query('q') query: string) {
    return await this.customNodeService.searchNodes(query);
  }

  /**
   * å®‰è£…èŠ‚ç‚¹åˆ°å·¥ä½œç©ºé—´
   */
  @Post('/:nodeId/install')
  async installNode(
    @Param('nodeId') nodeId: string,
    @WorkspaceContext() context: { workspaceId: string; userId: string }
  ) {
    return await this.customNodeService.installNodeToWorkspace(
      nodeId,
      context.workspaceId,
      context.userId
    );
  }

  /**
   * è·å–å·²å®‰è£…çš„èŠ‚ç‚¹
   */
  @Get('/installed')
  async getInstalledNodes(
    @WorkspaceContext() context: { workspaceId: string }
  ) {
    return await this.customNodeService.getInstalledNodes(context.workspaceId);
  }

  /**
   * ç”¨æˆ·ä¸Šä¼ èŠ‚ç‚¹ï¼ˆæäº¤å®¡æ ¸ï¼‰
   */
  @Post('/upload')
  async uploadNode(
    req: AuthenticatedRequest,
    @Body() body: {
      nodeKey: string;
      nodeName: string;
      nodeDefinition: any;
      nodeCode: string;
      category?: string;
      description?: string;
    },
    @WorkspaceContext() context: { workspaceId: string; userId: string }
  ) {
    return await this.customNodeService.createCustomNode({
      ...body,
      workspaceId: context.workspaceId,
      createdBy: context.userId,
      submissionStatus: 'pending', // æäº¤å®¡æ ¸
    });
  }
}
```

**Service æ‰©å±•ï¼š**

```typescript
@Service()
export class CustomNodeService {
  /**
   * è·å–å¸‚åœºèŠ‚ç‚¹ï¼ˆå·²å®¡æ ¸é€šè¿‡ï¼‰
   */
  async getMarketplaceNodes(category?: string) {
    const where: any = {
      submissionStatus: 'approved',
      isActive: true,
      nodeType: In(['platform', 'third_party']),
    };

    if (category) {
      where.category = category;
    }

    return await this.customNodeRepository.find({
      where,
      order: { downloadCount: 'DESC' },
    });
  }

  /**
   * æœç´¢èŠ‚ç‚¹
   */
  async searchNodes(query: string) {
    return await this.customNodeRepository
      .createQueryBuilder('node')
      .where('node.submissionStatus = :status', { status: 'approved' })
      .andWhere('node.isActive = :active', { active: true })
      .andWhere(
        '(node.nodeName ILIKE :query OR node.description ILIKE :query)',
        { query: `%${query}%` }
      )
      .orderBy('node.downloadCount', 'DESC')
      .getMany();
  }

  /**
   * å®‰è£…èŠ‚ç‚¹åˆ°å·¥ä½œç©ºé—´
   */
  async installNodeToWorkspace(
    nodeId: string,
    workspaceId: string,
    userId: string
  ) {
    const sourceNode = await this.customNodeRepository.findOneOrFail({
      where: { id: nodeId },
    });

    // å¤åˆ¶èŠ‚ç‚¹åˆ°å·¥ä½œç©ºé—´
    const installedNode = this.customNodeRepository.create({
      nodeKey: sourceNode.nodeKey,
      nodeName: sourceNode.nodeName,
      nodeDefinition: sourceNode.nodeDefinition,
      nodeCode: sourceNode.nodeCode,
      configMode: sourceNode.configMode,
      configSchema: sourceNode.configSchema,
      category: sourceNode.category,
      description: sourceNode.description,
      iconUrl: sourceNode.iconUrl,
      version: sourceNode.version,
      workspaceId,
      createdBy: userId,
      nodeType: 'custom',
      submissionStatus: 'approved',
      isActive: true,
    });

    // å¢åŠ ä¸‹è½½è®¡æ•°
    await this.incrementDownload(nodeId);

    return await this.customNodeRepository.save(installedNode);
  }

  /**
   * è·å–å·²å®‰è£…çš„èŠ‚ç‚¹
   */
  async getInstalledNodes(workspaceId: string) {
    return await this.customNodeRepository.find({
      where: { workspaceId },
      order: { createdAt: 'DESC' },
    });
  }
}
```

### 4.3 å‰ç«¯å®ç°

**é¡µé¢ï¼š** `packages/editor-ui/src/views/NodeCenter.vue`

```vue
<template>
  <div class="node-center">
    <PageHeader title="èŠ‚ç‚¹ä¸­å¿ƒ">
      <template #description>
        å‘ç°å’Œå®‰è£…å¼ºå¤§çš„å·¥ä½œæµèŠ‚ç‚¹
      </template>
      <template #actions>
        <n8n-button @click="showUploadDialog = true">
          ä¸Šä¼ æˆ‘çš„èŠ‚ç‚¹
        </n8n-button>
      </template>
    </PageHeader>

    <!-- æœç´¢å’Œç­›é€‰ -->
    <div class="search-bar">
      <n8n-input
        v-model="searchQuery"
        placeholder="æœç´¢èŠ‚ç‚¹..."
        @input="handleSearch"
        prefix-icon="search"
      />

      <n8n-select v-model="selectedCategory" placeholder="åˆ†ç±»">
        <n8n-option value="">å…¨éƒ¨</n8n-option>
        <n8n-option value="data">æ•°æ®å¤„ç†</n8n-option>
        <n8n-option value="communication">é€šè®¯</n8n-option>
        <n8n-option value="productivity">ç”Ÿäº§åŠ›</n8n-option>
        <n8n-option value="ai">AI</n8n-option>
      </n8n-select>
    </div>

    <!-- Tab åˆ‡æ¢ -->
    <n8n-tabs v-model="activeTab">
      <n8n-tab-pane label="å¸‚åœº" name="marketplace">
        <NodeGrid
          :nodes="marketplaceNodes"
          @install="handleInstallNode"
          @view="viewNodeDetails"
        />
      </n8n-tab-pane>

      <n8n-tab-pane label="å·²å®‰è£…" name="installed">
        <NodeList
          :nodes="installedNodes"
          @configure="configureNode"
          @uninstall="uninstallNode"
        />
      </n8n-tab-pane>

      <n8n-tab-pane label="æˆ‘çš„ä¸Šä¼ " name="my-uploads">
        <NodeList
          :nodes="myUploadedNodes"
          @edit="editNode"
          @delete="deleteNode"
        />
      </n8n-tab-pane>
    </n8n-tabs>

    <!-- ä¸Šä¼ å¯¹è¯æ¡† -->
    <NodeUploadDialog
      v-if="showUploadDialog"
      @close="showUploadDialog = false"
      @uploaded="handleNodeUploaded"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue';
import { useNodeCenterStore } from '@/stores/nodeCenter.store';

const nodeCenterStore = useNodeCenterStore();

const searchQuery = ref('');
const selectedCategory = ref('');
const activeTab = ref('marketplace');
const showUploadDialog = ref(false);

const marketplaceNodes = computed(() => {
  let nodes = nodeCenterStore.marketplaceNodes;

  if (selectedCategory.value) {
    nodes = nodes.filter(n => n.category === selectedCategory.value);
  }

  if (searchQuery.value) {
    nodes = nodes.filter(n =>
      n.nodeName.includes(searchQuery.value) ||
      n.description?.includes(searchQuery.value)
    );
  }

  return nodes;
});

const installedNodes = computed(() => nodeCenterStore.installedNodes);
const myUploadedNodes = computed(() => nodeCenterStore.myUploadedNodes);

onMounted(async () => {
  await Promise.all([
    nodeCenterStore.fetchMarketplaceNodes(),
    nodeCenterStore.fetchInstalledNodes(),
    nodeCenterStore.fetchMyUploadedNodes(),
  ]);
});

async function handleInstallNode(node: any) {
  await nodeCenterStore.installNode(node.id);
  showToast(`èŠ‚ç‚¹"${node.nodeName}"å·²å®‰è£…`, 'success');
}

function handleSearch() {
  // æœç´¢å·²åœ¨ computed ä¸­å¤„ç†
}
</script>
```

**èŠ‚ç‚¹å¡ç‰‡ç»„ä»¶ï¼š** `packages/editor-ui/src/components/NodeCenter/NodeCard.vue`

```vue
<template>
  <div class="node-card">
    <div class="node-card-header">
      <img :src="node.iconUrl || defaultIcon" class="node-icon" />
      <div class="node-info">
        <h3>{{ node.nodeName }}</h3>
        <p class="node-description">{{ node.description }}</p>
      </div>
    </div>

    <div class="node-card-meta">
      <span class="download-count">
        <i class="fa fa-download" />
        {{ node.downloadCount || 0 }} æ¬¡ä¸‹è½½
      </span>
      <n8n-tag v-if="node.nodeType === 'platform'" type="success">
        å¹³å°èŠ‚ç‚¹
      </n8n-tag>
    </div>

    <div class="node-card-actions">
      <n8n-button @click="$emit('install', node)" type="primary" block>
        å®‰è£…
      </n8n-button>
      <n8n-button @click="$emit('view', node)" type="text">
        æŸ¥çœ‹è¯¦æƒ…
      </n8n-button>
    </div>
  </div>
</template>

<script setup lang="ts">
defineProps<{
  node: any;
}>();

defineEmits(['install', 'view']);

const defaultIcon = 'https://n8n.io/favicon.ico';
</script>
```

### 4.4 éªŒæ”¶æ ‡å‡†

- [ ] ç”¨æˆ·å¯ä»¥æµè§ˆå¸‚åœºèŠ‚ç‚¹
- [ ] ç”¨æˆ·å¯ä»¥æœç´¢èŠ‚ç‚¹
- [ ] ç”¨æˆ·å¯ä»¥å®‰è£…èŠ‚ç‚¹åˆ°å·¥ä½œç©ºé—´
- [ ] ç”¨æˆ·å¯ä»¥æŸ¥çœ‹å·²å®‰è£…èŠ‚ç‚¹
- [ ] ç”¨æˆ·å¯ä»¥ä¸Šä¼ èŠ‚ç‚¹å¹¶æäº¤å®¡æ ¸
- [ ] ç”¨æˆ·å¯ä»¥æŸ¥çœ‹è‡ªå·±ä¸Šä¼ çš„èŠ‚ç‚¹çŠ¶æ€

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### èŠ‚ç‚¹åŠ¨æ€åŠ è½½æœºåˆ¶

**é—®é¢˜ï¼š** ç§»åŠ¨èŠ‚ç‚¹åï¼Œå¦‚ä½•ç¡®ä¿é¡¹ç›®ä»ç„¶èƒ½åŠ è½½å‰©ä½™çš„èŠ‚ç‚¹ï¼Ÿ

**è§£å†³æ–¹æ¡ˆï¼š**

```typescript
// packages/cli/src/services/load-nodes-and-credentials.ts

class LoadNodesAndCredentials {
  async loadNodes() {
    // 1. åŠ è½½å†…ç½®èŠ‚ç‚¹ï¼ˆpackages/nodes-base/nodesï¼‰
    const builtinNodes = await this.loadBuiltinNodes();

    // 2. åŠ è½½è‡ªå®šä¹‰èŠ‚ç‚¹ï¼ˆæ•°æ®åº“ä¸­çš„ custom_nodeï¼‰
    const customNodes = await this.loadCustomNodes();

    // 3. åˆå¹¶èŠ‚ç‚¹åˆ—è¡¨
    this.nodeTypes = {
      ...builtinNodes,
      ...customNodes,
    };
  }

  async loadCustomNodes() {
    const customNodeService = Container.get(CustomNodeService);
    const nodes = await customNodeService.getAllActiveNodes();

    const nodeTypes = {};

    for (const node of nodes) {
      // åŠ¨æ€ç¼–è¯‘ TypeScript ä»£ç 
      const compiledCode = this.compileNodeCode(node.nodeCode);

      // åŠ¨æ€æ³¨å†ŒèŠ‚ç‚¹
      nodeTypes[node.nodeKey] = {
        type: compiledCode.NodeClass,
        sourcePath: `custom://${node.id}`,
      };
    }

    return nodeTypes;
  }

  compileNodeCode(code: string) {
    // ä½¿ç”¨ ts.transpileModule ç¼–è¯‘ TypeScript
    const result = ts.transpileModule(code, {
      compilerOptions: {
        module: ts.ModuleKind.CommonJS,
        target: ts.ScriptTarget.ES2020,
      },
    });

    // æ‰§è¡Œç¼–è¯‘åçš„ä»£ç 
    const module = { exports: {} };
    const fn = new Function('module', 'exports', result.outputText);
    fn(module, module.exports);

    return module.exports;
  }
}
```

### èŠ‚ç‚¹å›½é™…åŒ–åŠ è½½

**ç¡®ä¿ä¸­æ–‡ç¿»è¯‘æ­£ç¡®åŠ è½½ï¼š**

```typescript
// packages/@n8n/i18n/src/index.ts

export function loadNodeTranslations(locale: string) {
  if (locale === 'zh-CN') {
    return {
      ...require('./locales/zh-CN/nodes.json'),
      ...require('./locales/zh-CN/nodes-custom.json'), // è‡ªå®šä¹‰ç¿»è¯‘
    };
  }
  return {};
}
```

---

## âœ… éªŒæ”¶æ ‡å‡†

### é˜¶æ®µ 1 éªŒæ”¶
- [ ] 388 ä¸ªå‡­è¯æ–‡ä»¶å·²ç§»åŠ¨
- [ ] å¯¹åº”èŠ‚ç‚¹ç›®å½•å·²ç§»åŠ¨
- [ ] å¤‡ä»½æŠ¥å‘Šç”Ÿæˆå®Œæ•´
- [ ] é¡¹ç›®å¯ä»¥æ­£å¸¸æ„å»º
- [ ] ä¿ç•™çš„èŠ‚ç‚¹çº¦ 142 ä¸ª

### é˜¶æ®µ 2 éªŒæ”¶
- [ ] P0 èŠ‚ç‚¹å®Œæˆä¸­æ–‡åŒ–
- [ ] i18n æ–‡ä»¶ç»“æ„æ­£ç¡®
- [ ] ä¸­æ–‡ç¯å¢ƒæ˜¾ç¤ºæ­£ç¡®
- [ ] è‹±æ–‡ç¯å¢ƒä¸å—å½±å“

### é˜¶æ®µ 3 éªŒæ”¶
- [ ] ç®¡ç†å‘˜å¯ä»¥å®¡æ ¸èŠ‚ç‚¹
- [ ] ç®¡ç†å‘˜å¯ä»¥ä¸Šä¼ å¹³å°èŠ‚ç‚¹
- [ ] èŠ‚ç‚¹ç»Ÿè®¡æ˜¾ç¤ºæ­£ç¡®
- [ ] ç­›é€‰åŠŸèƒ½æ­£å¸¸

### é˜¶æ®µ 4 éªŒæ”¶
- [ ] ç”¨æˆ·å¯ä»¥æµè§ˆå¸‚åœº
- [ ] ç”¨æˆ·å¯ä»¥å®‰è£…èŠ‚ç‚¹
- [ ] ç”¨æˆ·å¯ä»¥ä¸Šä¼ èŠ‚ç‚¹
- [ ] æœç´¢åŠŸèƒ½æ­£å¸¸

---

## ğŸ“Š å·¥æœŸå®‰æ’

| å‘¨æ¬¡ | ä»»åŠ¡ | å·¥ä½œé‡ |
|------|------|--------|
| **Week 1** | é˜¶æ®µ 1: èŠ‚ç‚¹å¤‡ä»½ç§»åŠ¨ | 0.5 å¤© |
| **Week 1-2** | é˜¶æ®µ 2: æ ¸å¿ƒèŠ‚ç‚¹ä¸­æ–‡åŒ–ï¼ˆP0ï¼‰ | 1 å‘¨ |
| **Week 2-3** | é˜¶æ®µ 2: å…¶ä»–èŠ‚ç‚¹ä¸­æ–‡åŒ–ï¼ˆP1, P2ï¼‰ | 1 å‘¨ |
| **Week 3** | é˜¶æ®µ 3: åå°èŠ‚ç‚¹ç®¡ç† | 1 å‘¨ |
| **Week 4** | é˜¶æ®µ 4: ç”¨æˆ·èŠ‚ç‚¹ä¸­å¿ƒ | 1 å‘¨ |
| **æ€»è®¡** | - | **3-4 å‘¨** |

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
**åˆ›å»ºæ—¥æœŸï¼š** 2025-11-09
**ç»´æŠ¤è€…ï¼š** å¼€å‘å›¢é˜Ÿ
**çŠ¶æ€ï¼š** å¾…å®¡æ ¸

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [æ¦‚å¿µä¿®æ­£æ–¹æ¡ˆ](./06-æ¦‚å¿µä¿®æ­£æ–¹æ¡ˆ.md)
- [å®æ–½è®¡åˆ’ä¸é‡Œç¨‹ç¢‘](./02-å®æ–½è®¡åˆ’ä¸é‡Œç¨‹ç¢‘.md)
- [n8n å¤šç§Ÿæˆ·æ¶æ„å®Œæ•´æ–¹æ¡ˆ](./01-n8nå¤šç§Ÿæˆ·æ¶æ„å®Œæ•´æ–¹æ¡ˆ.md)
